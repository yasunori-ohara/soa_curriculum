# DDD-12

### 【補足説明】上位レベルとは相対的・再帰的である

ドメイン駆動設計を適用したことで、私たちはこの原理のさらに深い層に到達しました。

この文脈では、驚くべきことに役割が逆転し、Order集約が上位レベル（方針）となりました。「注文とは何か」「有効な注文とはどのような状態か」という、ビジネスの最も核心的で不変の方針を定義しているからです。

そして、ProcessOrderUseCaseは下位レベル（詳細）となりました。それは、Order集約という厳格な方針を守りながら、注文を成立させるための詳細な手順を実装する、数あるクライアントの一つにすぎません。

`UseCase`は`Order`集約の公開されたメソッドという「抽象」に依存しており、その内部でどのように整合性が保たれているかという詳細には関与しません。

私たちは、クリーンアーキテクチャという金庫室の中に、DDDによってさらに小さな、しかし最も強固な「貴重品ボックス（集約）」を見つけました。

では、このアプリケーション全体（金庫室）自体が、より大きなシステムから見れば、一つの「下位レベル」だとしたらどうでしょう？

会社全体のビジネスプロセスという、最も大きなマトリョーシカ人形の視点からシステムを捉えるのが、次のサービス指向アーキテクチャです。

---

### 4. SOAの章の最後に追加する補足説明

### 【ダメ押し】上位レベルとは相対的・再帰的である

サービス指向アーキテクチャによって、私たちはついにこの原理がシステム全体にまで及ぶことを確認しました。

この文脈では、私たちが作ってきた「注文受付サービス」全体が**上位レベル（方針）です。「顧客からの注文を受け付け、成立させる」という、一つの大きなビジネス能力（方針）を担っているからです。

そして、外部の「在庫管理サービス」は下位レベル（詳細）**です。「注文受付」という方針を達成するために利用される、詳細な機能の一つだからです。

ここでも、上位である「注文受付サービス」は、下位である具体的な在庫管理サービスの実装に依存せず、`InventoryServicePort`という**抽象的な契約（ポート）**にのみ依存しました。

振り返ってみましょう。この「上位の方針は、下位の詳細に依存してはならない」というたった一つの原理が、クラス設計（OOP）、アプリケーション構造（CA）、ドメインモデル（DDD）、そしてシステム間連携（SOA）という、あらゆるスケールで再帰的に適用されていることが分かります。

この普遍的な原理を理解し、使いこなすことこそが、変更に強く、柔軟で、価値あるソフトウェアを設計するための真髄なのです。