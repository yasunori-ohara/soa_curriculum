# CA-10

### 【補足説明】上位レベルとは相対的・再帰的である

クリーンアーキテクチャは、この原理をアプリケーション全体の構造として体系化したものです。

この文脈では、ProcessOrderUseCaseが上位レベル（方針）でした。「注文を処理するには、商品を見つけ出し、状態を保存する必要がある」という、アプリケーションの方針を決定したからです。

そして、InMemoryProductRepositoryのような具体的なクラスは下位レベル（詳細）でした。商品を「どうやって」永続化するかという詳細を実装したからです。

ここでも、上位である`UseCase`は、下位である具体的なリポジトリに依存せず、`ProductRepository`という抽象にのみ依存しました。

OOPの章で「上位」だったStoreクラスの責務は、今やUseCaseという、さらに「上位」のレベルに吸収されました。

では、このUseCaseこそが、このアプリケーションにおける絶対的な「最上位」なのでしょうか？

いいえ、そうではありません。ビジネスの最も核心的なルール、例えば「注文の合計金額は、必ず明細の合計と一致しなければならない」という不変のルールから見れば、UseCaseはそのルールを利用するクライアントの一つであり、一種の「詳細」と見なすこともできるのです。

この、さらに内側にあるマトリョーシカ人形を探求するのが、次のドメイン駆動設計です。

---