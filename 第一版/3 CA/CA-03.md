# CA-03

```markdown
## `use_cases/interfaces.py`(インターフェース)

### 1. このファイルの役割：外部世界との「契約書」(Ports)

この`use_cases/interfaces.py`ファイルは、Use Cases（ユースケース）レイヤーに属します。その役割は、内側のビジネスロジックが、外側の世界（データベース、外部APIなど）とどのような「約束事（契約）」を結ぶのかを定義することです。

クリーンアーキテクチャの絶対的なルールは「内側は外側を知らない」です。しかし、ユースケースは商品のデータをどこかから取得したり、変更を保存したりする必要があります。

この矛盾を解決するのが、このインターフェースファイルです。ユースケースは、「データベースがMySQLなのか、インメモリなのか」といった具体的な技術を知る代わりに、「私が必要なのは、商品IDを渡したら商品を返してくれて、商品を渡したら保存してくれる**『誰か』**です」と、**抽象的な役割（インターフェース）**をここで宣言します。

このインターフェースは、しばしば「ポート（Port）」と呼ばれ、内側の世界と外側の世界をつなぐための、標準化された接続口の役割を果たします。

### 2. ソースコードの詳細解説

`ProductRepository(ABC)`: 商品の保管庫（リポジトリ）の契約書

この抽象基底クラスは、商品の永続化（データの保存や読み込み）を担当するオブジェクトが満たすべき契約を定義します。このパターンをリポジトリパターンと呼びます。

- `find_by_id(...)`: 商品ID（単純な文字列）を受け取り、`Product`エンティティ（ドメインオブジェクト）を返すことを約束します。

- `save(...)`: `Product`エンティティを受け取り、その状態をどこかに保存することを約束します。

重要なのは、ユースケースがやり取りする相手は、常にこの**抽象的な`ProductRepository`**であり、その背後で実際に動いているのがインメモリDBなのか、本物のMySQLなのかを一切気にする必要がない、という点です。

### 3. このレイヤーの鉄則

1. 内側の要求によって定義される: このインターフェースは、ユースケースが「こういう機能が欲しい」と要求したから存在します。外側のデータベースの都合で定義されるのではありません。

2. 内側のレイヤーにのみ依存する: `import`文を見てください。このファイルは、自分より内側の`domain`レイヤーから`Product`をインポートしていますが、外側の`interface_adapters`レイヤーから何かをインポートすることは決してありません。

3. ドメインオブジェクトをやり取りする: インターフェースのメソッドが受け渡しするデータは、データベースの生データ（辞書など）ではなく、`Product`のような純粋なドメインオブジェクトです。これにより、レイヤー間の境界がクリーンに保たれます。

---

### `use_cases/interfaces.py` (インターフェース)
``` Python
# 依存性のルール:
# このファイルはUse Casesレイヤーに属します。
# したがって、自分より内側のレイヤー（domain）にのみ依存することが許されます。
# 外側のレイヤー（interface_adapters, main.pyなど）から何かを
# インポートすることは、固く禁じられています。

from abc import ABC, abstractmethod
from typing import List
from domain.product import Product

class ProductRepository(ABC):
    """
    【Use Casesレイヤー / Port】
    商品の永続化（保存、読み込みなど）を担当するリポジトリのインターフェース。
    
    Use Caseレイヤーは、この「契約書」にのみ依存します。
    この契約を実際にどうやって実現するか（インメモリDBか、MySQLかなど）は、
    外側のInterface Adaptersレイヤーの責任です。
    """
    @abstractmethod
    def find_by_id(self, product_id: str) -> Product | None:
        """商品IDを元に、単一の商品エンティティを検索することを約束します。"""
        pass
    
    @abstractmethod
    def save(self, product: Product):
        """商品エンティティの状態を永続化することを約束します。"""
        pass

class StoreRepository(ABC):
    """
    店舗の情報を管理するリポジトリのインターフェース。
    （今回は簡略化のため、このインターフェースは直接は使用しませんが、
    アプリケーションが成長するにつれて必要になる概念です）
    """
    @abstractmethod
    def find_products_by_store_name(self, store_name: str) -> List[Product]:
        """店舗名に紐づくすべての商品エンティティを検索することを約束します。"""
        pass

    @abstractmethod
    def add_product_to_store(self, store_name: str, product: Product):
        """指定された店舗に商品を追加することを約束します。"""
        pass
```

```