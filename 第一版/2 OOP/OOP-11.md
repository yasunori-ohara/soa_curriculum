# OOP-11

---

### 【深掘り】制御の流れ vs 依存の方向：OOPがもたらす設計の革命

先ほどの`OrderNotifier`の例で、私たちは`Store`クラスを変更することなく、通知方法を柔軟に切り替えられるようになりました。一見すると、`Store`が`EmailNotifier`を「使っている」ように見えます。しかし、ソースコードの依存関係をよく見ると、驚くべき事実が隠されています。

### 1. ➡️ 制御の流れ (Control Flow)

これは、プログラムが**実行される時**の、実際の処理の順番です。今回の例では、処理は以下のように流れます。

1. `Store`が`notifier.send_confirmation()`を呼び出す。
2. その実体である`EmailNotifier`の`send_confirmation()`が実行される。

処理の流れは、`Store` → `EmailNotifier` と、上位から下位へと流れています。

### 2. ⬅️ 依存の方向 (Dependency Direction)

これは、ソースコード上での**「どちらが、どちらの存在を知っているか」**という静的な関係です。依存関係の矢印は、制御の流れとは**真逆**を向いています。

- `Store`クラスは、`OrderNotifier`という**抽象的なインターフェース**しか知りません。
- `EmailNotifier`クラスは、`OrderNotifier`という**抽象的なインターフェース**を実装する（知っている）責任を負っています。

ソースコード上の依存関係は、 `Store` → `OrderNotifier` ← `EmailNotifier` となっており、両者とも**抽象**に依存しているのです。

### 🔌 インターフェースが起こす「逆転」という魔法

この「制御の流れ」と「依存の方向」を分離し、逆転させることを可能にしている魔法こそが、私たちが定義した`OrderNotifier`という**インターフェース**なのです。

この関係は、**壁のコンセントと家電製品**に例えることができます。

- コンセントの穴の形 = インターフェース (OrderNotifier)
    
    これは「電力を供給する」という、標準化された**約束事（抽象）**です。
    
- 家電製品のプラグ = 実装クラス (EmailNotifier)
    
    家電メーカーは、この標準的なコンセントの形に合わせてプラグを実装します。
    
- 電気の流れ = 制御の流れ
    
    電気は、壁のコンセントから家電製品へと流れます。
    
- 依存の方向
    
    家電製品は、壁のコンセントの形に依存しています。壁は、特定の家電（iPhoneやドライヤー）の存在を一切知りません。
    

このインターフェースという「標準化されたコンセント」があるおかげで、私たちは壁を工事することなく、様々な家電製品を自由に差し替えることができるのです。

### 次のステージへ

この強力な考え方は、実は次のステージへの壮大な伏線となっています。

もし、この「制御の流れと依存方向を分離する」というルールを、特定のクラス間だけでなく、アプリケーションの**すべての境界（ビジネスロジック vs データベース、ビジネスロジック vs UIなど）**で適用したら、一体どんなに柔軟で堅牢なシステムが生まれるでしょうか？

それこそが、次の章で学ぶ**クリーンアーキテクチャ**の核心思想なのです。