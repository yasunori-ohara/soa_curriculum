# OOP-10

# 質問

ここまでの改良でやったことは「なるべくmain.pyの変更が少なくなるようにしている」ように思うのですが、これは次のクリーンアーキテクチャの考えにも通じるものですか？

# 回答

はい、その通りです。その気づきは、**クリーンアーキテクチャの魂そのもの**と言っても過言ではないほど、本質を捉えています。

これまでの改良は、一見すると「`main.py`の変更を減らす」という目的のように見えます。しかし、その根底にある思想は、まさしくクリーンアーキテクチャへと直接つながるものです。

---

### 共通する思想：「誰が、誰に依存するべきか？」

これまでのリファクタリングの根底には、常に**「依存関係の制御」**という考え方がありました。

- **インターフェースの導入**:
`Store`クラス（上位のビジネスフロー）が、`PhysicalProduct`のような具体的なクラス（下位の詳細）に依存するのではなく、両者が`Product`という**抽象**に依存するようにしました。
- **Factory Method パターン**:
`main.py`（クライアント）が、`PhysicalProduct`のような具体的なクラス（詳細）に依存するのではなく、`ProductFactory`という**抽象的な依頼先**に依存するようにしました。

これらの目的は、「**上位の安定した方針（Policy）は、下位の不安定な詳細（Detail）に依存してはならない**」という、一貫した原則を守るためです。

---

### クリーンアーキテクチャとの関係

クリーンアーキテクチャは、この原則をアプリケーション全体に適用した、**壮大な設計図**です。

クリーンアーキテクチャの世界では、何が「方針」で、何が「詳細」なのかを、以下のように明確に定義します。

- **方針 (Policy)**:
システムの中心に位置する**ビジネスロジック**や**ユースケース**。これらはビジネスの本質であり、頻繁には変わりません。
- **詳細 (Detail)**:
システムの最も外側に位置する**フレームワーク、データベース、UI、そして`main.py`**。これらはビジネスの本質ではなく、目的を達成するための「道具」にすぎず、将来的には交換される可能性があります。

この図を見ると分かる通り、**`main.py`はアプリケーションの「詳細」の最も外側に位置する存在**なのです。`main.py`は、アプリケーションを起動するための一つの手段にすぎません。ビジネスロジックは、自分がWebアプリケーションとして起動されるのか、コマンドラインツールとして起動されるのか、あるいはテストコードから呼び出されるのかを**一切気にしてはいけません**。

これまでの改良で「`main.py`の変更が少なくなるように」してきたのは、`main.py`が特別だからではありません。それは、`main.py`が「詳細」であり、**「方針」であるビジネスロジックを、「詳細」の変更から守ってきた**結果なのです。

---

### 結論

はい、これまでのOOPの改良は、クリーンアーキテクチャの思想に通じるどころか、**その最も重要な原則を、クラスという小さなスケールで実践してきた**と言えます。

私たちは無意識のうちに、クリーンアーキテクチャを構築するための「筋力トレーニング」を積んできたのです。その素晴らしい気づきを持って、次のステージに進みましょう。