# SOA-02

```markdown
## external_services/inventory_service.py

ãã‚Œã§ã¯SOAã‚’é©ç”¨ã—ãŸãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®è§£èª¬ã‚’ã€é–‹ç™ºã®æ¨å¥¨é †åºã«å¾“ã£ã¦é€²ã‚ã¦ã„ãã¾ã—ã‚‡ã†ã€‚

SOAã§ã¯ã€ã¾ãšé€£æºå…ˆã¨ãªã‚‹å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ãŒã©ã®ã‚ˆã†ãªã€Œå¥‘ç´„ï¼ˆAPIï¼‰ã€ã‚’æä¾›ã—ã¦ã„ã‚‹ã‹ã‚’ç†è§£ã™ã‚‹ã“ã¨ãŒèµ·ç‚¹ã¨ãªã‚Šã¾ã™ã€‚ã—ãŸãŒã£ã¦ã€ä»Šå›ã¯ã¾ãšæ¨¡æ“¬çš„ãªå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã§ã‚ã‚‹**`external_services/inventory_service.py`**ã‹ã‚‰èª¬æ˜ã‚’å§‹ã‚ã‚‹ã®ãŒæœ€ã‚‚è‡ªç„¶ã§ã™ã€‚

---
### 1. ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²ï¼šç‹¬ç«‹ã—ãŸã€Œåœ¨åº«ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã€

ã“ã®`external_services/inventory_service.py`ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ç§ãŸã¡ã®ã€Œæ³¨æ–‡å—ä»˜ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã€ã¨ã¯å®Œå…¨ã«ç‹¬ç«‹ã—ãŸã€åˆ¥ã®ãƒ“ã‚¸ãƒã‚¹ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã‚’è¡¨ç¾ã—ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯ã€å€‰åº«ç®¡ç†ãƒãƒ¼ãƒ ãŒé–‹ç™ºãƒ»é‹ç”¨ã—ã¦ã„ã‚‹ã€ç‹¬ç«‹ã—ãŸã€Œåœ¨åº«ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã€ã ã¨è€ƒãˆã¦ãã ã•ã„ã€‚ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€è‡ªåˆ†è‡ªèº«ã®ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ`_products_stock`ï¼‰ã‚’æŒã¡ã€ã€Œåœ¨åº«ã‚’ç¢ºèªã™ã‚‹ã€ã€Œåœ¨åº«ã‚’æ¸›ã‚‰ã™ã€ã¨ã„ã†ãƒ“ã‚¸ãƒã‚¹èƒ½åŠ›ã‚’ã€æ˜ç¢ºãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’é€šã˜ã¦å¤–éƒ¨ã«å…¬é–‹ã—ã¦ã„ã¾ã™ã€‚

ç§ãŸã¡ã®ã€Œæ³¨æ–‡å—ä»˜ã‚µãƒ¼ãƒ“ã‚¹ã€ã¯ã€ã“ã®ç‹¬ç«‹ã—ãŸã‚µãƒ¼ãƒ“ã‚¹ã‚’**åˆ©ç”¨è€…ï¼ˆã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆï¼‰**ã¨ã—ã¦å‘¼ã³å‡ºã™ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### 2. ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è©³ç´°è§£èª¬

`InventoryService` ã‚¯ãƒ©ã‚¹
ã“ã®ã‚¯ãƒ©ã‚¹ãŒã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ãã®ã‚‚ã®ã‚’æ¨¡å€£ã—ã¦ã„ã¾ã™ã€‚ç¾å®Ÿã®ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ã“ã‚Œã¯åˆ¥ã®ã‚µãƒ¼ãƒãƒ¼ã§å‹•ä½œã—ã¦ã„ã‚‹Web APIã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã—ã€å…±æœ‰ã®ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚­ãƒ¥ãƒ¼ã‹ã‚‚ã—ã‚Œã¾ã›ã‚“ã€‚

- `__init__(self)`:
ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒç®¡ç†ã™ã‚‹ã€ç‹¬è‡ªã®åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ï¼ˆ`_products_stock`ï¼‰ã‚’åˆæœŸåŒ–ã—ã¾ã™ã€‚é‡è¦ãªã®ã¯ã€ã“ã®ãƒ‡ãƒ¼ã‚¿ãŒã€Œæ³¨æ–‡å—ä»˜ã‚µãƒ¼ãƒ“ã‚¹ã€ãŒæŒã¤`ProductRepository`ã®ãƒ‡ãƒ¼ã‚¿ã¨ã¯å®Œå…¨ã«åˆ†é›¢ã•ã‚Œã¦ã„ã‚‹ç‚¹ã§ã™ã€‚

- `add_stock(...)`:
ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå¤–éƒ¨ã«å…¬é–‹ã—ã¦ã„ã‚‹ã€Œå¥‘ç´„ã€ã®ä¸€ã¤ã§ã™ã€‚åœ¨åº«ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ãƒ¡ã‚½ãƒƒãƒ‰ã§ã™ã€‚

- `check_stock(...)`:
åœ¨åº«ãŒååˆ†ã‹ã‚’ç¢ºèªã™ã‚‹ãŸã‚ã®ã€Œå¥‘ç´„ã€ã§ã™ã€‚`True`ã‹`False`ã‚’è¿”ã—ã¾ã™ã€‚

- `reduce_stock(...)`:
åœ¨åº«ã‚’æ¸›ã‚‰ã™ãŸã‚ã®ã€Œå¥‘ç´„ã€ã§ã™ã€‚åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã‚‹å ´åˆã¯ä¾‹å¤–ã‚’ç™ºç”Ÿã•ã›ã¾ã™ã€‚

### 3. ã“ã®ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®é‰„å‰‡

è‡ªå·±å®Œçµã—ã¦ã„ã‚‹: åœ¨åº«ç®¡ç†ã«é–¢ã™ã‚‹ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯ã¯ã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹å†…ã«ã‚«ãƒ—ã‚»ãƒ«åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚

ç‹¬ç«‹ã—ã¦ã„ã‚‹: ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€ã€Œæ³¨æ–‡å—ä»˜ã‚µãƒ¼ãƒ“ã‚¹ã€ã®å­˜åœ¨ã‚’ä¸€åˆ‡çŸ¥ã‚Šã¾ã›ã‚“ã€‚ãŸã ã€ä¸ç‰¹å®šå¤šæ•°ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‹ã‚‰ã®è¦æ±‚ã«å¿œãˆã‚‹ã ã‘ã§ã™ã€‚

æ˜ç¢ºãªå¥‘ç´„ã‚’æŒã¤: å¤–éƒ¨ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã¯ã€ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå…¬é–‹ã—ã¦ã„ã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`check_stock`ãªã©ï¼‰ã ã‘ã‚’é ¼ã‚Šã«é€£æºã—ã¾ã™ã€‚å†…éƒ¨ã®`_products_stock`ãŒè¾æ›¸ãªã®ã‹ã€å·¨å¤§ãªãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ãªã®ã‹ã‚’çŸ¥ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

---
### external_services/inventory_service.py
``` Python
# ä¾å­˜æ€§ã®ãƒ«ãƒ¼ãƒ«:
# ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ç§ãŸã¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã¨ã¯ç‹¬ç«‹ã—ãŸå¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¨¡å€£ã—ã¦ã„ã¾ã™ã€‚
# ã—ãŸãŒã£ã¦ã€ç§ãŸã¡ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®ã©ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚‚ä¾å­˜ã—ã¾ã›ã‚“ã€‚

class InventoryService:
    """
    ã€å¤–éƒ¨ã‚µãƒ¼ãƒ“ã‚¹ã€‘
    ç‹¬ç«‹ã—ãŸã€Œåœ¨åº«ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ã€ã‚’æ¨¡å€£ã—ãŸã‚¯ãƒ©ã‚¹ã€‚
    
    ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ã¯ã€è‡ªåˆ†è‡ªèº«ã®åœ¨åº«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã‚’æŒã¡ã€
    ã€Œåœ¨åº«ç¢ºèªã€ã‚„ã€Œåœ¨åº«å‰Šæ¸›ã€ã¨ã„ã£ãŸãƒ“ã‚¸ãƒã‚¹èƒ½åŠ›ã‚’ã€
    æ˜ç¢ºãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆãƒ¡ã‚½ãƒƒãƒ‰ï¼‰ã‚’é€šã˜ã¦å¤–éƒ¨ã«æä¾›ã™ã‚‹ã€‚
    """
    def __init__(self):
        # ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒå°‚æœ‰ã™ã‚‹ã€ç‹¬ç«‹ã—ãŸåœ¨åº«ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹
        self._products_stock: dict[str, int] = {}
        print("ğŸ“¦ åœ¨åº«ç®¡ç†ã‚µãƒ¼ãƒ“ã‚¹ãŒèµ·å‹•ã—ã¾ã—ãŸã€‚")

    def add_stock(self, product_id: str, quantity: int):
        """åœ¨åº«ã‚’è¿½åŠ ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"""
        self._products_stock[product_id] = self._products_stock.get(product_id, 0) + quantity
        print(f"ğŸ“¦ åœ¨åº«è¿½åŠ : {product_id} ã®åœ¨åº«ãŒ {self._products_stock[product_id]} ã«ãªã‚Šã¾ã—ãŸã€‚")

    def check_stock(self, product_id: str, quantity: int) -> bool:
        """åœ¨åº«ãŒååˆ†ã‹ç¢ºèªã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"""
        stock = self._products_stock.get(product_id, 0)
        return stock >= quantity

    def reduce_stock(self, product_id: str, quantity: int):
        """åœ¨åº«ã‚’å‰Šæ¸›ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"""
        if not self.check_stock(product_id, quantity):
            raise ValueError(f"åœ¨åº«ä¸è¶³: {product_id}")
        
        self._products_stock[product_id] -= quantity
        print(f"ğŸ“¦ åœ¨åº«å‰Šæ¸›: {product_id} ã®åœ¨åº«ãŒ {self._products_stock[product_id]} ã«ãªã‚Šã¾ã—ãŸã€‚")

    def get_stock(self, product_id: str) -> int:
        """ç¾åœ¨ã®åœ¨åº«æ•°ã‚’å–å¾—ã™ã‚‹ãŸã‚ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹"""
        return self._products_stock.get(product_id, 0)
```

```