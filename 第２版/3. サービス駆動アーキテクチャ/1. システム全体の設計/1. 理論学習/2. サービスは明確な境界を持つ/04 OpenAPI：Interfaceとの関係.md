## APIの「契約」とは？ InterfaceとOpenAPIの役割

ソフトウェアアーキテクチャを考える上で、「**契約**（約束事）」という考え方は非常に重要です。部品同士が正しく連携するために、様々なレベルで「契約」が結ばれます。

ここでは、一見似ているように見える二つの「契約」について解説します。一つはアプリケーション**内部**で使われる契約、もう一つは**外部**との通信で使われる契約です。この二つの役割を正しく理解することが、アーキテクチャ設計の鍵となります。

### ✨ 内部の契約：クリーンアーキテクチャの`Interface`の役割

クリーンアーキテクチャにおける`Interface`は、**一つのアプリケーション内部で、レイヤー同士が連携するための「契約」**です。

例えば、ビジネスロジックを担う`Use Case`層が、データベースを操作する`Gateways`層に「ユーザー情報を保存してほしい」と依頼する場面を想像してください。このとき、`Use Case`層は具体的なデータベース（MySQLなのかPostgreSQLなのか）の実装を知るべきではありません。

そこで`Use Case`層は、「`save_user`という名前で、こういうデータを渡せる部品が必要だ」という**取り決め(`Interface`)**だけを定義します。`Gateways`層は、その取り決めに従って具体的な処理を実装します。



このように、`Interface`の主な目的は**依存性逆転**、つまりアプリケーション**内部のコードの依存関係を整理し、綺麗に保つ**ことです。

* **コミュニケーションの媒体:** この契約は、同一プロセス内の**メモリ**を介した**「関数呼び出し」**を前提としています。これは超高速で、失敗する可能性が極めて低い、信頼性の高い通信です。

### ✨ 外部との契約：OpenAPIの役割

一方、OpenAPIは**あなたのサービス（アプリケーション）全体と、外部の世界（他のサービスやWebブラウザなど）が連携するための「契約」**です。

これは、**ネットワーク**を介した**「通信呼び出し（HTTP通信）」**を前提としています。ネットワーク越しの通信は、信頼性の高いメモリ内の関数呼び出しとは全く異なり、常に以下のような問題を考慮しなければなりません。

* **遅延（レイテンシ）**が必ず発生する
* ネットワーク障害など、**部分的な失敗**が常に起こりうる
* やり取りできるデータは、テキスト（JSONなど）に変換できる**シンプルな形式**に限られる

この**信頼できない世界**で、異なるプログラム同士が確実に意思疎通できるように、OpenAPIは**外部との通信ルール**を厳密に定義します。成功時だけでなく失敗時に何が返るか、データ形式は何か、セキュリティはどうするか、といった詳細な取り決めが必要になります。

### ✨ まとめ：なぜこの二つは根本的に違うのか？

ここまで見てきたように、`Interface`とOpenAPIはどちらも「契約」ですが、その目的と前提とする世界が全く異なります。

| 観点 | クリーンアーキテクチャの `Interface` (内部向け) | OpenAPI (外部向け) |
| :--- | :--- | :--- |
| **目的** | **依存性逆転**のため（コードの依存関係を整理する） | **相互運用性**のため（異なるプログラム同士を通信させる） |
| **媒体** | **メモリ**（同一プロセス内の関数呼び出し） | **ネットワーク**（HTTPなどの通信呼び出し） |
| **前提** | 超高速・高信頼性 | 低速・低信頼性（部分的な失敗を常に考慮） |
| **技術** | プログラミング言語の機能（Pythonの抽象基底クラスなど） | 言語に依存しないテキスト形式（YAML, JSON） |

**結論として、`Interface`はアプリケーション内部のコード整理術であり、OpenAPIはアプリケーション外部との通信ルールブックです。** この根本的な違いを理解することが、次のステップに進む上で非常に重要です。

