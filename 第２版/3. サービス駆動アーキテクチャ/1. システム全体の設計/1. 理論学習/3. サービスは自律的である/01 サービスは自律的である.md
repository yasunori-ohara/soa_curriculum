## 2. サービスは自律的である (Services are autonomous)

この原則の核心は、**「各サービスが、自分自身のビジネスロジックとデータを完全に管理し、他のサービスに依存せずに独立して機能・進化できるべきである」**という考え方です。

サービスが自律的であるためには、主に以下の2つの条件を満たす必要があります。
1.  **自身のデータを所有し、責任を持つ**: 他のサービスが、そのサービスのデータベースを直接読み書きするようなことがあってはなりません。データに関するやり取りは、必ずそのサービスが公開するAPIを通じて行われます。
2.  **独立してデプロイ・更新できる**: あるサービスに変更を加えてデプロイする際に、他のサービスも同時にデプロイし直す必要があってはなりません。

会社の「営業部」と「経理部」に例えることができます。経理部が請求処理のために、営業部の管理する顧客リストを勝手に書き換えることはありませんよね。必ず営業部に依頼（APIコール）して、正式な手順で情報を得たり更新したりします。また、経理部のシステムが新しくなっても、営業部の業務は止まりません。これが自律性です。


---

### 👑ドメイン駆動設計（DDD）との関連

「どこまでを一つのサービスの責任範囲（自律性の範囲）とするか」という問いに答えるのが、DDDの役割です。

* **応用するDDDの知識:**
    * **境界づけられたコンテキスト (Bounded Context)**: これが自律性の**境界線**を定義します。あるコンテキスト内のデータ（特に**集約(Aggregate)**）は、そのコンテキストに属するサービスだけが責任を持って管理すべきです。
    * **データ所有権の明確化**: DDDを通じてドメインを分析することで、「商品価格」は商品サービスが、「在庫数」は在庫サービスが、「配送先住所」は注文サービスが所有する、といったデータの所有権が明確になります。

**DDDの実践が、「データベースをサービス間で共有してしまう」という、自律性を破壊する最悪のアンチパターンを避けるための羅針盤となります。** 各サービスは、自身のコンテキストに属するデータのために、**独自のデータベース（あるいは最低でもテーブル空間）を持つ**ことが理想です。

---

### 👑クリーンアーキテクチャとの関連

クリーンアーキテクチャは、個々のサービスが**技術的な自律性**を確保し、独立して進化できるための内部構造を提供します。

* **応用するクリーンアーキテクチャの知識:**
    * **依存性のルール**: ビジネスの核となるロジックが、データベースやフレームワークといったインフラ技術から隔離されています。これにより、例えばサービスAが使っているデータベースをMySQLからPostgreSQLに**変更しても、サービスBには何の影響も与えません**。
    * **変更容易性の確保**: クリーンアーキテクチャは、サービス内部の変更を容易にします。内部が変更しやすいということは、外部環境の変化に追随してサービスが独立して進化しやすい、つまり自律性を維持しやすいということに繋がります。

クリーンアーキテクチャを採用することで、サービスは**ビジネス的な要求**（DDDによる境界）と**技術的な要求**（インフラの変更）の両面で、他のサービスから独立した存在＝自律的な存在でいられるのです。

---

### 👑 実現するための技術

サービスの自律性を技術的に実現・促進するためには、以下のようなものが使われます。

* **サービスごとのデータベース (Database per Service)**: 各サービスが完全に独立したデータベースを持つパターンです。これにより、データレベルでの結合がなくなり、高い自律性を確保できます。
* **コンテナ技術 (Dockerなど)**: サービスとその実行環境（ライブラリ、設定ファイルなど）をひとまとめに「コンテナ」としてパッケージングする技術です。これにより、どんな環境でもサービスを同じように動かすことができ、独立したデプロイが非常に容易になります。
* **非同期メッセージング (RabbitMQ, Kafkaなど)**: サービス間の通信を、電話のような同期的（相手の応答を待つ）なAPI呼び出しだけでなく、手紙のような非同期的（メッセージを送って自分の処理を続ける）な方法で行う仕組みです。これにより、相手のサービスが一時的に停止していても影響を受けにくくなり、時間的な結合が断ち切られ、自律性が向上します。

---

### 👑 まとめ

| 概念 | 役割 | 関連する知識・技術 |
| :--- | :--- | :--- |
| **ドメイン駆動設計** | **自律性の範囲**（どのデータを所有するか）を決定する | 境界づけられたコンテキスト, 集約 |
| **クリーンアーキテクチャ** | **技術的な自律性**（変更容易性）を内部で確保する | 依存性のルール |
| **各種技術** | **物理的な自律性**（独立したデプロイや通信）を実現する | サービスごとのDB, Docker, 非同期メッセージング |
