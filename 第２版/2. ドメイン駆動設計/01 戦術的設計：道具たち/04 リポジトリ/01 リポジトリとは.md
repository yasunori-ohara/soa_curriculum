## リポジトリとは


### 優れたプログラムにおける工夫

まず、DDDとは関係なく、優れたプログラムでは昔から、**ビジネスロ-ジック**と**データベースアクセス**のコードを分離する、という工夫が行われてきました。

例えば、ビジネスロジックを担当するファイルでは、データベースの具体的な操作（SQL文など）を書くことはしません。代わりに、データアクセスを担当する別のファイルを呼び出す形にします。

```python
# business_logic.py (ビジネスロジック)
import data_access

def process_order(order_id):
    # 「データを取ってきて」とお願いする
    order_data = data_access.get_order(order_id)
    
    # 本来のビジネスロ-ジックに集中する
    # ...
    
    # 「データを保存して」とお願いする
    data_access.save_order(order_data)

# data_access.py (データアクセス)
def get_order(order_id):
    # ここで初めてSQLが登場する
    # SELECT * FROM orders WHERE id = ...
    pass
```

このように役割を分離することで、ビジネスロジックのコードがデータベースの都合に振り回されなくなり、見通しが良く、テストしやすい状態を保つことができます。これは、多くの優秀な技術者が経験的にたどり着いた設計上の知恵です。

-----

### DDDが与えた「リポジトリ」という名前

ドメイン駆動設計（DDD）は、この古くからある優れた習慣に\*\*「リポジトリ (Repository)」\*\*という正式な名前を与えました。

「データアクセスを専門に行う部品」という漠然とした役割に、「リポジトリ」という明確な名前が付いたことで、私たちは以下のような共通認識を持つことができるようになりました。

  * 「ここはリポジトリの仕事だね」
  * 「新しいエンティティだから、リポジトリも作らないと」

このように、チーム全員が同じ言葉で設計を語れるようになり、個人のスキルや経験の差によらず、チーム全体で一貫した設計思想を共有できるようになったのです。

-----

### 「リポジトリ」がもたらす具体的な効果

DDDのリポジトリは、ただ名前が付いただけではありません。さらに以下のよ-うな、より強力な効果とルールをもたらします。

1.  **集約 (Aggregate) の専門家である**
    リポジトリが扱うのは、単なるデータ(`order_data`)ではなく、ビジネスルールを内包した**集約オブジェクト (`Order`)** です。これにより、ドメインモデルとデータベースの間で、情報の欠落や意図しない変換が起きるのを防ぎます。

2.  **コレクションのように振る舞う**
    リポジトリは、利用者（UseCase）に対して、まるでメモリ上のリスト（コレクション）であるかのように振る舞います。利用者は`find_by_id`や`save`といったシンプルな操作をするだけで、裏側の複雑なデータベース処理を意識する必要が全くありません。

3.  **アーキテクチャ上の置き場所が明確になる**
    リポジトリは、「**インターフェースはドメイン層に、実装はインフラ層に**」という明確な住所を持ちます。これにより、クリーンアー-キテクチャにおける依存関係のルールを自然に守ることができ、ドメイン層がインフラ層の詳細から隔離された、クリーンな状態を保てます。

-----

### まとめ

DDDの**リポジトリ**とは、多くの優れた技術者が実践してきた「**ビジネスロジックとデータアクセスの分離**」という設計上の知恵に、明確な**名前**と**ルール**を与え、誰でも実践可能な**共通のパターン**として体系化したものです。

これは全く新しい発明ではありませんが、この名前とルールがあるおかげで、私たちはチームとして一貫した設計を行い、システムの保守性と拡張性を飛躍的に向上させることができるのです。