## 🤔 ここででてくる値オブジェクトは、例えば、構造体で言うとメンバー一つ一つが値オブジェクトであり、これをまとめた構造体も値オブジェクトである、ということでしょうか？

はい、そのように**値オブジェクトが、より小さな値オブジェクトを内包する**ことは頻繁にあります。

あるオブジェクト（構造体）が値オブジェクトかどうかは、その中身のメンバーが何かよりも、「オブジェクト全体として、不変な（書き換えられない）一つの『値』として扱われるか」どうかで決まります。

-----

### 値オブジェクトの入れ子構造

値オブジェクトは、プリミティブな型（数値や文字列）だけで構成されるとは限りません。他の値オブジェクトをメンバーとして持つことで、より複雑でリッチな「値」を表現できます。

#### 自動駐車システムの`VehiclePose`（車両姿勢）の例

`VehiclePose`は、「車両の位置と向き」という一つの概念を表す値オブジェクトです。これは、さらに小さな2つの値オブジェクトから構成されている、と考えることができます。

1.  **`Angle` (角度) 値オブジェクト**:

      * 向き（`heading`）を表します。
      * 内部に`value`（例: 1.57）と`unit`（例: "radians"）を持ち、「角度は0〜2πの間に正規化する」といったルールを持ちます。

2.  **`Coordinate` (座標) 値オブジェクト**:

      * 位置（`position`）を表します。
      * 内部に`x`と`y`という2つの数値を持ちます。

3.  **`VehiclePose` (車両姿勢) 値オブジェクト**:

      * `Coordinate`値オブジェクトと`Angle`値オブジェクトをメンバーとして持ちます。
      * これら全体を合わせて、「車両姿勢」という一つの「値」として扱われます。

#### コードで見る入れ子構造

```python
from dataclasses import dataclass

# 小さな値オブジェクト
@dataclass(frozen=True)
class Angle:
    value: float
    unit: str = "radians"

# 小さな値オブジェクト
@dataclass(frozen=True)
class Coordinate:
    x: float
    y: float

# 小さな値オブジェクトを組み合わせて作られた、より大きな値オブジェクト
@dataclass(frozen=True)
class VehiclePose:
    position: Coordinate
    heading: Angle

# 利用例
# このposeオブジェクトは、生成された後、内部の値を一切変更できない
pose = VehiclePose(
    position=Coordinate(x=10.5, y=20.3),
    heading=Angle(value=1.57) # 90度
)
```

この例では、

  * `Angle`のメンバーである`value`はプリミティブな値オブジェクトと言えます。
  * `Coordinate`もメンバーはプリミティブです。
  * そして、`Angle`と`Coordinate`をまとめた`VehiclePose`もまた、**全体として不変で、値として比較される**ため、値オブジェクトです。

このように、値オブジェクトの性質は**入れ子**にすることができます。重要なのは、どのレベルのオブジェクトであっても「**不変な値の塊**」として扱われる、という点です。



