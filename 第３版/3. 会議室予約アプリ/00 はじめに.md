# 第0章：はじめに（第３巡の全体像）

> この第３巡では「**会議室予約システム**」を題材に、
> 「クリーンアーキテクチャの考え方」を**より実践的に**学びます。
> これまでの第１巡（メモアプリ）と第２巡（図書貸出アプリ）をもとに、
> 今回は少し複雑な「**現実に近い仕組み**」を設計していきます。

---

## 🎯 この章の目的

* クリーンアーキテクチャの考え方をもう一度整理する
* この第３巡で作るシステムの**全体の流れと構成**を理解する
* 今後の各章で使う「図」と「用語」の対応を確認する

---

## 🧭 今回の題材：会議室予約アプリ

題材は「**会議室予約システム**」です。
会議室を登録し、会員が日時を指定して予約を行うことができます。

たとえば、こんなことをできるようにします：

| ユースケース            | 内容                      |
| ----------------- | ----------------------- |
| **会議室を予約する**      | すでに同じ時間帯に予約がある場合はエラーにする |
| **予約を取り消す**       | 予約の締切後はキャンセルできないようにする   |
| **空いている会議室を検索する** | 希望の時間・人数・設備条件で探せるようにする  |
| **会員を登録する**       | 名前とメールアドレスで会員登録を行う      |

このように、「複数の人が同じ時間に予約しないようにする」など、
**現実的なルール（ビジネスルール）**をプログラムの中で表現していきます。

---

## 🧩 クリーンアーキテクチャとは？

![クリーンアーキテクチャ](../クリーンアーキテクチャ.png)

クリーンアーキテクチャとは、
「**システムを“円の層”で分けて考える**」という設計の考え方です。

中心（内側）ほど**ビジネスの考え方**を表し、
外側に行くほど**技術的な実装（Web、DB、UIなど）**になります。

| 層                                   | 内容                       | 主な担当           |
| ----------------------------------- | ------------------------ | -------------- |
| **Entity（エンティティ）層**                 | 会議室や予約など、現実のルールそのもの      | Pythonのクラス     |
| **UseCase（ユースケース）層**                | 「何をするか」の手続き。予約を作る・取り消すなど | ビジネスの流れ        |
| **InterfaceAdapter（インターフェースアダプタ）層** | 外の世界（WebやDB）との橋渡し        | コントローラや変換クラス   |
| **Infrastructure（インフラ）層**           | 技術部分。Webサーバ・データベースなど     | FastAPIやSQLite |

> 覚えておきたい基本ルール：
> **依存（import）は内側へ**、**実行の流れは外から内へ入り、また外へ返る**
> これをクリーンアーキテクチャの「**依存は内へ／制御は外へ**」といいます。

---

## 💬 用語集

| 用語                                            | 説明                                                                  |
| --------------------------------------------- | ------------------------------------------------------------------- |
| **DTO（データ転送オブジェクト）**                          | 「境界を渡すためのデータの箱」。入力や出力をまとめて渡すための入れ物です。                               |
| **Boundary（バウンダリ）**                           | 「境界の取り決め」。どんなデータを渡し、どんな返り値を返すかの**約束（インターフェース）**です。                  |
| **Repository（リポジトリ）**                         | データの出し入れを行う「保存担当クラス」。実際の保存先（ファイルやDB）は知らないで動けるようにします。                |
| **依存性逆転（DIP：Dependency Inversion Principle）** | 「上位のルールが下位の技術に依存しないようにする」考え方。つまり、「内側は外側を知らない」ように作ります。               |
| **冪等性（べきとうせい）**                               | 同じ操作を何度しても結果が変わらないようにする性質。たとえば「予約ボタンを2回押しても予約は1件だけ」。                |
| **排他／整合性**                                    | 「同じ会議室が同時に2人に予約されないようにする」など、データの一貫性を保つ仕組み。                          |
| **抽象（ちゅうしょう）契約**                              | 具体的な実装を持たない「取り決めだけのクラス（interface）」。UseCase層ではこれを使って外の層に依存しないようにします。 |

> これらの言葉は、各章で少しずつ登場します。
> 初めて出てきたときには、必ず「日本語の説明」をつけています。

---

## 🧱 フォルダ構成（第３巡 全体）

1章と2章では、まず**中心のロジック部分（EntityとUseCase）**だけを作ります。
後半の章で外側（WebやDBなど）を足していきます。

```
project_round3/
├── domain/                               # 1章：エンティティ（現実のルール）
│   ├── reservation.py
│   ├── room.py
│   └── member.py
├── usecase/                              # 2章：ユースケース（アプリの手続き）
│   ├── dto.py                            # 入力／出力データの箱
│   ├── boundaries/                       # 取り決め（インターフェース）
│   │   └── reservation_boundaries.py
│   ├── contracts/                        # 保存先との約束（リポジトリ契約）
│   │   ├── reservation_repository.py
│   │   ├── room_repository.py
│   │   └── member_repository.py
│   ├── create_reservation.py             # 予約を作るユースケース
│   ├── cancel_reservation.py             # 予約を取り消すユースケース（後で）
│   └── search_availability.py            # 空き検索ユースケース（後で）
├── interface/                            # 3章：橋渡し層（WebやDBとの接続）
│   ├── controller/
│   ├── presenter/
│   └── gateway/
├── infrastructure/                       # 4章：技術層（DB・Webなど）
│   ├── db/
│   ├── web/
│   └── locking/
└── main.py                               # 5章：全体をつなぐ（組み立て）
```

---

## 🖊 コード共通ルール：図との対応コメント

すべてのPythonファイルの冒頭には、次のようなコメントをつけます。
どの図のどの部分にあたるかを示すためです。

```python
# --------------------------------------------------------------------
# [クラス図] UseCaseInteractor（ユースケースの中心）
# [同心円] UseCase層（アプリの手続きを表す）
# 役割：予約を作る手続きを表現。外の世界（DBやWeb）は知らない。
# --------------------------------------------------------------------
```

---

## 🧠 学び方の流れ（全6章）

| 章                        | 内容                   | 学べること                   |
| ------------------------ | -------------------- | ----------------------- |
| **第0章 はじめに（本章）**         | 題材と全体構成を理解する         | 「層の考え方」を復習              |
| **第1章 Entity（エンティティ）**   | 会議室・予約・会員のルール        | 現実のルールをクラスで表す           |
| **第2章 UseCase（ユースケース）**  | 予約の作成・一覧などの手続き       | 境界を意識した設計（Input/Output） |
| **第3章 InterfaceAdapter** | コントローラ・プレゼンター・ゲートウェイ | 層をつなぐ「翻訳役」を学ぶ           |
| **第4章 Infrastructure**   | DBやWebサーバの実装         | 技術を外側にまとめる              |
| **第5章 Main（組み立て）**       | 全体を動かす               | 依存のつなぎ方を学ぶ              |
| **第6章 理論編**              | 「依存は内へ／制御は外へ」を再整理    | 静的依存と動的制御の違い            |

---

## 💡 本巡で学ぶ新しい考え方

| テーマ                   | 内容                 | 難易度 |
| --------------------- | ------------------ | --- |
| **重複チェック**            | 同じ時間に二重予約できないようにする | ★★★ |
| **データの整合性**           | 部屋の定員オーバーを防ぐ       | ★★  |
| **同じ操作を2回しても安全（冪等性）** | ボタンの連打を防ぐ          | ★★  |
| **保存先を自由に変えられる設計**    | DBを差し替えても動く        | ★★★ |
| **契約テスト**             | 「約束どおり動くか」を確認するテスト | ★★★ |

---

## ✅ この章を終えたら

* 会議室予約アプリの全体像を理解できた
* クリーンアーキテクチャの「円の構造」と「層の役割」を説明できる
* コードに「図対応コメント」を入れる意味を理解できた

---

## ▶ 次のページ

**第1章：Entity（エンティティ）**

* 会議室・予約・会員という3つの「現実のルール」をコード化します。
* 「時間が重ならない」「定員を超えない」などのチェックを
  Pythonの関数やクラスで表現します。
