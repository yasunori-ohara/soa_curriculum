## 第0章：はじめに — 意味で分けた世界をつなぐ

---

## 🎯 この章の目的

* SOA（Service-Oriented Architecture：サービス指向アーキテクチャ）とは何かを理解する
* DDD（ドメイン駆動設計）とSOAのつながりを整理する
* クリーンアーキテクチャとの位置づけを把握する
* この後のSOA教材全体の流れを把握する

---

## 1. SOAとは何か？

SOAとは、システム全体を「サービス」という単位で分割し、
各サービスを明確な契約（API）でつなぐアーキテクチャです。

**要点：**

* サービス＝独立した小さなアプリケーション
* 各サービスは「自分のデータ」「自分のロジック」を持つ
* サービス間はAPIで通信（REST, gRPC, Message Busなど）

**構造イメージ：**

```
System
 ├─ Reservation Service
 ├─ Member Service
 └─ Room Service
```

各サービスは独立して動作し、API契約を通じて連携します。

---

## 2. SOAが解決する課題

| 現状の問題         | SOAでの解決       |
| ------------- | ------------- |
| 1つの大規模アプリが肥大化 | 小さなサービスに分割    |
| 部分修正が全体に影響    | サービス単位で独立デプロイ |
| データの所有権が曖昧    | 各サービスがデータを所有  |
| チーム間の衝突       | チームをサービス単位に分離 |

**まとめ：**

> SOAは「分けることで全体を強くする」設計思想です。

---

## 3. DDDとの関係

DDDでは「境界づけられたコンテキスト（Bounded Context）」という単位で
ドメインの意味的な分割を行います。
SOAでは、このコンテキストをそのまま「サービス」として外に公開します。

| DDDの概念                       | SOAでの対応                  |
| ---------------------------- | ------------------------ |
| Bounded Context（言葉の区切り）      | Service（技術的な区切り）         |
| Aggregate                    | Service内部の一貫性単位          |
| Repository                   | Service内部のデータ操作          |
| Domain Service               | Service内部のビジネスルール        |
| Application Service（UseCase） | Serviceの公開機能（APIとして外部提供） |

**まとめ：**

* DDD → サービス内部の意味づけ
* SOA → サービス間の接続の仕組み

---

## 4. クリーンアーキテクチャとの関係

| 観点   | クリーンアーキテクチャ    | SOA                   |
| ---- | -------------- | --------------------- |
| 対象範囲 | アプリ内部          | システム全体                |
| 主な目的 | 内部構造の安定化       | サービス間の疎結合             |
| 接続方法 | 依存注入（インターフェース） | API（HTTP / gRPC / MQ） |
| 層の方向 | 内向き（Entity中心）  | 横方向（サービス間）            |

**まとめ：**

> クリーンアーキが「中を整える」仕組み、
> SOAは「外をつなぐ」仕組みです。

---

## 5. SOAの4つの原則

1. **独立性（Autonomy）**
   　各サービスは自分のロジック・データを持ち、独立して開発・運用できる。
2. **契約性（Contract）**
   　サービス間の通信は明確な契約（OpenAPIなど）で定義する。
3. **再利用性（Reusability）**
   　1つのサービスを別のシステムでも利用できる。
4. **疎結合性（Loose Coupling）**
   　実装を変更しても契約(API仕様)が変わらなければ他サービスに影響しない。

**例：**

* Member Service が REST API を変更しない限り、
  Reservation Service は安心して利用できる。

---

## 6. サービス間のやり取り（概要）

**構造：**

```
Reservation Service
 ├─ calls → Member Service（会員の有効性確認）
 └─ calls → Room Service（部屋の空き確認）
```

**通信例：**

```http
GET /members/101
→ { "id": 101, "name": "Taro", "is_active": true }

GET /rooms/7/availability?start=...&end=...
→ { "available": true }

POST /reservations
→ { "id": 999, "status": "created" }
```

**説明：**

> 各サービスは、相手の内部構造を知らずに
> 公開API（契約）を通じてデータをやり取りします。

---

## 7. SOAにおける「契約（Contract）」とは

* **定義**：サービス間のリクエスト／レスポンスの約束
* **形式**：OpenAPI, JSON Schema, gRPC proto など
* **役割**：

  * 設計書（仕様書）
  * 自動生成の元（SDK・スタブ）
  * テスト対象（契約テストのベース）

**例：**

```
Reservation Service  →  Member Service
  HTTP GET /members/{id}
  返却データ：Memberオブジェクト（id, name, email, is_active）
```

---

## 8. SOAの成長段階

```
1. DDD：意味ごとにドメインを分ける
2. SOA：それぞれをサービスとしてAPI公開
3. Microservices：各サービスを独立デプロイ（運用単位に分離）
```

**まとめ：**

> DDD → 設計
> SOA → 連携
> Microservices → 運用
> という順序で発展していきます。

---

## 9. この後の学習ステップ（SOAカリキュラム構成）

| 章   | 内容            | 到達目標                   |
| --- | ------------- | ---------------------- |
| 第0章 | はじめに          | DDDからSOAへの接続を理解        |
| 第1章 | サービス境界とAPI設計  | OpenAPIによる契約定義を理解      |
| 第2章 | サービス間通信       | REST / gRPC / 非同期通信を理解 |
| 第3章 | 契約テスト         | サービス間の整合性を自動検証         |
| 第4章 | SOA × クリーンアーキ | サービス全体を統合設計            |

---

## 10. まとめ

| 観点           | 内容                         |
| ------------ | -------------------------- |
| SOAの目的       | システムを意味ごとに独立したサービスで構築する    |
| DDDとの関係      | DDDのコンテキストをSOAのサービスとして公開   |
| クリーンアーキとの関係  | 各サービスの内部構造を安定させる仕組み        |
| 契約（Contract） | サービス間連携の“約束”を仕様化（OpenAPI等） |
| 今後の流れ        | 各サービスを設計し、通信・テスト・統合へ進む     |

