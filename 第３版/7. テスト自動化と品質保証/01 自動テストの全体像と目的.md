## 第1章：自動テストの全体像と目的


## 🎯 この章の目的

1. 自動テストの**目的と位置づけ**を理解する
2. 手動テストと自動テストの**役割の違い**を整理する
3. **継続的検証（Continuous Verification）**という考え方を学ぶ
4. 「品質保証＝スピードの敵ではない」ことを体感する

---

## 🧩 1. なぜ自動テストが必要なのか？

📘 手動テストでは、規模が大きくなるほど限界が見えてきます。

| 手法    | 特徴        | 限界             |
| ----- | --------- | -------------- |
| 手動テスト | 柔軟で理解しやすい | 繰り返しに弱い・時間がかかる |
| 自動テスト | 再現性が高く高速  | 初期構築コストがかかる    |

💡 近年のマイクロサービス開発では、
1日数十回のデプロイや複数チームの同時開発が当たり前になりました。

人の操作で全確認するのは不可能。
だからこそ「**テストをコードとして持つ**」＝自動テストが必須になります。

---

## 🧩 2. 自動テストの３つの目的

📘 自動化の目的は単なる「省力化」ではありません。
テストを自動化する理由は次の３つに集約されます。

| 目的        | 内容                    |
| --------- | --------------------- |
| 品質の安定     | 変更しても壊れないことを素早く確認     |
| 開発スピードの維持 | 手戻りを最小化して継続的デリバリを可能に  |
| チーム間の共通理解 | 「テストが仕様書になる」ことで暗黙知を共有 |

💡 自動テストは**開発文化そのもの**を変える。

> 「壊さないように開発する」から「壊れてもすぐ直せる」へ。

---

## 🧩 3. 自動テストの分類（４階層モデル）

📘 自動テストには目的に応じた４つのレイヤがあります。
どれか１つではなく、**組み合わせて全体品質を守る**構造です。

　① ユニットテスト（Unit Test）
　　─ 関数・クラス単位のロジック検証（pytestなど）

　② 統合テスト（Integration Test）
　　─ モジュール間の連携確認（DBやAPI連携など）

　③ 契約テスト（Contract Test）
　　─ サービス間APIの仕様整合チェック

　④ E2Eテスト（End-to-End Test）
　　─ 実シナリオを通した全体動作確認

💡 原則：「**下層を厚く、上層を薄く**」
→ ユニットテストを多数・高速に、E2Eは代表ケースに限定。

---

## 🧩 4. テストの自動実行タイミング

📘 自動テストは、単に“自動化する”だけでなく、
**いつ・どこで**実行するかが品質に大きく影響します。

💡 一般的な実行ポイント：

| タイミング       | 実行されるテスト    | 主な目的       |
| ----------- | ----------- | ---------- |
| コミット時       | ユニットテスト     | 変更ミスの早期検知  |
| プルリク時       | 統合テスト・契約テスト | 他開発者との整合確認 |
| ステージングデプロイ時 | E2Eテスト      | 本番直前の安全確認  |
| 本番監視中       | ヘルステスト      | 稼働状態の自動監視  |

📘 これらを自動的に連携させる仕組みが「**CI/CDパイプライン**」です。
（詳細は第6章で扱います。）

---

## 🧩 5. 自動テスト導入の障壁と克服法

📘 自動化を導入するとき、多くのチームが共通して直面する課題があります。

| 課題        | 内容              | 対応策                |
| --------- | --------------- | ------------------ |
| 初期工数が大きい  | テストコード整備に時間がかかる | まずユニットテストから段階的に導入  |
| メンテナンスが大変 | 仕様変更でテストが壊れる    | テストを仕様の一部とみなす文化づくり |
| 環境依存が強い   | DBや外部APIに左右される  | モック／スタブ／コンテナで再現性確保 |

💡 重要なのは「完璧な自動化を最初から目指さないこと」。
小さな範囲から始めて、**壊れたらすぐ直す文化**を育てるのが鍵です。

---

## 🧩 6. 「テストはコスト」ではなく「資産」

📘 テストコードは一度書けば何百回でも再利用できます。
しかも、将来の新人エンジニアがコードを理解するための
**動く仕様書**として機能します。

💡 見方を変えると：

> 手動テストは「消耗品」
> 自動テストは「資産」

📘 そしてその資産は、CI/CDの中で何度でも活かされます。

---

## 🧩 7. 継続的検証（Continuous Verification）

📘 自動化のゴールは「常にテストが走っている状態」。
コードが更新されるたびに、CIが即座に全テストを実行し、
結果をチーム全体にフィードバックします。

💡 継続的検証とは：

> “常に動作保証されている状態を保つ” という文化。
> デプロイの瞬間に安心できる仕組み。

📘 これにより、リリースの頻度が上がっても品質が下がらない。
**「品質とスピードの両立」**が実現します。

---

## ✅ まとめ

| 要点       | 内容                                  |
| -------- | ----------------------------------- |
| 自動テストの目的 | 品質保証・スピード維持・知識共有                    |
| ４階層構造    | Unit / Integration / Contract / E2E |
| タイミング    | コミット〜運用まで自動で検証                      |
| 導入の壁     | 段階的導入・文化として定着                       |
| 本質       | 自動テスト＝継続的な品質資産                      |

---

## 🔜 次章予告：「第2章　ユニット〜E2Eまでの自動化戦略」

次章では、テストを「どこまで・どう自動化するか」を具体的に設計します。
pytest、Docker、Playwright、そして契約テストの配置まで、
**自動化ピラミッドを現場レベルで構築する方法**を学びます。


