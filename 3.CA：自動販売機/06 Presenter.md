# 06 Presenter

# ğŸ¨ Presenter
### `vending_machine/interface_adapters/presenter.py`

UIå´ã®ã‚¢ãƒ€ãƒ—ã‚¿ãƒ¼ã®ã†ã¡ã€ã¾ãšã¯ `Presenter` ã‚’è§£èª¬ã—ã¾ã™ã€‚
`Presenter` ã¯ã€`UseCase` ã®å®Ÿè¡Œçµæœã‚’ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ã›ã‚‹å½¢ã¾ã§â€œç¿»è¨³â€ã™ã‚‹æ‹…å½“ã§ã™ã€‚

* UseCase ã¯ã€Œäº‹å®Ÿï¼ˆå•†å“åãƒ»ãŠé‡£ã‚Šãªã©ï¼‰ã€ã‚’è¿”ã™
* Presenter ã¯ã€ãã‚Œã‚’ã€Œä¼ãˆã‚‹æ–‡ç« ã€ã«ã™ã‚‹
* View ã¯ã€PresenterãŒæ•´ãˆãŸè¡¨ç¤ºç”¨ãƒ‡ãƒ¼ã‚¿ã‚’ç”»é¢ã«å‡ºã™ã ã‘

ã“ã®åˆ†æ¥­ã«ã‚ˆã£ã¦ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨è¡¨ç¤ºãƒ­ã‚¸ãƒƒã‚¯ãŒå®Œå…¨ã«åˆ†é›¢ã•ã‚Œã¾ã™ã€‚

![ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.png)

---

## ğŸ¯ Presenter ã®å½¹å‰²

`VendingMachinePresenter` ã¯ã€`UseCase` ã‹ã‚‰å—ã‘å–ã£ãŸçµæœï¼ˆ`SelectItemOutputData`ï¼‰ã‚’ã‚‚ã¨ã«ã€
ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã¨ã£ã¦ã‚ã‹ã‚Šã‚„ã™ã„è¡¨ç¤ºç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ„ã¿ç«‹ã¦ã€
`ViewModel` ã«åæ˜ ã—ã¾ã™ã€‚

ã“ã“ã§å¤§äº‹ãªã®ã¯ï¼š

* UseCaseã¯ã€ŒãŠé‡£ã‚Š30å††ã€ã¨ã„ã†â€œæ•°å­—ã®äº‹å®Ÿâ€ã—ã‹çŸ¥ã‚‰ãªã„
* ç”»é¢ã®æ–‡è¨€ï¼ˆã€ŒãŠé‡£ã‚Šã¯30å††ã§ã™ã€‚ã€ãªã©ï¼‰ã¯ Presenter ãŒæ±ºã‚ã‚‹
* View ã¯ Presenter ãŒç”¨æ„ã—ãŸæ–‡å­—åˆ—ã‚’ãã®ã¾ã¾å‡ºã™ã ã‘ã«ã™ã‚‹

ğŸ‘‰ ã“ã‚Œã«ã‚ˆã£ã¦ã€ŒUIã®è¨€ã„å›ã—ã‚’å¤‰ãˆãŸã„ã‹ã‚‰UseCaseã‚’æ›¸ãæ›ãˆã‚‹ã€ã¨ã„ã†åœ°ç„ã‹ã‚‰è§£æ”¾ã•ã‚Œã¾ã™ã€‚

---

## âœ… Presenterã«æ›¸ãã¹ãã“ã¨ / æ›¸ã„ã¦ã¯ã„ã‘ãªã„ã“ã¨

â­• Presenterã«å«ã‚ã‚‹ã¹ãã“ã¨

* `SelectItemOutputBoundary`ï¼ˆUseCaseãŒæœŸå¾…ã™ã‚‹â€œå‡ºåŠ›ã®ç›¸æ‰‹â€ï¼‰ã®å®Ÿè£…
* `SelectItemOutputData` â†’ `VendingMachineViewModel` ã¸ã®å¤‰æ›
* è¡¨ç¤ºç”¨ã®ç´°ã‹ã„ãƒ­ã‚¸ãƒƒã‚¯
  ä¾‹ï¼šã€ŒãŠé‡£ã‚ŠãŒ0å††ãªã‚‰ã€ãŠé‡£ã‚Šãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã¯æ›¸ã‹ãªã„ã€ãªã©

âŒ Presenterã«å«ã‚ã¦ã¯ã„ã‘ãªã„ã“ã¨

* ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®åˆ¤æ–­
  ï¼ˆã€Œã“ã®å•†å“ã¯å£²ã£ã¦ã„ã„ã‹ï¼Ÿã€ã¯UseCaseã‚„Entityã§æ±ºã¾ã£ã¦ã„ã‚‹ï¼‰
* ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢åˆ¶å¾¡ï¼ˆãã‚Œã¯HardwareAdapterã®å½¹å‰²ï¼‰
* ç›´æ¥ print() ãªã©ã®ç”»é¢å‡ºåŠ›ï¼ˆãã‚Œã¯Viewã®å½¹å‰²ï¼‰

> ğŸ¤ Presenter ã¯ã€Œè¡¨ç¤ºç”¨ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ä½œã‚‹ã¨ã“ã‚ã¾ã§ã€ã€‚
> ãã‚Œã‚’å®Ÿéš›ã«ã©ã“ã«å‡ºã™ã‹ã¯ View ã®ä»•äº‹ã€‚

## ğŸ’» ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ
```text
vending_machine/
â”œâ”€ domain/
â”‚   â”œâ”€ entities.py          # Item, PaymentManager ãªã©
â”‚   â”œâ”€ errors.py            # ãƒ‰ãƒ¡ã‚¤ãƒ³ãƒ«ãƒ¼ãƒ«é•åä¾‹å¤–
â”‚
â”œâ”€ usecase/
â”‚   â”œâ”€ dto.py               # InputData / OutputData / ViewModel
â”‚   â”œâ”€ boundaries.py        # UseCaseãŒå¤–éƒ¨ã¨ã‚„ã‚Šå–ã‚Šã™ã‚‹å¥‘ç´„
â”‚   â”œâ”€ insert_coin_usecase.py
â”‚   â””â”€ select_item_usecase.py
â”‚
â”œâ”€ interface_adapters/
â”‚   â”œâ”€ controller.py        # Controllerï¼ˆå…¥åŠ›å—ä»˜ï¼‰
â”‚   â”œâ”€ presenter.py         # Presenterï¼ˆå‡ºåŠ›æ•´å½¢ï¼‰    <- ã„ã¾ã“ã“
â”‚   â”œâ”€ view_console.py      # CLIã§ã®å‹•ä½œç¢ºèª
â”‚   â”œâ”€ data_access.py       # åœ¨åº«ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¤ãƒ³ãƒ¡ãƒ¢ãƒªå®Ÿè£…
â”‚   â””â”€ hardware_adapter.py  # ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢æ“ä½œã®ã‚³ãƒ³ã‚½ãƒ¼ãƒ«ç‰ˆå®Ÿè£…
â”‚
â””â”€ main.py                  # Composition Rootï¼ˆå…¨é…ç·šï¼‰

```

## ğŸ’» ã‚³ãƒ¼ãƒ‰ï¼ˆ`presenter.py`ï¼‰

```python
# vending_machine/interface_adapters/presenter.py

# UseCaseãŒå®šç¾©ã—ãŸã€Œå‡ºåŠ›å…ˆã®å¥‘ç´„ã€ã¨ã€Œã‚„ã‚Šã¨ã‚Šã™ã‚‹ãƒ‡ãƒ¼ã‚¿å‹ã€ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from vending_machine.usecase.boundaries import SelectItemOutputBoundary
from vending_machine.usecase.dto import (
    SelectItemOutputData,
    VendingMachineViewModel,
)


# -----------------------------------------------------------------------------
# VendingMachinePresenter
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: Presenter
# - åŒå¿ƒå††å›³ã®ä½ç½®: interface_adaptersï¼ˆå¤–å´ã®å††ï¼‰
#
# ã“ã®ã‚¯ãƒ©ã‚¹ã¯ UseCase ã®çµæœã‚’ã€View ãŒãã®ã¾ã¾è¡¨ç¤ºã§ãã‚‹å½¢ã«æ•´ãˆã‚‹ã€‚
# -----------------------------------------------------------------------------
class VendingMachinePresenter(SelectItemOutputBoundary):
    """
    UseCaseã®ã€Œå‡ºåŠ›å…ˆã€ã¨ã—ã¦å‘¼ã³å‡ºã•ã‚Œã‚‹å½¹ã€‚
    å½¹å‰²ã¯ã€ãƒ“ã‚¸ãƒã‚¹çµæœ(SelectItemOutputData)ã‚’
    ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®æ–‡è¨€(ViewModel)ã«å¤‰æ›ã—ã¦ä¿æŒã™ã‚‹ã“ã¨ã€‚
    """

    def __init__(self, view_model: VendingMachineViewModel):
        """
        [çŠ¶æ…‹ã®æ³¨å…¥ / å…±æœ‰]

        Presenterã¯ ViewModel ã‚’ä¿æŒã—ã¾ã™ã€‚
        ã“ã® ViewModel ã¯ View ã¨å…±æœ‰ã•ã‚Œã¦ãŠã‚Šã€
        PresenterãŒæ›¸ãæ›ãˆã‚‹ã¨ View ã¯æœ€æ–°ã®è¡¨ç¤ºå†…å®¹ã‚’èª­ã‚ã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

        ã“ã“ã§æ¸¡ã•ã‚Œã‚‹ view_model ã¯ã€Œè¡¨ç¤ºç”¨ã®çŠ¶æ…‹ã®å…¥ã‚Œç‰©ã€ã§ã™ã€‚
        """
        self._view_model = view_model

    def present(self, output_data: SelectItemOutputData):
        """
        [ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£… / OutputBoundaryã®å®Ÿä½“]

        UseCase ã‹ã‚‰å‘¼ã³å‡ºã•ã‚Œã‚‹ãƒ¡ã‚½ãƒƒãƒ‰ã€‚
        ã€Œè³¼å…¥å‡¦ç†ã®çµæœã€ã‚’ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«è¦‹ã›ã‚‹æ–‡ç« ã¨ã—ã¦çµ„ã¿ç«‹ã¦ã€
        ViewModelã«åæ˜ ã™ã‚‹ã€‚

        output_data:
            UseCaseãŒè¿”ã—ã¦ããŸâ€œäº‹å®Ÿã ã‘â€ã®ãƒ‡ãƒ¼ã‚¿
              - item_name: å‡ºã—ãŸå•†å“åï¼ˆä¾‹: "ãŠèŒ¶"ï¼‰
              - change:    è¿”å´ã—ãŸãŠé‡£ã‚Šã®é‡‘é¡ï¼ˆä¾‹: 30ï¼‰
        """

        # 1. ãƒ™ãƒ¼ã‚¹ã¨ãªã‚‹ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’çµ„ã¿ç«‹ã¦ã‚‹
        message = f"ã€Œ{output_data.item_name}ã€ãŒå‡ºã¦ãã¾ã—ãŸã€‚"

        # 2. ãŠé‡£ã‚ŠãŒã‚ã‚‹ã¨ãã ã‘ã€è¿½è¨˜ã™ã‚‹
        #    ã€ŒãŠé‡£ã‚Šã¯0å††ã§ã™ã€‚ã€ã®ã‚ˆã†ãªä¸è¦ãªæ–‡è¨€ã¯é¿ã‘ãŸã„ã®ã§
        #    ã“ã®åˆ†å²ã¯ Presenter ã®è²¬å‹™ã«ãªã‚Šã¾ã™ã€‚
        if output_data.change > 0:
            message += f" ãŠé‡£ã‚Šã¯{output_data.change}å††ã§ã™ã€‚"

        # 3. ViewModelã‚’æ›´æ–°ã™ã‚‹
        #    Viewã¯ã“ã®ViewModelã‚’è¦‹ã¦è¡¨ç¤ºã™ã‚‹ã ã‘ã§ã‚ˆã„
        self._view_model.display_text = message
```

---

## ğŸ” ã‚³ãƒ¼ãƒ‰è§£èª¬ã®ãƒã‚¤ãƒ³ãƒˆ

### 1. `class VendingMachinePresenter(SelectItemOutputBoundary):`

ã“ã®ç¶™æ‰¿ãŒå®£è¨€ã—ã¦ã„ã‚‹ã®ã¯ã“ã†ã„ã†ã“ã¨ã§ã™ğŸ‘‡
ã€Œç§ã¯UseCaseãŒæœŸå¾…ã™ã‚‹â€œå‡ºåŠ›å…ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆOutputBoundaryï¼‰â€ã‚’æº€ãŸã—ã¾ã™ã€

UseCaseã¯ `SelectItemOutputBoundary` å‹ã¨ã—ã¦ Presenter ã«ä¾å­˜ã™ã‚‹ã®ã§ã€
ã€Œèª°ãŒç”»é¢ã«å‡ºã™ã‹ã€ã‚’çŸ¥ã‚‰ãªãã¦ã‚‚ä»•äº‹ã§ãã¾ã™ã€‚
ï¼ˆCLIç”¨Presenterã§ã‚‚ã€Webç”¨Presenterã§ã‚‚OKã«ãªã‚‹ï¼‰

ã“ã‚ŒãŒä¾å­˜æ€§é€†è»¢ã®åŠ›ã€‚

---

### 2. `present()` ã®ä¸­ã§ã¯â€œè¡¨ç¤ºç”¨ãƒ­ã‚¸ãƒƒã‚¯â€ã ã‘ã‚„ã‚‹

ã“ã“ã§ã¯ã€ŒãŠé‡£ã‚ŠãŒ0å††ãªã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«æ›¸ã‹ãªã„ã€ã¨ã„ã£ãŸã€
äººé–“ã«ã¨ã£ã¦èª­ã¿ã‚„ã™ã„è¡¨ç¾ã®åˆ†å²ã‚’ã‚„ã£ã¦ã„ã¾ã™ã€‚

ã“ã‚Œã¯**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã§ã¯ãªã„**ã®ã§ã€Entityã‚„UseCaseã«å…¥ã‚Œã‚‹ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚
ã“ã®ãƒ¬ã‚¤ãƒ¤ãƒ¼ã«ã‚ã‚‹ã¹ããƒ­ã‚¸ãƒƒã‚¯ã§ã™ã€‚

---

### 3. `self._view_model.display_text = ...`

Presenterã¯æœ€çµ‚çš„ãªãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ ViewModel ã«æ›¸ãè¾¼ã¿ã¾ã™ã€‚
View ã¯ãŸã ãã‚Œã‚’èª­ã‚€ã ã‘ã§ã‚ˆããªã‚Šã¾ã™ã€‚

â†’ Viewå´ã®è²¬å‹™ãŒã€Œç”»é¢ã«å‡ºã™ã€ã ã‘ã«ãªã‚Šã€ã‚ã£ã¡ã‚ƒè–„ããªã‚‹
â†’ ã‚³ãƒ³ã‚½ãƒ¼ãƒ«UIã§ã‚‚GUIã§ã‚‚Webã§ã‚‚ã€Viewã‚’å·®ã—æ›¿ãˆã‚‹ã ã‘ã§å†åˆ©ç”¨ã§ãã‚‹

---

## ğŸ§ª Presenterã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

Presenterå˜ä½“ã®ãƒ†ã‚¹ãƒˆã¯ã¨ã¦ã‚‚ã‚„ã‚Šã‚„ã™ã„ã§ã™ã€‚
ãªãœãªã‚‰ã€ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã«ã‚‚DBã«ã‚‚ä¾å­˜ã›ãšã€ã€Œæ–‡å­—åˆ—ã‚’ã©ã†ä½œã‚‹ã‹ã€ã ã‘ã‚’è¦‹ã‚‹ã‹ã‚‰ã€‚

```python
# tests/interface_adapters/test_presenter.py

from vending_machine.usecase.dto import (
    SelectItemOutputData,
    VendingMachineViewModel,
)
from vending_machine.interface_adapters.presenter import VendingMachinePresenter


def test_ãŠé‡£ã‚ŠãŒã‚ã‚‹å ´åˆ_ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãŠé‡£ã‚ŠãŒå«ã¾ã‚Œã‚‹():
    # 1. Arrange (æº–å‚™)
    view_model = VendingMachineViewModel()
    output_data = SelectItemOutputData(item_name="ãŠèŒ¶", change=30)

    presenter = VendingMachinePresenter(view_model)

    # 2. Act (å®Ÿè¡Œ)
    presenter.present(output_data)

    # 3. Assert (æ¤œè¨¼)
    expected = "ã€ŒãŠèŒ¶ã€ãŒå‡ºã¦ãã¾ã—ãŸã€‚ ãŠé‡£ã‚Šã¯30å††ã§ã™ã€‚"
    assert view_model.display_text == expected


def test_ãŠé‡£ã‚ŠãŒã‚¼ãƒ­ã®å ´åˆ_ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãŠé‡£ã‚Šã¯å«ã¾ã‚Œãªã„():
    # 1. Arrange
    view_model = VendingMachineViewModel()
    output_data = SelectItemOutputData(item_name="ã‚³ãƒ¼ãƒ’ãƒ¼", change=0)

    presenter = VendingMachinePresenter(view_model)

    # 2. Act
    presenter.present(output_data)

    # 3. Assert
    expected = "ã€Œã‚³ãƒ¼ãƒ’ãƒ¼ã€ãŒå‡ºã¦ãã¾ã—ãŸã€‚"
    assert view_model.display_text == expected
```

ã“ã®ãƒ†ã‚¹ãƒˆã¯ã“ã†ã„ã†ã“ã¨ã‚’ä¿è¨¼ã—ã¾ã™ï¼š

* UseCaseãŒè¿”ã—ã¦ããŸã€Œäº‹å®Ÿã®ãƒ‡ãƒ¼ã‚¿ã€ã‹ã‚‰
* PresenterãŒæ­£ã—ãã€Œãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘ã®è¨€ã„å›ã—ã€ã‚’æ§‹ç¯‰ã—ã¦ã„ã‚‹
* ViewModelãŒãã®çµæœã‚’ä¿æŒã—ã¦ã„ã‚‹

UIå¤‰æ›´ã«å¼·ã„è¨­è¨ˆã€ã¨ã„ã†ã®ã¯ã“ã†ã—ã¦è¨¼æ˜ã§ãã¾ã™ã€‚

---

## ğŸ Python ã¨ ğŸ”§ Cè¨€èªã®ã‚¤ãƒ¡ãƒ¼ã‚¸æ¯”è¼ƒ

* ğŸ Pythonï¼ˆã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ / ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼‰
  Presenterã¯ã€Œæ–‡å­—åˆ—ã«æ•´ãˆã‚‹ã€ã“ã¨ã«å°‚å¿µã—ã€Viewã«æ¸¡ã™æœ€çµ‚å½¢ã‚’è²¬ä»»ã‚‚ã£ã¦ä½œã‚‹ã‚¯ãƒ©ã‚¹ã¨ã—ã¦å®šç¾©ã•ã‚Œã‚‹ã€‚

* ğŸ”§ Cè¨€èªã§ã‚ˆãã‚ã‚‹ãƒ‘ã‚¿ãƒ¼ãƒ³

  * `render_message()` ã®ã‚ˆã†ãªé–¢æ•°ãŒç›´æ¥ `printf()` ã¾ã§ã‚„ã£ã¦ã—ã¾ã„ãŒã¡
  * ã¤ã¾ã‚Šã€Œãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®çµ„ã¿ç«‹ã¦ã€ã¨ã€Œç”»é¢ã¸ã®å‡ºåŠ›ã€ãŒãã£ã¤ãã‚„ã™ã„
  * ãã®çµæœã€ç”»é¢è¡¨ç¤ºã®ä»•æ§˜å¤‰æ›´ï¼ãƒ­ã‚¸ãƒƒã‚¯å…¨ä½“ã®æ”¹ä¿®ã«ãªã‚Šã‚„ã™ã„

Presenterã‚’åˆ†ã‘ã‚‹ã“ã¨ã§ã€ã€Œã©ã†è¦‹ã›ã‚‹ã‹ã€ã¯ã„ã¤ã§ã‚‚å®‰å…¨ã«å·®ã—æ›¿ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ›¡ï¸ Presenterå±¤ã®é‰„å‰‡

> è¡¨ç¤ºã®ãŸã‚ã«ç¿»è¨³ã›ã‚ˆã€ãŸã ã—ãƒ“ã‚¸ãƒã‚¹ã‚’èªã‚‹ãªã€‚
> (Translate for presentation, but don't speak business.)

* Presenterã¯ã€Userã«è¦‹ã›ã‚‹â€œã“ã¨ã°â€ã‚’æ±ºã‚ã‚‹å ´æ‰€ã€‚
* UseCaseã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã«å£å‡ºã—ã—ãªã„ã€‚
* Viewã¸ã®æœ€çµ‚çš„ãªå—ã‘æ¸¡ã—ã‚’ã€ãã‚Œã„ãªå½¢ã«æ•´ãˆã‚‹ã€‚

ã“ã‚Œã§ã€UIã¯ä½•åº¦ã§ã‚‚ä½œã‚Šå¤‰ãˆã‚‰ã‚Œã‚‹ã‚ˆã†ã«ãªã‚Šã¾ã™ã€‚
CLIã§ã‚‚ã€Webã§ã‚‚ã€ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ä»˜ãè‡ªè²©æ©Ÿã§ã‚‚ã€‚

