# 04 Interface

# ğŸ”Œ Interfaces / Boundaries : application/boundaries.py

`UseCase`ãŒä»•äº‹ã‚’ä¾é ¼ã™ã‚‹ç›¸æ‰‹ã¨ã®ã€Œå¥‘ç´„æ›¸ã€ã«ã‚ãŸã‚‹ã€`boundaries.py` (Interfaces / Boundaries) ã‚’è§£èª¬ã—ã¾ã™ã€‚

## ğŸ¯ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã®å½¹å‰²

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€`UseCase`ã¨å¤–å´ã®å±¤ï¼ˆ`Adapters`ï¼‰ã¨ã®é–“ã®ã€Œå¥‘ç´„ã€ã‚’å®šç¾©ã™ã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é›†ã‚ãŸã‚‚ã®ã§ã™ã€‚

`UseCase`ã¯ã€å…·ä½“çš„ãª`Presenter`ã‚„`DataAccess`ã€ãã—ã¦ä»Šå›ã¯`Hardware`ã®å®Ÿè£…ã‚’ç›´æ¥çŸ¥ã‚‹ä»£ã‚ã‚Šã«ã€ã“ã“ã§å®šç¾©ã•ã‚ŒãŸæŠ½è±¡çš„ãªã€Œå¥‘ç´„æ›¸ã€ã«ã®ã¿ä¾å­˜ã—ã¾ã™ã€‚

ç‰¹ã«çµ„ã¿è¾¼ã¿ã‚·ã‚¹ãƒ†ãƒ ã§ã¯ã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã¨ç‰©ç†çš„ãªãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¨ã®é–“ã«ã“ã®ã€Œå¥‘ç´„ã€ã‚’è¨­ã‘ã‚‹ã“ã¨ãŒã€ã‚·ã‚¹ãƒ†ãƒ ã®ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã¨æŸ”è»Ÿæ€§ã‚’é£›èºçš„ã«å‘ä¸Šã•ã›ã¾ã™ã€‚

![ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.png)

## âœ… ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã«ã‚ã‚‹ã¹ãå‡¦ç†

â­•ï¸ å«ã‚ã‚‹ã¹ãå‡¦ç†ã®ä¾‹:

- æŠ½è±¡ã‚¯ãƒ©ã‚¹ (`ABC`) ã¨ æŠ½è±¡ãƒ¡ã‚½ãƒƒãƒ‰ (`@abstractmethod`) ã®å®šç¾©ã®ã¿ã€‚

âŒ å«ã‚ã¦ã¯ã„ã‘ãªã„å‡¦ç†ã®ä¾‹:

- ãƒ¡ã‚½ãƒƒãƒ‰å†…ã®å…·ä½“çš„ãªãƒ­ã‚¸ãƒƒã‚¯ã®å®Ÿè£…ã€‚ã™ã¹ã¦ã®ä¸­èº«ã¯`raise NotImplementedError`ã¾ãŸã¯`pass`ã§ã‚ã‚‹ã¹ãã§ã™ã€‚

## ğŸ’» ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã®è©³ç´°è§£èª¬

```python
# application/boundaries.py
from abc import ABC, abstractmethod
from typing import Optional

# å…ˆã»ã©å®šç¾©ã—ãŸDataStructuresã¨ã€å†…å´ã®Entityã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆ
from .data_structures import SelectItemInputData, SelectItemOutputData
from domain.entities import Item, PaymentManager

# -----------------------------------------------------------------------------
# Boundaries / Interfaces (<I>)
# - åŒå¿ƒå††å›³ã®ä½ç½®: å††ã¨å††ã®å¢ƒç•Œç·šãã®ã‚‚ã®
# -----------------------------------------------------------------------------

# --------------------------------------------------------------------
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: <I>InputBoundary / <I>OutputBoundary
# --------------------------------------------------------------------
class SelectItemInputBoundary(ABC):
    @abstractmethod
    def handle(self, input_data: SelectItemInputData, payment_manager: PaymentManager):
        raise NotImplementedError

class SelectItemOutputBoundary(ABC):
    @abstractmethod
    def present(self, output_data: SelectItemOutputData):
        raise NotImplementedError

# --------------------------------------------------------------------
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: <I>DataAccessInterface
# --------------------------------------------------------------------
class ItemDataAccessInterface(ABC):
    @abstractmethod
    def find_by_slot_id(self, slot_id: str) -> Optional[Item]:
        raise NotImplementedError

    @abstractmethod
    def save(self, item: Item) -> Item:
        raise NotImplementedError

# --------------------------------------------------------------------
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: <I>HardwareInterface (DataAccessInterfaceã®ä¸€ç¨®)
# --------------------------------------------------------------------
class HardwareInterface(ABC):
    @abstractmethod
    def dispense_item(self, slot_id: str):
        """æŒ‡å®šã•ã‚ŒãŸã‚¹ãƒ­ãƒƒãƒˆã®å•†å“ã‚’ç‰©ç†çš„ã«æ’å‡ºã™ã‚‹"""
        raise NotImplementedError

    @abstractmethod
    def return_change(self, amount: int):
        """æŒ‡å®šã•ã‚ŒãŸé‡‘é¡ã®ãŠé‡£ã‚Šã‚’ç‰©ç†çš„ã«æ’å‡ºã™ã‚‹"""
        raise NotImplementedError

```

- `HardwareInterface`: ã“ã‚ŒãŒã“ã®é¡Œæã«ãŠã‘ã‚‹æœ€ã‚‚é‡è¦ãªã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§ã™ã€‚`UseCase`ã¯ã€å•†å“ã®æ’å‡ºã‚„ã‚³ã‚¤ãƒ³ã®è¿”å´ã¨ã„ã£ãŸç‰©ç†çš„ãªæ“ä½œã‚’ã€ã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é€šã˜ã¦\_æŠ½è±¡çš„ã«\_æŒ‡ç¤ºã—ã¾ã™ã€‚`UseCase`ã¯ã€ãƒ¢ãƒ¼ã‚¿ãƒ¼ã‚’ã©ã†åˆ¶å¾¡ã™ã‚‹ã‹ã€ã‚³ã‚¤ãƒ³ã‚’ã©ã†æ•°ãˆã‚‹ã‹ã€ã¨ã„ã£ãŸãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã®å…·ä½“çš„ãªä»•çµ„ã¿ã‚’ä¸€åˆ‡çŸ¥ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã›ã‚“ã€‚

## ğŸ’¡ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯å¿…è¦ï¼Ÿ

**åŸå‰‡ã¨ã—ã¦ã€ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«è‡ªä½“ã«å°‚ç”¨ã®ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã¯ä¸è¦ã§ã™ã€‚**

ãªãœãªã‚‰ã€ã“ã‚Œã‚‰ã¯ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒãŸãªã„ã€Œå®šç¾©ã€ã‚„ã€Œå¥‘ç´„æ›¸ã€ã ã‹ã‚‰ã§ã™ã€‚ãƒ†ã‚¹ãƒˆã™ã¹ãæŒ¯ã‚‹èˆã„ãŒã‚ã‚Šã¾ã›ã‚“ã€‚ã“ã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ãŒæ­£ã—ãä½¿ã‚ã‚Œã¦ã„ã‚‹ã‹ã¯ã€`UseCase`ã‚„`Presenter`ã€`Adapters`ã¨ã„ã£ãŸã€ãã‚Œã‚‰ã‚’åˆ©ç”¨ãƒ»å®Ÿè£…ã™ã‚‹å´ã®ã‚¯ãƒ©ã‚¹ã®ãƒ†ã‚¹ãƒˆã§é–“æ¥çš„ã«æ¤œè¨¼ã•ã‚Œã¾ã™ã€‚

## ğŸ Pythonã¨Cè¨€èªã®æ¯”è¼ƒï¼ˆåˆå¿ƒè€…ã®æ–¹ã¸ï¼‰

- Python (ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘): `ABC`ã‚’ä½¿ã£ã¦æŠ½è±¡ã‚¯ãƒ©ã‚¹ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã‚’æ˜ç¢ºã«å®šç¾©ã—ã€ã€Œã“ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’å®Ÿè£…ã™ã‚‹ã‚¯ãƒ©ã‚¹ã¯ã€å¿…ãš`dispense_item`ãƒ¡ã‚½ãƒƒãƒ‰ã‚’æŒãŸãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã¨ã„ã†å¥‘ç´„ã‚’ã‚³ãƒ¼ãƒ‰ã§è¡¨ç¾ã§ãã¾ã™ã€‚
- Cè¨€èª (æ‰‹ç¶šãå‹): Cè¨€èªã«ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®æ¦‚å¿µãŒã‚ã‚Šã¾ã›ã‚“ã€‚ä¼¼ãŸå½¹å‰²ã‚’æœãŸã™ã®ã¯ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ« (`.h`) ã§ã™ã€‚ãƒ˜ãƒƒãƒ€ãƒ¼ãƒ•ã‚¡ã‚¤ãƒ«ã«`void dispense_item(const char* slot_id);`ã®ã‚ˆã†ã«é–¢æ•°ã®ã‚·ã‚°ãƒãƒãƒ£ã‚’å®£è¨€ã™ã‚‹ã“ã¨ã§ã€ã€Œã“ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ã‚¤ãƒ³ã‚¯ãƒ«ãƒ¼ãƒ‰ã™ã‚Œã°ã€ã“ã®é–¢æ•°ã‚’å‘¼ã³å‡ºã›ã‚‹ã€ã¨ã„ã†ä¸€ç¨®ã®å¥‘ç´„ã‚’å®šç¾©ã—ã¾ã™ã€‚

## ğŸ›¡ï¸ ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ç¾¤ã®é‰„å‰‡

> å¥‘ç´„ã‚’å®šç¾©ã›ã‚ˆã€å®Ÿè£…ã¯ä»–ã«ä»»ã›ã‚ˆã€‚ (Define the contract, delegate the work.)
> 

ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯ã€ã‚·ã‚¹ãƒ†ãƒ ã®æŸ”è»Ÿæ€§ã¨ãƒ†ã‚¹ãƒˆå®¹æ˜“æ€§ã‚’æ”¯ãˆã‚‹åœŸå°ã§ã™ã€‚ç‰¹ã«`HardwareInterface`ãŒã‚ã‚‹ãŠã‹ã’ã§ã€ç§ãŸã¡ã¯`UseCase`ã®ãƒ†ã‚¹ãƒˆã‚’ã™ã‚‹éš›ã«ã€é«˜ä¾¡ãªå®Ÿæ©Ÿã‚„è¤‡é›‘ãªã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚¿ãƒ¼ã‚’ç”¨æ„ã™ã‚‹ã“ã¨ãªãã€å˜ç´”ãªå½ç‰©ï¼ˆãƒ¢ãƒƒã‚¯ï¼‰ã‚’å·®ã—è¾¼ã‚€ã ã‘ã§ãƒ­ã‚¸ãƒƒã‚¯ã‚’100%æ¤œè¨¼ã§ãã¾ã™ã€‚