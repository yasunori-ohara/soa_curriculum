# 03 Data Structures

# ✉️ Data Structures : application/data_structures.py

`UseCase`が仕事を円滑に進めるために要求した「公式な書類」である、`Data Structures`について解説します。

## 🎯 このファイルの役割

このファイルに集められたクラス群は、レイヤーの境界を越えてデータを運ぶためだけの、単純なデータコンテナ（運び屋）です。

`Controller`から`UseCase`へ、`UseCase`から`Presenter`へといった情報の受け渡しの際に、これらの公式に定められた構造を持つオブジェクトを使うことで、各レイヤー間の結合を疎（そ）に保ちます。

`UseCase`は、この「公式書類」の形式さえ守られていれば、誰がそれを作成したか（`Controller`の実装の詳細）を気にする必要がなくなります。

![クリーンアーキテクチャ](../クリーンアーキテクチャ.png)

## ✅ このファイルにあるべき処理

⭕️ 含めるべき処理の例:

- 運搬するデータフィールド（属性）の定義のみ。

❌ 含めてはいけない処理の例:

- ビジネスロジック、計算、バリデーションなど、いかなるロジックも含めてはいけません。

## 💻 ソースコードの詳細解説

```python
# application/data_structures.py
from dataclasses import dataclass

# -----------------------------------------------------------------------------
# Data Structures (<DS>)
# - 同心円図の位置: 円と円の境界線上を流れるデータ
# -----------------------------------------------------------------------------

# --------------------------------------------------------------------
# - クラス図の位置: <DS>InputData
# --------------------------------------------------------------------
@dataclass(frozen=True)
class SelectItemInputData:
    """Controller -> UseCase へ渡すデータ構造"""
    slot_id: str

# --------------------------------------------------------------------
# - クラス図の位置: <DS>OutputData
# --------------------------------------------------------------------
@dataclass(frozen=True)
class SelectItemOutputData:
    """UseCase -> Presenter へ渡すデータ構造"""
    item_name: str
    change: int

# --------------------------------------------------------------------
# - クラス図の位置: <DS>ViewModel
# --------------------------------------------------------------------
@dataclass
class VendingMachineViewModel:
    """Presenter -> View へ渡すデータ構造（画面表示用）"""
    display_text: str = ""

```

- `@dataclass(frozen=True)InputData`と`OutputData`をイミュータブル（変更不可）にする設定です。一度インスタンスが作成されると、その中身を変更しようとするとエラーになります。これにより、データが意図せず途中で書き換えられてしまう事故を防ぎ、システムの安全性を高めます。
- `SelectItemInputData`: どの商品が選ばれたかを`slot_id`で伝えます。
- `SelectItemOutputData`: 処理の結果として、排出された商品名（`item_name`）とお釣り（`change`）を`Presenter`に伝えます。
- `VendingMachineViewModel`: `Presenter`から`View`へ渡される、画面の状態を表すデータです。`Presenter`によって状態が更新されるため、こちらは変更可能（ミュータブル）な`frozen=False`（デフォルト）のままにしています。

## 💡 ユニットテストは必要？

**原則として、このファイル自体に専用のユニットテストは不要です。**

なぜなら、これらはロジックを持たない「定義」そのものだからです。テストすべき振る舞いがありません。これらのデータ構造が正しく使われているかは、`UseCase`や`Presenter`など、それらを利用する側のクラスのテストで間接的に検証されます。

## 🐍 PythonとC言語の比較（初心者の方へ）

- Python (オブジェクト指向): `dataclass`のような機能を使って、データ構造を簡潔かつ明確にクラスとして定義できます。
- C言語 (手続き型): `struct`（構造体）がこの役割を担います。`struct SelectItemInputData { char* slot_id; };` のように定義し、データの入れ物として利用します。ロジックを持たない単純なデータの入れ物、という点では非常に似ています。

## 🛡️ このクラス群の鉄則

> ただ運び、何も考えるな。 (Just carry, don't think.)
> 

これらのクラスの唯一の責務はデータ保持です。ロジックの追加は固く禁じられています。