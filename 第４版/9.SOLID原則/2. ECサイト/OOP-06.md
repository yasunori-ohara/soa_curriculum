# OOP-06 : 答え合わせ - CAはSOLID原則を解決したか？

`OOP-05`で、リファクタリング担当者（Aさん）は、`OOP-01`の「神クラス（`Store`）」を、彼が知っているクリーンアーキテクチャ（CA）の「型」（関心の分離、依存性のルール）に従って見事に分離・再構築しました。

AさんはSOLID原則（SRP, DIPなど）のことは一切口にしませんでした。

では、Aさんが行ったリファクタリングの結果（`OOP-05`のコード）を、`OOP-02`で私たちが評価した**SOLID原則**の観点から、もう一度「健康診断」してみましょう。

## 🎯 この章のゴール

* CAの「型」に従ったリファクタリングが、SOLID原則の違反をどのように解決したかを理解する。
* **「CAの"型"に当てはめること」と「SOLID原則を適用すること」が、ほぼ同義である**ことに気づく。

---

## 🛠️ 1. S: 単一責任の原則 (SRP)

* **`OOP-02`での違反**:
    `Store`（神クラス）は、「注文処理（ユースケース）」「商品保存（インフラ）」「注文保存（インフラ）」という**3つの異なる責任**を持っていました。

* **`OOP-05`での結果**:
    AさんはCAの「**関心の分離**」という"型"に従いました。
    その結果、`Store`は消滅し、3つの責任は**3つの異なるクラス**に分離されました。
    * 責任C (ユースケース): `ProcessOrderUseCase` (`application.py`)
    * 責任A (商品保存): `InMemoryProductRepository` (`infrastructure.py`)
    * 責任B (注文保存): `InMemoryOrderRepository` (`infrastructure.py`)

    各クラスは「変更する理由」を一つだけ持つようになりました。

* **評価**: 🏆 **達成！**
    **（謎解き）**: Aさんは「SRPを達成しよう」とは考えていませんでした。彼はただ「CAの"型"に従って、ユースケースとインフラを分離した」だけです。しかし、CAの「関心の分離」というルールは、**SRPをアーキテクチャレベルで実践するための具体的なパターン**だったのです。

---

## 🛠️ 2. D: 依存性逆転の原則 (DIP)

* **`OOP-02`での違反**:
    `Store`（高レベルなユースケース）が、`self._products = {}`（低レベルなインフラ実装）に**直接依存**していました。

* **`OOP-05`での結果**:
    AさんはCAの「**依存性のルール**」という"型"に従いました。
    その結果、`ProcessOrderUseCase`（高レベル）は、`InMemory...`（低レベル）の具象クラスを一切知らなくなりました。

    `UseCase`（高レベル）は`IRepository`（**抽象**）に依存し、`Infrastructure`（低レベル）も`IRepository`（**抽象**）に依存（実装）する形になりました。

    

* **評価**: 🏆 **達成！**
    **（謎解き）**: Aさんは「DIPを達成しよう」とは考えていませんでした。彼はただ「CAの"型"に従って、依存関係が必ず内側（抽象）を向くように」インターフェース（`application_boundaries.py`）を定義しただけです。しかし、CAの「依存性のルール」は、**DIPをアーキテクチャ全体で強制するための設計パターン**そのものだったのです。

---

## 🛠️ 3. O/L/I: その他の原則

* **OCP（オープン・クローズドの原則）**:
    `OOP-01`のポリモーフィズム活用（`IProduct`）が達成していた長所は、CAのリファクタリングを経ても**維持されました**。`ProcessOrderUseCase`は、今でも`IProduct`（抽象）に依存しており、「予約商品」の追加（拡張）に対して「修正」は不要です。

* **LSP（リスコフの置換原則）**:
    OCP同様、`OOP-01`の長所が維持されています。

* **ISP（インターフェース分離の原則）**:
    `application_boundaries.py`で定義した各インターフェース（`IProductRepository`など）は、`find_by_id`, `save` のように、それぞれの責任に特化した「痩せた」インターフェースになっています。ISPも達成されています。

---

## ✨ 結論：私たちが学んだこと

このリファクタリングの旅（`OOP-01`〜`OOP-06`）で、私たちは以下の重要な事実に気づきました。

> **クリーンアーキテクチャ（CA）とは、SOLID原則、特にSRPとDIPを、アーキテクチャレベルで実践・強制するための、非常に洗練された「型（パターン）」である。**

SOLID原則は「**どうあるべきか**」という**原則（Principles）**を教えてくれます。
クリーンアーキテクチャは「**どうやるのか**」という**実践（Practices）**を教えてくれます。

`OOP-01`のコードは、「なぜ」SRPやDIPが重要なのかが分かりにくかったかもしれません。
しかし、CAの「型」に従ってリファクタリングを行った結果、私たちは**SOLID原則が自然と守られた、変更に強いコード**を手に入れることができました。

