# 00 はじめに

# 🏛️ DDD 実践編：既存コードのリファクタリング はじめに

これまでの演習（CA, SOA, DDDパターン連携例）を通じて、私たちは「良い設計」の原則やパターンを学んできました。しかし、実際の開発現場では、常にゼロから理想的な設計を始められるわけではありません。多くの場合、既存のコードベースに対して機能追加や修正を行っていくことになります。

このセクションでは、**ドメイン駆動設計 (DDD)** の考え方とパターンを、**既存のコード（今回は第2巡で扱った図書館システムを想定）に適用して改善する**「リファクタリング」の実践演習を行います。

---

## 🎯 この演習のゴール

- 既存のコード（DDDを意識せずに書かれたもの）を分析し、DDDの視点から改善点を発見できるようになる。
- DDDの戦術的パターン（値オブジェクト、エンティティ、集約、リポジトリなど）を、具体的なリファクタリングテクニックとして適用できるようになる。
- リファクタリングを通じて、コードがドメイン（ビジネス）の構造やルールをより正確に、より分かりやすく表現するように改善される効果を体験する。
- 理論で学んだDDDのパターンが、実際のコード品質向上にどう貢献するかを実感する。

---

## 🧭 なぜリファクタリングで学ぶのか？

1. **Before/Afterの比較**:
既存コード（Before）と、DDDパターンを適用して改善したコード（After）を比較することで、各パターンの効果や利点がより具体的に理解できます。
2. **実践的なスキル**:
ゼロから設計するスキルも重要ですが、既存コードを理解し、段階的に改善していくリファクタリングのスキルは、現実の開発現場で非常に役立ちます。
3. **ドメイン理解の深化**:
リファクタリングを行う過程で、「このコードは本来どのようなビジネスルールを表現しようとしていたのか？」とドメインについて深く考える機会が得られます。これは、ドメインモデリング（戦略的設計）の練習にも繋がります。

---

## 📖 この演習の進め方

第2巡で扱った（または想定した）**図書館システム**のコード（あるいはその設計）を題材とします。

1. **現状の分析**:
まず、図書館システムのコード（特に `domain/` や `application/` に相当する部分）をレビューし、DDDの視点（値オブジェクトの欠如、集約境界の曖昧さ、リポジトリの責務など）から課題や改善点を洗い出します。
2. **改善方針の決定**:
洗い出した課題に対して、どのDDDパターン（値オブジェクト導入、集約形成など）を適用するのが効果的かを検討します。
3. **リファクタリングの実装**:
決定した方針に基づき、実際にコードを段階的に修正していきます。
4. **効果の確認**:
リファクタリング後のコードが、以前と比べてどのように改善されたか（可読性、保守性、テスト容易性など）を確認・考察します。

---

## 🧱 戦略的設計と戦術的設計の連携

このリファクタリング演習においても、単に戦術的パターン（ツールキット）を適用するだけでなく、

- 「図書館」というドメインにおける**ユビキタス言語**は何か？
- 「書籍」「利用者」「貸出」の関係性から、適切な**集約**の境界はどこか？

といった、ドメインモデリング（戦略的設計）の視点を持つことが重要になります。ドメインへの理解に基づいてリファクタリングを進めることで、より本質的な改善が可能になります。

---

## ➡️ 次へ

それでは、最初のステップ「**(Step 1) 現状のコード（図書館システム）の確認と課題の洗い出し**」から始めましょう。（もし第2巡のコードがあれば、それを見ながら進めるとより効果的です）