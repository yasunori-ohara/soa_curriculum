# 00：はじめに

# 🏢 はじめに：実務に近い「会議室予約システム」を作ろう

前章までは「同じアプリを別の設計者が作ったら」という比較を通して、
クリーンアーキテクチャの**構造的な柔軟性**を学びました。

この章では、新しい題材として**「会議室予約システム」**を構築し、
これまで学んだ原則が**現実の業務ドメインにもそのまま通用する**ことを体感します。

---

## 🎯 この章の目的

* クリーンアーキテクチャの考え方をもう一度整理する
* 会議室予約アプリ全体の流れと層構造を理解する
* ③で導入したフォルダ構成（`domain / usecase / interface / infrastructure`）を実務で再確認する

> **つまりこの巡は「実務応用編」**。
> 前の章で身につけた抽象構造を、より現実的な問題に適用します。

---

## 🧭 今回の題材：会議室予約アプリ

題材は「**会議室予約システム**」。
会議室を登録し、会員が日時を指定して予約を行います。

| ユースケース         | 内容                   |
| -------------- | -------------------- |
| **会議室を予約する**   | 同じ時間帯に予約がある場合はエラーにする |
| **予約を取り消す**    | 締切後のキャンセルを禁止         |
| **空き会議室を検索する** | 希望の時間・人数・設備条件で検索     |
| **会員を登録する**    | 名前とメールアドレスで登録        |

「複数の人が同じ時間に予約しない」「ボタンを連打しても予約が重複しない」など、
**現実的な整合性と排他制御**をコードで表現していきます。

---

## 🧩 クリーンアーキテクチャの復習

![クリーンアーキテクチャ](../クリーンアーキテクチャ.png)

クリーンアーキテクチャとは、
「**システムを同心円の層で分ける**」という考え方です。

| 層                     | 内容                                    | 主な担当              |
| --------------------- | ------------------------------------- | ----------------- |
| **Entity（エンティティ）層**   | 会議室や予約など、現実のルールそのもの                   | Pythonクラス         |
| **UseCase（ユースケース）層**  | 「何をするか」の手続き（予約・取消・検索など）               | ビジネスロジック          |
| **InterfaceAdapter層** | 外部との橋渡し（Controller・Presenter・Gateway） | 翻訳・調整             |
| **Infrastructure層**   | WebサーバやDBなどの技術的実装                     | FastAPI・SQLite など |

> **依存は内側へ、制御は外側へ。**
> これまで学んだこの原則は、実務的なシステムでも変わりません。

---

## 💬 用語集（本巡で重点的に扱う）

| 用語                    | 説明                                  |
| --------------------- | ----------------------------------- |
| **DTO（データ転送オブジェクト）**  | 層をまたいでデータを渡すための箱。Input/Outputをまとめる。 |
| **Boundary（バウンダリ）**   | 層の「境界契約」。どんなデータを渡し、何を返すかの約束。        |
| **Repository（リポジトリ）** | データの出し入れ担当。保存先（DBなど）を意識せず動けるようにする。  |
| **依存性逆転（DIP）**        | 内側（ルール）が外側（技術）を知らないように設計する原則。       |
| **冪等性**               | 同じ操作を何度行っても結果が変わらない性質（ボタン連打の安全性）。   |
| **排他／整合性**            | 同じ会議室が同時に二重予約されないように保つ仕組み。          |
| **抽象契約**              | 実装を持たず、「こう動くべき」と定義するインターフェース。       |

---

## 🧱 フォルダ構成（第４巡 全体）

③章で登場したフォルダ構成をベースに、
今回はWeb・DB・排他制御などの外側層も順に加えていきます。

```text
project_round4/
├── domain/                               # 1章：エンティティ（現実のルール）
│   ├── reservation.py
│   ├── room.py
│   └── member.py
├── usecase/                              # 2章：ユースケース（アプリの手続き）
│   ├── dto.py
│   ├── boundaries/
│   │   └── reservation_boundaries.py
│   ├── contracts/
│   │   ├── reservation_repository.py
│   │   ├── room_repository.py
│   │   └── member_repository.py
│   ├── create_reservation.py
│   ├── cancel_reservation.py
│   └── search_availability.py
├── interface/                            # 3章：橋渡し層（WebやDBとの接続）
│   ├── controller/
│   ├── presenter/
│   └── gateway/
├── infrastructure/                       # 4章：技術層（DB・Web・排他など）
│   ├── db/
│   ├── web/
│   └── locking/
└── main.py                               # 5章：全体の依存注入（Composition Root）
```

> ③で見た「別設計者構成」をベースに、
> より現実的な仕組み（トランザクション、整合性、排他）を扱います。

---

## 🖊 コード共通ルール：図対応コメント

すべてのPythonファイルの冒頭に「このクラスが図のどこに対応するか」を記載します。

```python
# --------------------------------------------------------------------
# [クラス図] UseCaseInteractor（ユースケースの中心）
# [同心円] UseCase層（アプリの手続きを表す）
# 役割：予約を作る手続きを表現。外の世界（DBやWeb）は知らない。
# --------------------------------------------------------------------
```

---

## 🧠 学びの流れ（全6章）

| 章                        | 内容                           | 学べること         |
| ------------------------ | ---------------------------- | ------------- |
| **第0章 はじめに（本章）**         | 題材と全体構成を理解                   | 層構造と原則を再確認    |
| **第1章 Entity**           | 会議室・予約・会員のルール                | 現実のルールをクラス化   |
| **第2章 UseCase**          | 予約作成・取消・検索                   | 入出力Boundary設計 |
| **第3章 InterfaceAdapter** | Controller・Presenter・Gateway | 境界をつなぐ翻訳層     |
| **第4章 Infrastructure**   | DB・Web・排他の実装                 | 技術詳細を外側へ隔離    |
| **第5章 Main**             | 全体の依存注入                      | コンポジションルートの理解 |
| **第6章 理論編**              | 「依存は内へ／制御は外へ」を再整理            | 静的依存と動的制御の違い  |

---

## 💡 本巡で学ぶ新しい視点

| テーマ          | 内容            | 難易度 |
| ------------ | ------------- | --- |
| **重複予約防止**   | 同時間帯の二重予約を防ぐ  | ★★★ |
| **データ整合性**   | 定員オーバーを防ぐ     | ★★  |
| **冪等性**      | ボタン連打でも安全     | ★★  |
| **保存先の差し替え** | DBを自由に変更可能    | ★★★ |
| **契約テスト**    | 「約束どおり動くか」を検証 | ★★★ |

---

## ✅ この章を終えたら

* 会議室予約アプリの全体像を理解できる
* クリーンアーキテクチャの層と依存方向を説明できる
* コードと図を結びつけて読めるようになる

---

## ▶ 次のページ

**第1章：Entity（エンティティ）**
会議室・予約・会員という3つのルールをクラスで表現し、
「重複予約を防ぐ」「定員を超えない」などのビジネスルールを実装します。

