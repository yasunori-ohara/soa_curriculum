# 01ï¼šEntityï¼ˆã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ï¼‰

## ğŸ¯ ã“ã®ç« ã®ç›®çš„

* ã€Œ**ä¼šè­°å®¤ï¼ˆRoomï¼‰**ã€ã€Œ**äºˆç´„ï¼ˆReservationï¼‰**ã€ã€Œ**ä¼šå“¡ï¼ˆMemberï¼‰**ã€ã¨ã„ã†**ç¾å®Ÿã®ãƒ«ãƒ¼ãƒ«**ã‚’ã‚¯ãƒ©ã‚¹ã§è¡¨ç¾ã™ã‚‹
* ã€Œ**æ™‚é–“ãŒé‡ãªã‚‰ãªã„**ã€ã€Œ**é–‹å§‹ < çµ‚äº†**ã€ã€Œ**å®šå“¡ã‚’è¶…ãˆãªã„**ã€ã¨ã„ã£ãŸ**ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯**ã‚’ã€ä»–ã®å±¤ï¼ˆWeb/DBï¼‰ã«ä¾å­˜ã›ãšæ›¸ã
* ä»¥é™ã® **UseCaseï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰** ã‹ã‚‰**å‘¼ã³ã‚„ã™ã„å½¢**ã«ã™ã‚‹ï¼ˆãƒ†ã‚¹ãƒˆãŒç°¡å˜ã«ãªã‚‹ï¼‰

---

## ğŸ§© Entityã®ä½ç½®ã¥ã‘ï¼ˆå›³å¯¾å¿œï¼‰

![ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£.png)

| å›³ã®ç®±ï¼ˆã‚¯ãƒ©ã‚¹å›³ï¼‰  | å½¹å‰²                              | ã“ã®ç« ã®ãƒ•ã‚¡ã‚¤ãƒ«                                                      |
| ---------- | ------------------------------- | ------------------------------------------------------------- |
| **Entity** | ç¾å®Ÿã®ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã®ä¸­å¿ƒã€‚å¤–ã®æŠ€è¡“ï¼ˆWeb/DBï¼‰ã‚’çŸ¥ã‚‰ãªã„ | `domain/reservation.py`, `domain/room.py`, `domain/member.py` |

ğŸ‘‰ **ä¾å­˜ã¯å†…ã¸**ï¼šEntityã¯**èª°ã«ã‚‚ä¾å­˜ã—ãªã„**å±¤ã§ã™ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ï¼‰ã€‚
ğŸ‘‰ **å®Ÿè¡Œã®æµã‚Œï¼ˆåˆ¶å¾¡ï¼‰ã¯å¤–ã‹ã‚‰å†…ã¸**ï¼šå¾Œã§å‡ºã¦ãã‚‹UseCaseãŒã€ã“ã®Entityã‚’**ä½¿ã†å´**ã«ãªã‚Šã¾ã™ã€‚

---

## ğŸ§± ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆï¼ˆã“ã®ç« ã®ç¯„å›²ï¼‰

```
project_root/
â””â”€â”€ domain/
    â”œâ”€â”€ reservation.py   â† äºˆç´„ã®ãƒ«ãƒ¼ãƒ«ï¼ˆæ™‚é–“ã®é‡ãªã‚Šãƒ»é–‹å§‹/çµ‚äº†ã®æ¤œè¨¼ï¼‰
    â”œâ”€â”€ room.py          â† ä¼šè­°å®¤ã®å±æ€§ï¼ˆå®šå“¡ãƒ»è¨­å‚™ï¼‰
    â””â”€â”€ member.py        â† ä¼šå“¡ï¼ˆäºˆç´„è€…ï¼‰
```

---

## ğŸ’¡ è¨­è¨ˆæ–¹é‡ï¼ˆåˆå­¦è€…å‘ã‘ã®è¦ç‚¹ï¼‰

* **æ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã ã‘**ã‚’ä½¿ã†ï¼ˆ`datetime`, `dataclasses` ãªã©ï¼‰ã€‚å¤–éƒ¨ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã¯ä½¿ã„ã¾ã›ã‚“ã€‚
* **ãƒ«ãƒ¼ãƒ«ã¯é–¢æ•°ã«åˆ‡ã‚Šå‡ºã™**ï¼šãƒ†ã‚¹ãƒˆã—ã‚„ã™ãã€å†åˆ©ç”¨ã‚‚ã—ã‚„ã™ã„ã€‚
* **é–‹å§‹ < çµ‚äº†** ã¯äºˆç´„ã®å¤§å‰æã€‚**æ™‚é–“å¸¯ã®é‡ãªã‚Š**ã¯ `[start, end)`ï¼ˆ**çµ‚ç«¯ã¯é–‹ã**ï¼‰ã§åˆ¤å®šã™ã‚‹ã¨å®Ÿå‹™ä¸Šã®æ··ä¹±ãŒå°‘ãªã„ã€‚
* **å®šå“¡ãƒã‚§ãƒƒã‚¯**ã¯æœ¬æ¥UseCaseå´ã§ã€Œäººæ•° > å®šå“¡ãªã‚‰ã‚¨ãƒ©ãƒ¼ã€ã¨ä½¿ã„ã¾ã™ãŒã€**åŸºç¤ã®å±æ€§**ã¯Entityã«ç½®ãã¾ã™ã€‚

---

## ğŸ§  ã‚³ãƒ¼ãƒ‰

### âœ³ï¸ `domain/reservation.py`ï¼ˆäºˆç´„ï¼šæ™‚é–“ãƒ«ãƒ¼ãƒ«ã®ä¸­å¿ƒï¼‰

```python
# --------------------------------------------------------------------
# [ã‚¯ãƒ©ã‚¹å›³] Entity: Reservationï¼ˆäºˆç´„ï¼‰
# [åŒå¿ƒå††] Entityå±¤ï¼ˆç¾å®Ÿã®ãƒ«ãƒ¼ãƒ«ï¼ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯ï¼‰
# å½¹å‰²ï¼šä¼šè­°å®¤äºˆç´„ã‚’è¡¨ã™ã€‚é–‹å§‹/çµ‚äº†ã®æ•´åˆã€æ™‚é–“å¸¯ã®é‡ãªã‚Šåˆ¤å®šã‚’æä¾›ã€‚
# --------------------------------------------------------------------
from dataclasses import dataclass
from datetime import datetime
from typing import Tuple

@dataclass(frozen=True)
class Reservation:
    id: int
    room_id: int
    member_id: int
    start_at: datetime
    end_at: datetime
    attendees: int  # å‚åŠ äººæ•°

    def time_range(self) -> Tuple[datetime, datetime]:
        """äºˆç´„ã®æ™‚é–“å¸¯ï¼ˆ[start, end)ï¼‰ã‚’è¿”ã™ã€‚çµ‚ç«¯ã¯é–‹åŒºé–“ã¨ã—ã¦æ‰±ã†ã€‚"""
        return (self.start_at, self.end_at)

def validate_time_order(start_at: datetime, end_at: datetime) -> None:
    """
    é–‹å§‹æ™‚åˆ»ãŒçµ‚äº†æ™‚åˆ»ã‚ˆã‚Šå‰ã‹ã‚’æ¤œè¨¼ã€‚
    é€†è»¢ã—ã¦ã„ãŸã‚‰ ValueError ã‚’æŠ•ã’ã‚‹ã€‚
    """
    if not (start_at < end_at):
        raise ValueError("é–‹å§‹æ™‚åˆ»ã¯çµ‚äº†æ™‚åˆ»ã‚ˆã‚Šå‰ã§ã‚ã‚‹å¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚")

def overlaps(a: Tuple[datetime, datetime], b: Tuple[datetime, datetime]) -> bool:
    """
    æ™‚é–“å¸¯ã®é‡ãªã‚Šåˆ¤å®šï¼ˆ[start, end) ã©ã†ã—ï¼‰ã€‚
    ä¾‹ï¼ša=[10:00,11:00), b=[11:00,12:00) ã¯é‡ãªã‚‰ãªã„ï¼ˆçµ‚ç«¯ã¯é–‹ãï¼‰ã€‚
    """
    (a0, a1), (b0, b1) = a, b
    return (a0 < b1) and (b0 < a1)
```

**ãƒã‚¤ãƒ³ãƒˆ**

* `validate_time_order` ã¨ `overlaps` ã¯**ç´”ç²‹é–¢æ•°**ãªã®ã§ã€**å˜ä½“ãƒ†ã‚¹ãƒˆãŒè¶…ç°¡å˜**ã€‚
* ä»¥é™ã® UseCase ã§ã¯ã€**ä¿å­˜ã‚„Webã‚’çŸ¥ã‚‰ãªã„**ã“ã®é–¢æ•°ã‚’å‘¼ã¶ã ã‘ã§**æ­£ã—ã„åˆ¤å®š**ãŒã§ãã¾ã™ã€‚

---

### âœ³ï¸ `domain/room.py`ï¼ˆä¼šè­°å®¤ï¼šå®šå“¡ãƒ»è¨­å‚™ï¼‰

```python
# --------------------------------------------------------------------
# [ã‚¯ãƒ©ã‚¹å›³] Entity: Roomï¼ˆä¼šè­°å®¤ï¼‰
# [åŒå¿ƒå††] Entityå±¤
# å½¹å‰²ï¼šä¼šè­°å®¤ã®å±æ€§ï¼ˆå®šå“¡ãƒ»è¨­å‚™ï¼‰ã‚’è¡¨ã™ã€‚å¤–éƒ¨æŠ€è¡“ã¯çŸ¥ã‚‰ãªã„ã€‚
# --------------------------------------------------------------------
from dataclasses import dataclass
from typing import Set

@dataclass(frozen=True)
class Room:
    id: int
    name: str
    capacity: int
    equipments: Set[str]  # ä¾‹ {"projector", "whiteboard"}
```

**ãƒã‚¤ãƒ³ãƒˆ**

* ã€Œå®šå“¡ã‚ªãƒ¼ãƒãƒ¼ã®ç¦æ­¢ã€ãã®ã‚‚ã®ã¯**UseCaseå´**ã§ãƒã‚§ãƒƒã‚¯ã—ã¾ã™ã€‚
* Entity ã«ã¯**å¿…è¦ãªå±æ€§**ã ã‘ã‚’**ã‚·ãƒ³ãƒ—ãƒ«ã«**ç½®ãã¾ã™ã€‚

---

### âœ³ï¸ `domain/member.py`ï¼ˆä¼šå“¡ï¼‰

```python
# --------------------------------------------------------------------
# [ã‚¯ãƒ©ã‚¹å›³] Entity: Memberï¼ˆä¼šå“¡ï¼‰
# [åŒå¿ƒå††] Entityå±¤
# å½¹å‰²ï¼šäºˆç´„è€…ã‚’è¡¨ã™æœ€å°é™ã®æƒ…å ±ã€‚
# --------------------------------------------------------------------
from dataclasses import dataclass

@dataclass(frozen=True)
class Member:
    id: int
    name: str
    email: str  # ãƒ¡ãƒ¼ãƒ«ã¯å¾Œã§é‡è¤‡ç¦æ­¢ï¼ˆUseCase/Repoå´ã§æ‰±ã†æƒ³å®šï¼‰
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆã®ãƒ’ãƒ³ãƒˆï¼ˆã“ã®ç« ã®ç¯„å›²ã ã‘ï¼‰

> ã“ã“ã¯**Pythonã®æ¨™æº–ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ**ã‚„ **pytest** ã§ç°¡å˜ã«è©¦ã›ã¾ã™ã€‚
> DBã‚‚Webã‚‚ä¸è¦ã§ã™ã€‚

```python
# ä¾‹ï¼šreservation_entity_test.pyï¼ˆæ“¬ä¼¼ã‚³ãƒ¼ãƒ‰ï¼‰
from datetime import datetime, timedelta
from domain.reservation import validate_time_order, overlaps

def test_validate_time_order_ok():
    s = datetime(2025, 1, 1, 10, 0)
    e = s + timedelta(hours=1)
    validate_time_order(s, e)  # ä¾‹å¤–ãŒå‡ºãªã‘ã‚Œã°OK

def test_validate_time_order_ng():
    s = datetime(2025, 1, 1, 10, 0)
    e = datetime(2025, 1, 1, 9, 59)
    try:
        validate_time_order(s, e)
        assert False, "ä¾‹å¤–ãŒå¿…è¦"
    except ValueError:
        pass

def test_overlaps_edges():
    s = datetime(2025, 1, 1, 10, 0)
    e = datetime(2025, 1, 1, 11, 0)
    a = (s, e)
    b = (e, e.replace(hour=12))  # [11:00,12:00)
    assert overlaps(a, b) is False  # çµ‚ç«¯ãŒæ¥ã—ã¦ã„ã‚‹ã ã‘ãªã‚‰é‡ãªã‚‰ãªã„

def test_overlaps_true():
    a = (datetime(2025,1,1,10), datetime(2025,1,1,11))
    b = (datetime(2025,1,1,10,30), datetime(2025,1,1,11,30))
    assert overlaps(a, b) is True
```

---

## ğŸ“˜ ã“ã®ç« ã®ç†è§£ãƒã‚¤ãƒ³ãƒˆï¼ˆè¦ç‚¹ã¾ã¨ã‚ï¼‰

| è¦³ç‚¹         | å†…å®¹                                              |
| ---------- | ----------------------------------------------- |
| **å½¹å‰²**     | ç¾å®Ÿã®ãƒ«ãƒ¼ãƒ«ï¼ˆäºˆç´„ã®æ™‚é–“ãƒ»ä¼šè­°å®¤ã®å®šå“¡ãƒ»ä¼šå“¡æƒ…å ±ï¼‰ã‚’è¡¨ã™ä¸­å¿ƒ                  |
| **ä¾å­˜å…ˆ**    | **ãªã—**ï¼ˆæ¨™æº–ãƒ©ã‚¤ãƒ–ãƒ©ãƒªã®ã¿ï¼‰                               |
| **çŸ¥ã‚‰ãªã„ã‚‚ã®** | Webãƒ»DBãƒ»ãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯ï¼ˆå¤–ã®æŠ€è¡“ï¼‰                            |
| **ãƒ­ã‚¸ãƒƒã‚¯**   | `validate_time_order`ï¼ˆé–‹å§‹<çµ‚äº†ï¼‰ã€`overlaps`ï¼ˆæ™‚é–“å¸¯é‡è¤‡ï¼‰  |
| **æ•™è‚²åŠ¹æœ**   | å¾Œã®å±¤ï¼ˆUseCase/Controller/DBï¼‰ã‹ã‚‰**ä½¿ã„å›ã›ã‚‹ç´”ç²‹ãƒ­ã‚¸ãƒƒã‚¯**ãŒã§ããŸ |

---

## â–¶ æ¬¡ã®ãƒšãƒ¼ã‚¸

**ç¬¬2ç« ï¼šUseCaseï¼ˆãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ï¼‰**

* ã“ã® Entity ã‚’ä½¿ã£ã¦ã€**ã€Œäºˆç´„ã‚’ä½œã‚‹ã€æ‰‹ç¶šã**ã‚’å®Ÿè£…ã—ã¾ã™ã€‚
* **å…¥åŠ›ãƒ‡ãƒ¼ã‚¿ã®ç®±ï¼ˆDTOï¼šãƒ‡ãƒ¼ã‚¿è»¢é€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰**ã€**å¢ƒç•Œã®å–ã‚Šæ±ºã‚ï¼ˆBoundaryï¼‰**ã€
  **ä¿å­˜å½¹ã®ç´„æŸï¼ˆRepositoryï¼‰** ã‚’ **UseCaseå±¤**ã«ç½®ãã€
  **ä¾å­˜æ€§é€†è»¢ï¼ˆDIPï¼‰**ï¼ˆï¼å†…å´ãŒå¤–å´ã‚’çŸ¥ã‚‰ãªã„ï¼‰ã‚’ä½“æ„Ÿã—ã¾ã™ã€‚
