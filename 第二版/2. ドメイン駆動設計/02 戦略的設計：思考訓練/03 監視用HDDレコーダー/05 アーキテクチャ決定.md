## 🖼️ アーキテクチャ決定

次のステップは、この戦略的設計（システムの地図）が、**実際の物理的なアーキテクチャやチームの構造にどう結びつくか**を考察することです。

***

### 地図から「実装」をイメージする

私たちが描いたコンテキストマップは、この監視用HDDレコーダーが、**一枚岩の巨大なプログラムではなく、協調して動作する複数の専門プログラムの集合体**として設計するのが望ましいことを示唆しています。



#### 1. 物理的なプロセスへの分割

Webシステムであればマイクロサービスに分割しますが、このような組み込み機器では、それぞれが独立した**プロセスやスレッド**として実装するのが一般的です。

* **録画プロセス**: 常にバックグラウンドで動作し、カメラからの映像を受け取ってディスクに書き込むことに専念します。最も高い安定性が求められます。
* **再生プロセス**: ユーザーが再生ボタンを押したときに起動し、ディスクからデータを読み出してモニターに送ります。
* **設定UIプロセス**: ユーザーがメニューボタンを押したときに起動し、各種設定画面を表示・変更します。
* **ライブ表示プロセス**: 普段モニターに表示されている分割画面を管理します。

---
#### 2. プロセス間の通信

これらの独立したプロセスは、**プロセス間通信（IPC）**と呼ばれる仕組みで連携します。

* **設定プロセス**が「カメラ1の解像度を『高』に変更」という設定を保存したら、「設定が変更された」というメッセージをシステム全体に通知します。
* **録画プロセス**はそのメッセージを受け取り、「なるほど、次の録画セグメントからは解像度を『高』にしないとな」と、自身の動作を変更します。

---
### なぜ分割するのか？：組み込みシステムにおけるメリット

この分割アプローチは、組み-込みシステムにおいて特に重要なメリットをもたらします。

* **安定性と堅牢性**:
    最も重要な**録画プロセス**を、UIなど他の部分から隔離できます。例えば、再生プロセスで致命的なバグが発生してクラッシュしても、バックグラウンドで動き続けている**録画プロセスには影響を与えません**。これにより、「再生しようとしたら、録画も止まっていた」という最悪の事態を防げます。

* **リソース管理**:
    CPUパワーやメモリといった限られたリソースを、各プロセスに適切に割り当てることができます。例えば、通常時はライブ表示プロセスの優先度を高くし、再生が始まったら再生プロセスの優先度を上げるといった制御が可能になります。

* **責務の明確化**:
    録画機能担当のエンジニアは録画プロセスのコードだけを、UI担当のエンジニアは設定UIプロセスのコードだけを主に触ることになり、専門領域に集中できます。

これで、戦略的設計の思考訓練も一通り完了です。ビジネスアプリケーションとは少し違う題材でしたが、ドメインを分析し、関心事ごとに境界を引いていくという、戦略的設計の普遍的なプロセスを体感していただけたかと思います。