## 戦略的設計とは？：「システムの地図」を作ること

DDDにおける戦略的設計とは、複雑で巨大なビジネスの領域（ドメイン）を、**管理可能な小さなサブドメインに分割し、その関係性を定義する**活動です。コードを一行も書く前に、まずシステム全体の**地図**を描くことから始めます。

この地図作りが、いわゆる「**巨大な泥団子**」と呼ばれる、すべてが密結合した巨大なモノリスシステムが生まれるのを防ぎ、変更に強く、スケールしやすいソフトウェアの土台となります。

この活動で使う2つの主要な道具が**ユビキタス言語**と**境界づけられたコンテキスト**です。

#### 題材：簡単なホテルの予約システム

これから、このホテル予約システムを題材に、地図を作っていきます。
主な機能：

  * 宿泊客は客室を検索し、予約できる。
  * 予約に対する支払い処理を行う。
  * 顧客情報を管理する。

-----

### \#\# ステップ1：ユビキタス言語を定義する

**ユビキタス言語**とは、開発者とドメイン専門家（ホテルのスタッフなど）が**共通で使う言葉の辞書**です。この辞書に載っている言葉は、会議での会話からコードのクラス名・メソッド名に至るまで、**全く同じ意味**で使われる必要があります。

これにより、「開発者の考える『顧客』と、営業担当の言う『顧客』は、実は違うものを指していた」といった致命的なすれ違いを防ぎます。

**📝 ユビキタス言語 用語集（例）**

| 用語 | 意味・定義 | 備考（別名など） |
| :--- | :--- | :--- |
| **予約 (Reservation)** | 特定の客室タイプを、特定の期間、宿泊客のために確保する契約。 | ブッキング(Booking)とも呼ばれる。 |
| **宿泊客 (Guest)** | 実際にホテルに宿泊する人物。 | |
| **顧客 (Customer)** | 予約を行い、支払い責任を負う人物。宿泊客と同一とは限らない。 | |
| **宿泊期間 (Stay Period)** | チェックイン日からチェックアウト日までの期間。 | 戦術的設計における値オブジェクトの候補。 |
| **客室タイプ (Room Type)** | 客室の分類。「シングル」「スイート」など。料金や定員を持つ。 | |
| **料金 (Rate)** | 宿泊期間と客室タイプから計算される金額。季節によって変動する。 | |
| **支払い (Payment)** | 予約に対する金銭の授受。 | |

-----

### \#\# ステップ2：境界づけられたコンテキストを見つける

**境界づけられたコンテキスト (Bounded Context)** とは、\*\*ユビキタス言語の辞書が有効な範囲（境界）\*\*のことです。この境界の内側では、言葉の意味は一貫しています。

例えば、「予約」という言葉が持つ意味やルールは、「予約コンテキスト」の中では一貫していますが、「決済コンテキスト」では「支払われるべき対象」くらいの単純な意味しか持たないかもしれません。

用語集の言葉を、関連性の強いグループに分けてみましょう。

  * `予約`, `宿泊期間`, `料金` → **予約コンテキスト**

      * 責任：予約の受付、空室状況の確認、料金計算など、予約のライフサイクル全体を管理する。

  * `顧客`, `宿泊客` → **顧客管理コンテキスト**

      * 責任：顧客情報の管理、連絡先、過去の宿泊履歴、会員ランクなどを管理する。

  * `支払い` → **決済コンテキスト**

      * 責任：クレジットカード決済、請求書発行など、お金のやり取りに特化して管理する。

これを図で表現すると、システムの「地図」が完成します。

```
┌──────────────────┐      ┌─────────────────────┐
│ 予約コンテキスト │      │ 顧客管理コンテキスト│
│                  │      │                     │
│ ・予約           │  ───>│ ・顧客              │
│ ・料金           │      │ ・宿泊履歴          │
│                  │      │                     │
└──────────────────┘      └─────────────────────┘
         │
         │
         ▼
┌──────────────────┐
│ 決済コンテキスト │
│                  │
│ ・支払い         │
│                  │
└──────────────────┘
```

-----

### 戦略と戦術、そしてアーキテクチャの関係

ここまでが戦略的設計の主な活動です。そして、この地図とクリーンアーキテクチャ、そして戦術的設計は、以下のように繋がります。

1.  **戦略的設計で「街（システム全体）」の区画整理をする**:

      * 地図上の**各コンテキスト**（予約、顧客管理、決済）が、それぞれ**独立して開発すべきアプリケーションの単位**となります。

2.  **各区画にクリーンアーキテクチャで「建物」を建てる**:

      * 「予約コンテキスト」を実装するために、一つの**クリーンアーキテクチャ**を採用します。
      * 「顧客管理コンテキスト」を実装するために、もう一つ別の**クリーンアーキテクチャ**を採用します。

3.  **建物の内部を戦術的設計で「内装」する**:

      * 「予約コンテキスト」のクリーンアーキテクチャの内部（特にEntities層）を、これまで学んだ**値オブジェクト**や**集約**といった戦術的設計パターンを使って、豊かで堅牢なものにしていきます。

このように、まず**戦略**で大きな分割の単位を決め、その単位ごとに**アーキテクチャ**の骨格を定め、その内部を**戦術**で具体化していく、というのがDDDとクリーンアーキテクチャを組み合わせた開発の大きな流れです。