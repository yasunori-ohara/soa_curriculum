## Entity 洗い出し 

それでは、いただいた仕様を元に、このシステムの核となる**Entityの洗い出し**を行いましょう。

---
### Entityとは何か？（再確認）

まず、`Entity`とは、UIやデータベースといった技術的な詳細から完全に独立した、**システムのビジネスドメインそのものを表現するオブジェクト**です。ここには、そのビジネスにおける普遍的な**「モノ」**と、そのモノが従うべき**「ルール」**を定義します。

---
### このシステムにおける主要なEntity

仕様を分析した結果、この監視用HDDレコーダーシステムの中心には、主に以下の4つの`Entity`が存在すると考えられます。

#### **1. `RecordingSegment` (録画セグメント)**

* **役割**:
    HDDに保存される、ひとかたまりの**「録画データ」**そのものを表現します。仕様にあった「古い映像を消去する」という要件を満たすため、録画は管理しやすい短い時間（例：1分ごと）のセグメント（チャンク）として扱います。これが、データの保存・検索・削除における基本単位となります。

* **主なプロパティとルール**:
    * `id`: 各セグメントを一位に識別するID。
    * `camera_id`: どのカメラの映像か。
    * `start_time`, `end_time`: 録画の開始・終了時刻。
    * `recording_type`: 録画の種類を区別する**状態**。`NORMAL`（通常）、`ALARM`（通常アラーム）、`EMERGENCY`（緊急）のいずれか。
    * `resolution`, `frame_rate`: このセグメントの録画品質。
    * **ルール**: `recording_type`が`EMERGENCY`のセグメントは、特別な指示があるまで上書き消去の対象にならない。

#### **2. `CameraSetting` (カメラ設定)**

* **役割**:
    16台ある各カメラの**「設定情報」**を保持するEntityです。カメラ1台につき、このEntityが1つ存在します。

* **主なプロパティとルール**:
    * `camera_id`: 対象となるカメラのID。
    * `normal_recording_setting`: 通常録画時の解像度と記録枚数。
    * `alarm_recording_setting`: 人物検知アラーム時の解像度と記録枚数。
    * `pre_alarm_seconds`: プリ録画の時間（5秒 or 10秒）。
    * `post_alarm_seconds`: アフター録画の時間（10, 20, 30秒）。
    * **ルール**: `camera_id`は1〜16の範囲でなければならない。解像度や記録枚数は、定められた選択肢の中から選ばれなければならない。

#### **3. `RecordingSchedule` (録画スケジュール)**

* **役割**:
    タイマー予約録画の**「スケジュールルール」**を表現します。カメラごとに複数のスケジュール（例：月曜の9時〜17時、土曜の終日など）を設定できる場合、このEntityのインスタンスが複数存在することになります。

* **主なプロパティとルール**:
    * `schedule_id`: スケジュールを識別するID。
    * `camera_id`: 対象となるカメラのID。
    * `day_of_week`: 曜日。
    * `start_time`, `end_time`: 録画のON/OFF時刻。
    * `is_enabled`: このスケジュールが有効かどうか。
    * **ルール**: `end_time`は`start_time`より後でなければならない。

#### **4. `StoragePolicy` (ストレージポリシー)**

* **役割**:
    HDD全体の**「運用ルール」**と状態を管理する、非常に重要なEntityです。個々の録画セグメントを管理する上位の存在として、上書き消去の判断や保護領域の管理といった、システム全体のストレージ戦略に責任を持ちます。

* **主なプロパティとルール**:
    * `emergency_area_percentage`: HDD全体のうち、緊急録画領域として確保する割合（0%, 10%, 20%）。
    * `emergency_area_full_policy`: 保護領域が満杯になった際の振る舞い（今回は「新しい緊急録画は失敗する」）。
    * **ルール**: 通常録画を行う際、どの`RecordingSegment`を上書き消去すべきかを判断するロジック（`find_segment_to_overwrite()`のようなメソッドを持つ）。緊急録画を行う際、保護領域に空きがあるかを判断するロジック。

---
以上の4つが、このシステムの核となる主要なEntityと考えられます。これらはUIやデータベースの実装方法に一切依存しない、純粋なビジネスコンセプトです。
