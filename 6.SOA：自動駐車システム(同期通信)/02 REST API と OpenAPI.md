# 02 REST API と OpenAPI

# 理論：REST API と OpenAPI

同期通信の実現方法として、現在Webの標準となっている「REST」と、その仕様を定義する「OpenAPI」について学びます。これらは、サービス間がHTTP(S)で通信する際の共通言語となります。

## 🏛️ REST (Representational State Transfer) とは？

REST（レスト）は、特定のプロトコルや規格ではなく、Webサービスを設計するための「設計原則」や「思想」の集まりです。HTTPプロトコルのポテンシャルを最大限に活かすことを目指しています。

RESTの主な原則には以下のようなものがあります。

- **リソース指向 (Resource-Oriented):**
システムが提供する全ての情報や機能（例：「WorldModel」「ParkingPlan」）を「リソース」として捉えます。各リソースは、URI (Uniform Resource Identifier) によって一意の「住所」を持ちます (例: `http://recognition-service/world_model`)。
- **ステートレス (Stateless):**
サーバー側は、クライアントの過去の状態（コンテキスト）を一切保持しません。リクエストを処理するために必要な情報は、全てリクエスト自体に含まれている必要があります。これにより、サーバーはどのクライアントからのリクエストでも同様に処理でき、スケールしやすくなります。
- **HTTPメソッドの活用:**
リソースに対して行う操作を、標準のHTTPメソッド（動詞）で表現します。

## 🛠️ HTTPメソッドの役割

RESTでは、リソース（名詞）に対して行う操作をHTTPメソッド（動詞）で区別します。これにより、APIの意図が明確になります。

| メソッド | 操作 (CRUD) | 主な役割 |
| --- | --- | --- |
| `GET` | Read | リソースの取得 (例: `GET /world_model` でWorldModelを取得) |
| `POST` | Create | リソースの新規作成 (例: `POST /tasks` で新しいタスクを作成) |
| `PUT` | Update | リソースの全体更新 (例: `PUT /tasks/1` ですべて上書き) |
| `DELETE` | Delete | リソースの削除 (例: `DELETE /tasks/1` でタスクを削除) |

今回の巡回では、主に `GET` メソッド（データの取得）を使用してサービス間を連携させます。

## 📜 OpenAPI Specification とは？

OpenAPI（オープンエーピーアイ）とは、REST APIの仕様を記述するための「標準フォーマット（仕様書）」です。以前は「Swagger（スワガー）」と呼ばれていました。

これは、APIの「契約書」に例えられます。この契約書には、以下のようなAPIに関する厳密な定義が、YAMLまたはJSON形式で記述されます。

- どのようなエンドポイント（URI）があるか？ (例: `/world_model`)
- 各エンドポイントでどのHTTPメソッドが使えるか？ (例: `GET`)
- リクエスト時に必要なパラメータは何か？ (例: クエリパラメータ `timestamp_gt=...`)
- レスポンスとしてどのようなデータ（スキーマ）が返ってくるか？ (例: WorldModelのJSON構造)
- どのようなエラーコードが返る可能性があるか？ (例: 404 Not Found)

## 💡 なぜOpenAPIを使うのか？

OpenAPIという共通の「契約書」を使うことには、開発において多くの利点があります。

- **ドキュメントの自動生成:**
OpenAPIの定義ファイルから、人間が読みやすいインタラクティブなAPIドキュメント（Swagger UIなど）を自動的に生成できます。
- **コードの自動生成:**
サーバー側のひな形（スタブコード）や、クライアント側のSDK（APIを呼び出すためのライブラリ）を様々な言語で自動生成でき、開発の初期コストを大幅に削減します。
- **契約ベース開発 (Contract-Based Development):**
APIの仕様（契約）を先に確定させることで、サーバー側とクライアント側の開発チームが、お互いの実装を待たずに並行して開発・テストを進めることができます。
- **仕様の明確化と一貫性:**
APIの仕様が機械可読な形式で厳密に定義されるため、開発者間の「認識のズレ」を防ぎ、一貫したAPI設計を強制できます。