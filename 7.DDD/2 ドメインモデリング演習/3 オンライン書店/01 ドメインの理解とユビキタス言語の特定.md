# 01 ドメインの理解とユビキタス言語の特定

# ステップ１：ドメインの理解とユビキタス言語の特定 🗣️

最初のステップは、対象となるドメイン（今回は「オンライン書店」）が**何をするためのものか**、**どのような言葉**が使われているかを理解することです。ここでの目標は、**ユビキタス言語**の候補を見つけ出し、同時に**境界づけられたコンテキスト**のヒントを探ることです。オンライン書店は、これまでの題材よりも複数の関心事が絡み合っている可能性があります。

*(顧客、書店員、管理者などの視点を想像しながら進めます。)*

## 🤔 何をするシステム？ (Core Purpose)

- 顧客が**書籍 (Book)** を検索し、詳細情報を閲覧できるようにする。
- 顧客が購入したい書籍を**カート (Cart / Shopping Cart)** に追加できるようにする。
- 顧客がカート内の書籍を**注文 (Order)** できるようにする。
- （将来的には）在庫管理、支払い処理、配送、レビュー機能、おすすめ機能、会員管理…など多くの機能が考えられますが、まずは**シンプルなコア機能**（書籍カタログ閲覧、カート管理、注文作成）に焦点を当てます。

## 💬 どんな言葉が使われそう？ (Candidate Ubiquitous Language)

このシステムについて話すとき、自然に出てきそうな**名詞**や**動詞**、**形容詞**を洗い出してみましょう。

**名詞 (候補):**

- **書籍 / 本** (Book / Product / Item) - 販売対象
- **ISBN** (ISBN) - 書籍の国際的な識別子
- **タイトル** (Title)
- **著者** (Author)
- **出版社** (Publisher)
- **価格** (Price)
- **在庫数** (Stock Level / Quantity on Hand)
- **カタログ** (Catalog) - 書籍情報の集まり
- **顧客 / ユーザー** (Customer / User) - 購入者
- **カート / ショッピングカート** (Cart / Shopping Cart) - 購入予定の書籍リスト
- **カート項目** (Cart Item) - カート内の個々の書籍と数量
- **注文** (Order) - 購入確定後の情報
- **注文明細** (Order Item / Order Line) - 注文内の個々の書籍と数量、価格
- **注文ID** (Order ID)
- **顧客ID** (Customer ID)
- **(もしあれば) 支払い情報** (Payment Information)
- **(もしあれば) 配送先住所** (Shipping Address)
- **(もしあれば) レビュー** (Review)

**動詞 (候補):**

- **検索する** (Search) - 書籍
- **閲覧する** (View / Browse) - 書籍詳細
- **カートに入れる** (Add to Cart)
- **カートから削除する** (Remove from Cart)
- **数量を変更する** (Change Quantity) - カート内
- **注文する / 購入する** (Place Order / Checkout / Purchase)
- **(もしあれば) 支払う** (Pay)
- **(もしあれば) レビューを書く** (Write Review)

**形容詞 / 状態 (候補):**

- **在庫あり** (In Stock / Available)
- **在庫切れ** (Out of Stock / Unavailable)
- **注文済み** (Ordered / Placed)
- **支払い済み** (Paid)
- **発送済み** (Shipped)
- **キャンセル済み** (Cancelled)

## 📝 用語の絞り込みと定義（仮） & コンテキストのヒント

重要そうな言葉を選び、仮の定義を与えます。同時に、言葉の意味が文脈によって変わりそうな点（＝**境界づけられたコンテキスト**のヒント）にも注目します。

- **書籍 (Book)**:
    - **カタログ文脈**: 販売対象となる本。`ISBN`で識別され、`タイトル`、`著者`、`出版社`、`説明文`、`定価`などの情報を持つ。
    - **在庫文脈**: 物理的な在庫の単位。`ISBN`で識別され、現在の`在庫数`を持つ。
    - **注文文脈**: 注文された具体的な本。`ISBN`で識別され、注文時の`単価`と`数量`を持つ。
    - ➡️ 「書籍」という言葉が、**文脈によって関心事（属性）が異なる**ようです。これは、「カタログ」「在庫」「注文」が**別々の境界づけられたコンテキスト**である可能性を示唆します。
- **顧客 (Customer)**:
    - `CustomerID` で識別される購入者。`氏名`、`メールアドレス`を持つ。
    - **カート文脈**: 現在のカートの持ち主。
    - **注文文脈**: 注文を行った本人。
    - ➡️ 顧客情報は多くの文脈で参照されますが、顧客情報のマスター管理（登録、変更など）は**別の「顧客管理」コンテキスト**の責務かもしれません。
- **カート (ShoppingCart)**:
    - 特定の `Customer` に紐づく、購入予定の書籍（`CartItem`のリスト）を一時的に保持する。
    - ➡️ 「カート管理」という**独立したコンテキスト**と考えられそうです。
- **注文 (Order)**:
    - 購入が確定した取引。`OrderID`で識別され、`CustomerID`、`注文日時`、`配送先住所`、`支払い情報`、`注文明細 (OrderItem)`のリスト、`注文合計金額`、`注文ステータス`などを持つ。
    - ➡️ 「注文管理」という**独立したコンテキスト**と考えられそうです。
- **注文明細 (OrderItem)**:
    - `Order` 内の個々の項目。`ISBN`（または`ProductID`）、`数量`、注文時の`単価`を持つ。
    - ➡️ `Order` 集約の**内部エンティティ**の候補です。
- **価格 (Price)** / **金額 (Money)**:
    - 通貨と金額の組み合わせ。
    - ➡️ **値オブジェクト**の候補です。

**ポイント:**

- 同じ「Book」でも、カタログで見る情報、在庫で管理する情報、注文で記録する情報は異なります。無理に一つの `Book` クラスで表現しようとせず、コンテキストごとに必要な情報を持つモデルを定義するのがDDDのアプローチです。
- 「カート」と「注文」は、ライフサイクルも目的も異なるため、明確に別のコンテキスト（そしておそらく別の集約）として扱うのが良さそうです。

---

## ➡️ 次へ

ユビキタス言語の候補と、コンテキスト分割のヒントが見えてきました。次は、これらのコンテキスト（特に「カタログ」「カート」「注文」）それぞれにおける中心的な**集約 (Aggregate)** は何かを考えてみましょう。「**(Step 2) 集約の発見と境界設定**」に進みます。