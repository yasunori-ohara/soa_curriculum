# 00 はじめに

# 📚 はじめに：もし図書館アプリを別の人が設計したら？

この章では、**同じ「図書館の貸出管理アプリ」**を
**別の設計者がクリーンアーキテクチャの考え方で作ったらどうなるか？**
という視点で学んでいきます。

---

## 🎯 この章の目的

第1巡・第2巡で私たちは、
「クラス図とコード構造を完全に一致させる」形式でクリーンアーキテクチャを体験しました。

しかし、実際の現場では：

* プロジェクトやチームによってフォルダ構成や命名は変わる
* それでも「依存性の方向」や「層の責務」は変わらない

という柔軟性が求められます。

この章ではその違いを体感し、
**「見た目が変わっても中身の構造原理は同じ」**という感覚を身につけることが目的です。

---

## 🧭 フォルダ構成の違いを見てみよう

### 📁 前回のフォルダ構成（第2巡）

前回は「クリーンアーキテクチャのクラス図」と対比しながら構築したため、
フォルダもクラス図の層構造に忠実でした。

```text
clean_architecture_library/
├─ core/
│   ├─ domain/
│   │   ├─ book.py
│   │   ├─ member.py
│   │   ├─ loan.py
│   │   ├─ repository.py
│   │   └─ errors.py
│   │
│   └─ usecase/
│       ├─ interactor/
│       │   └─ checkout_book.py
│       └─ boundary/
│           ├─ input_boundary.py
│           ├─ output_boundary.py
│           └─ dto.py
│
├─ interface_adapters/
│   ├─ controllers/
│   │   └─ book_controller.py
│   ├─ presenters/
│   │   └─ book_presenter.py
│   └─ views/
│       ├─ view_console.py
│       ├─ view_web.py
│       └─ view_gui.py
│
├─ infrastructure/
│   └─ repositories/
│       ├─ in_memory_book_repository.py
│       ├─ in_memory_member_repository.py
│       ├─ in_memory_loan_repository.py
│       └─ postgres_book_repository.py
│
└─ main.py
```

---

### 📁 今回のフォルダ構成（別設計者の例）

今回はフォルダの配置が少し変わっています。
一見異なりますが、**クリーンアーキテクチャの原則（内→外の依存方向）**はきちんと守られています。

```text
project_root/
├── domain/
│   ├── book.py          ← Bookエンティティ
│   ├── member.py        ← Memberエンティティ
│   └── loan.py          ← Loanエンティティ
│
├── usecase/
│    ├── dto.py                          # InputData / OutputData（DS）
│    ├── boundaries/                     # Controller／Presenterとの契約（Input/OutputBoundary）
│    │   ├── register_book_boundary.py
│    │   └── register_member_boundary.py
│    ├── contracts/                      # Repository（Data Access Interface）
│    │   ├── book_repository.py
│    │   └── member_repository.py
│    ├── register_book.py                # UseCaseInteractor（Book登録）
│    └── register_member.py              # UseCaseInteractor（Member登録）
│
├── interface/
│   ├── controller/
│   │   └── book_controller.py
│   ├── presenter/
│   │   └── book_presenter.py
│   └── gateway/
│       └── book_gateway.py              # Entity ⇔ 行データの変換（Mapper）
│
├── infrastructure/
│   ├── web/
│   │   ├── server.py                    # シンプルなHTTPサーバ（受付役）
│   │   └── view_renderer.py             # HTMLテンプレート描画（View）
│   └── db/
│       ├── sqlite_conn.py               # SQLite接続とテーブル作成
│       └── book_data_access.py          # データアクセス実装
│
└── main.py                              # 依存注入（Composition Root）
```

---

## 💡 ここで注目してほしいポイント

| 観点            | 前回（第2巡）                                    | 今回（第3巡）                                       | 学ぶべき本質                |
| ------------- | ------------------------------------------ | --------------------------------------------- | --------------------- |
| フォルダ名         | core / interface_adapters / infrastructure | domain / usecase / interface / infrastructure | **名前が違っても層構造は同じ**     |
| Repositoryの位置 | domain/repository.py に集約                   | usecase/contracts/ に分離                        | **契約（interface）を明確化** |
| Gatewayの導入    | なし                                         | あり（Entity⇔DB変換層）                              | **データ変換の責務分離**        |
| Web要素         | Viewをinterface_adapters内に配置                | infrastructure/web配下で独立                       | **外部技術をより外側に追い出す**    |

---

## 🔍 まとめ：何が変わって、何が変わらないのか？

* **変わるもの**：フォルダ構成、命名、責務の細分化の仕方
* **変わらないもの**：

  * 依存の向き（内 → 外）
  * Entity と UseCase がシステムの中心であること
  * 外側の技術（WebやDB）は内側を知らないこと

> ✅ **フォルダ構成は変えても「矢印の向き」は変えない。**
>
> これこそがクリーンアーキテクチャの核です。

---

## 🎯 この章の学習ゴール

* 別の設計でも**DIP（依存性逆転原則）**が維持されることを確認
* **Repository / Gateway / Boundary** の分割パターンを比較して理解
* フォルダ構成の違いがあってもアーキテクチャの意図が変わらないことを体感
* 現場で設計方針が異なるチームに参加しても、迷わず構造を読めるようになる

---

## 🗒 次のステップ

ここまでで、「構成の違い＝思想の違いではない」ことを確認しました。
次章では、このフォルダ構成を実際に使いながら、**データアクセス実装とWeb連携**を中心に見ていきます。


