# 03 Lï¼šãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡

# ğŸ›ï¸ ç†è«–ç·¨ï¼šSOLIDåŸå‰‡ï¼ˆLï¼‰- ãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡

SOLIDåŸå‰‡ã®3ç•ªç›®ã¯ã€ã€Œ**Lï¼šãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡ (Liskov Substitution Principle)**ã€ã§ã™ã€‚ã“ã‚Œã¯ã€ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæŒ‡å‘ã®ã€Œç¶™æ‰¿ã€ã‚’æ­£ã—ãä½¿ã†ãŸã‚ã®ã€å°‘ã—é›£è§£ã§ã™ãŒé‡è¦ãªåŸå‰‡ã§ã™ã€‚
ä»¥é™ã€ã“ã®åŸå‰‡ã‚’ **LSP** ã¨å‘¼ã³ã¾ã™ã€‚

---

## â“ åŸå‰‡ã®å®šç¾©

> ã€Œã‚‚ã—SãŒTã®ã‚µãƒ–ã‚¿ã‚¤ãƒ—ãªã‚‰ã°ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ å†…ã§Tå‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒä½¿ã‚ã‚Œã¦ã„ã‚‹ç®‡æ‰€ã¯å…¨ã¦ã€Så‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§ç½®æ›å¯èƒ½ã§ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€‚ãã®éš›ã«ãƒ—ãƒ­ã‚°ãƒ©ãƒ ã®æŒ¯ã‚‹èˆã„ã‚’å¤‰ãˆã¦ã¯ãªã‚‰ãªã„ã€‚ã€
> 
> 
> \--- Barbara Liskov
> 

### ğŸ’¡ ç°¡å˜ã«è¨€ã†ã¨

ã€Œè¦ªã‚¯ãƒ©ã‚¹ï¼ˆåŸºåº•å‹ï¼‰ã®ä»£ã‚ã‚Šã«å­ã‚¯ãƒ©ã‚¹ï¼ˆæ´¾ç”Ÿå‹ï¼‰ã‚’ä½¿ã£ã¦ã‚‚ã€ãƒ—ãƒ­ã‚°ãƒ©ãƒ ãŒæœŸå¾…é€šã‚Šã«å‹•ãç¶šã‘ãªã‘ã‚Œã°ãªã‚‰ãªã„ã€ã¨ã„ã†ã“ã¨ã§ã™ã€‚å­ã‚¯ãƒ©ã‚¹ã¯ã€è¦ªã‚¯ãƒ©ã‚¹ã®ã€Œãƒ«ãƒ¼ãƒ«ï¼ˆæŒ¯ã‚‹èˆã„ï¼‰ã€ã‚’ç ´ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

### ğŸ¤” ãªãœé‡è¦ã‹ï¼Ÿ

LSPãŒå®ˆã‚‰ã‚Œã¦ã„ãªã„ç¶™æ‰¿é–¢ä¿‚ï¼ˆè¦ªå­é–¢ä¿‚ï¼‰ãŒã‚ã‚‹ã¨ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿã—ã¾ã™ã€‚

1. **äºˆæœŸã›ã¬å‹•ä½œ**:
è¦ªã‚¯ãƒ©ã‚¹ã®ã¤ã‚‚ã‚Šã§å­ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã£ãŸã‚‰ã€æƒ³å®šå¤–ã®å‹•ãã‚’ã—ã¦ãƒã‚°ã®åŸå› ã«ãªã‚Šã¾ã™ã€‚
2. **ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ã®ç ´ç¶»**:
ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ï¼ˆè¦ªã‚¯ãƒ©ã‚¹ã®å‹ã§ã€æ§˜ã€…ãªå­ã‚¯ãƒ©ã‚¹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’çµ±ä¸€çš„ã«æ‰±ãˆã‚‹æ€§è³ªï¼‰ãŒã†ã¾ãæ©Ÿèƒ½ã—ãªããªã‚Šã¾ã™ã€‚
3. **æ¡ä»¶åˆ†å²ã®å¢—åŠ **:
ã€Œã‚‚ã—ã“ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒã€ç‰¹åˆ¥ãªå­ã‚¯ãƒ©ã‚¹ã€ã ã£ãŸã‚‰â€¦ã€ã®ã‚ˆã†ãª `if` æ–‡ï¼ˆå‹ãƒã‚§ãƒƒã‚¯ï¼‰ãŒã‚³ãƒ¼ãƒ‰ä¸­ã«å¢—ãˆã€ã‚ªãƒ¼ãƒ—ãƒ³/ã‚¯ãƒ­ãƒ¼ã‚ºãƒ‰ã®åŸå‰‡(OCP)ã«ã‚‚é•åã—ã‚„ã™ããªã‚Šã¾ã™ã€‚

LSPã¯ã€ã€Œç¶™æ‰¿ã‚’ä½¿ã†ãªã‚‰ã€ã¡ã‚ƒã‚“ã¨ã€is-aã€ï¼ˆã€œã¯ã€œã®ä¸€ç¨®ã§ã‚ã‚‹ï¼‰é–¢ä¿‚ã‚’å®ˆã‚Šã€è¦ªã®ãƒ«ãƒ¼ãƒ«ã‚’å¼•ãç¶™ããªã•ã„ã€ã¨è¦æ±‚ã™ã‚‹åŸå‰‡ã§ã™ã€‚

---

## âœ… ã“ã‚Œã¾ã§ã®å®Ÿè·µä¾‹ï¼ˆã©ã“ã§ä½¿ã£ãŸã‹ï¼‰

ç§ãŸã¡ã¯ã€å…·è±¡ã‚¯ãƒ©ã‚¹ï¼ˆå…·ä½“çš„ãªå®Ÿè£…ã‚’æŒã¤ã‚¯ãƒ©ã‚¹ï¼‰åŒå£«ã®ç¶™æ‰¿ã‚’ã‚ã¾ã‚Šä½¿ã‚ãšã€ä¸»ã«**æŠ½è±¡åŸºåº•ã‚¯ãƒ©ã‚¹ (ABC) ã«ã‚ˆã‚‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£…**ã‚’æ´»ç”¨ã—ã¦ãã¾ã—ãŸã€‚ã“ã‚Œã¯LSPã®å•é¡Œã‚’å›é¿ã™ã‚‹ä¸Šã§éå¸¸ã«æœ‰åŠ¹ãªæˆ¦ç•¥ã§ã—ãŸã€‚

### ğŸ“Œ ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®å®Ÿè£… (ç¬¬1å·¡ã€œç¬¬5å·¡)

- **å…·ä½“ä¾‹**: `MqttWorldModelPublisher` ã‚¯ãƒ©ã‚¹ã¯ `PlanningServiceAdapterInterface` ã¨ã„ã†**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ (ABC)** ã‚’å®Ÿè£…ã—ã¾ã—ãŸã€‚
- **ãªãœLSPã‹**: `UpdateWorldModelUseCase` ã¯ `PlanningServiceAdapterInterface` å‹ã®ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’æœŸå¾…ã—ã¦ã„ã¾ã—ãŸã€‚ãã“ã« `MqttWorldModelPublisher` ã®ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒæ¸¡ã•ã‚Œã¦ã‚‚ã€`UseCase` ã¯å•é¡Œãªãå‹•ä½œã—ã¾ã—ãŸã€‚ãªãœãªã‚‰ã€`MqttWorldModelPublisher` ã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§å®šç¾©ã•ã‚ŒãŸ `publish_world_model()` ãƒ¡ã‚½ãƒƒãƒ‰ã®ã€Œå¥‘ç´„ï¼ˆï¼WorldModelã‚’å¤–éƒ¨ã«å…¬é–‹ã™ã‚‹ï¼‰ã€ã‚’**æ­£ã—ãå®ˆã£ã¦ã„ãŸ**ã‹ã‚‰ã§ã™ã€‚
ã‚‚ã— `MqttWorldModelPublisher` ã® `publish_world_model()` ãŒã€å®Ÿéš›ã«ã¯ãƒ‡ãƒ¼ã‚¿ã‚’å…¬é–‹ã›ãšã€ãƒ­ã‚°ã«å‡ºåŠ›ã™ã‚‹ã ã‘ã€ã‚ã‚‹ã„ã¯å…¨ãé•ã†å‡¦ç†ã‚’ã™ã‚‹ã‚ˆã†ãªå®Ÿè£…ã ã£ãŸã‚‰ã€ãã‚Œã¯ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã®ã€Œå¥‘ç´„ã€ã‚’ç ´ã£ã¦ãŠã‚Šã€LSPé•åã¨ãªã‚Šã¾ã™ã€‚
    
    ```
          UseCase -----> <I> PlanningServiceAdapterInterface
                              ^
                              | (implements)
                              +---- MqttWorldModelPublisher (å¥‘ç´„ã‚’å®ˆã‚‹å®Ÿè£…)
    
    ```
    

### ğŸ“Œ æŠ½è±¡åŒ–ã«ã‚ˆã‚‹æŒ¯ã‚‹èˆã„ã®çµ±ä¸€

- **å…·ä½“ä¾‹**: `UseCase` ãŒä¾å­˜ã™ã‚‹ `SensorInterface` ã‚„ `WorldModelRepositoryInterface` ã‚‚åŒæ§˜ã§ã™ã€‚
- **ãªãœLSPã‹**: `UseCase` ã¯ã“ã‚Œã‚‰ã®ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’é€šã˜ã¦ã€å…·ä½“çš„ãªå®Ÿè£…ï¼ˆ`StubSensorAdapter` ã‚„ `InMemoryWorldModelRepository`ï¼‰ã¨ã‚„ã‚Šå–ã‚Šã—ã¾ã—ãŸã€‚ã“ã‚Œã‚‰ã®ã‚¢ãƒ€ãƒ—ã‚¿ã‚¯ãƒ©ã‚¹ã¯ã€ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§å®šç¾©ã•ã‚ŒãŸãƒ¡ã‚½ãƒƒãƒ‰ï¼ˆ`get_camera_image()`, `save()` ãªã©ï¼‰ã®**æœŸå¾…ã•ã‚Œã‚‹æŒ¯ã‚‹èˆã„**ï¼ˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã™ã‚‹ã€ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜ã™ã‚‹ï¼‰ã‚’æ­£ã—ãå®Ÿè£…ã—ã¦ã„ãŸãŸã‚ã€`UseCase` ã¯ã‚¢ãƒ€ãƒ—ã‚¿ã®ç¨®é¡ã«é–¢ã‚ã‚‰ãšï¼ˆç½®æ›ã—ã¦ã‚‚ï¼‰ä¸€è²«ã—ãŸå‹•ä½œã‚’æœŸå¾…ã§ãã¾ã—ãŸã€‚

---

## âŒ é–“é•ã£ãŸé©ç”¨ä¾‹ï¼ˆã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼‰

LSPã«é•åã™ã‚‹æœ€ã‚‚æœ‰åãªä¾‹ã¯ã€Œæ­£æ–¹å½¢ã¨é•·æ–¹å½¢ã€ã®å•é¡Œã§ã™ã€‚

- **ä¾‹1ï¼šæ­£æ–¹å½¢ã¯é•·æ–¹å½¢ã‹ï¼Ÿ (Square/Rectangle Problem)**
æ•°å­¦çš„ã«ã¯ã€Œæ­£æ–¹å½¢ã¯é•·æ–¹å½¢ã®ä¸€ç¨® (is-a)ã€ãªã®ã§ã€ã‚¯ãƒ©ã‚¹ç¶™æ‰¿ã‚’ä½¿ã„ãŸããªã‚Šã¾ã™ã€‚
    
    ```python
    # ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼šLSPé•åã®ç¶™æ‰¿
    class Rectangle:
        def __init__(self, width: float, height: float):
            self._width = width
            self._height = height
    
        def set_width(self, width: float):
            self._width = width
    
        def set_height(self, height: float):
            self._height = height
    
        def get_area(self) -> float:
            return self._width * self._height
    
    class Square(Rectangle):
        # æ­£æ–¹å½¢ã¯å¹…ã¨é«˜ã•ãŒå¸¸ã«ç­‰ã—ã„
        def __init__(self, size: float):
            super().__init__(size, size)
    
        # è¦ªã‚¯ãƒ©ã‚¹ã®æŒ¯ã‚‹èˆã„ã‚’å¤‰æ›´ï¼ˆãƒ«ãƒ¼ãƒ«ã‚’ç ´ã‚‹ï¼‰
        def set_width(self, width: float):
            self._width = width
            self._height = width # å¹…ã‚’å¤‰ãˆãŸã‚‰é«˜ã•ã‚‚å¤‰ã‚ã‚‹ï¼
    
        def set_height(self, height: float):
            self._width = height # é«˜ã•ã‚’å¤‰ãˆãŸã‚‰å¹…ã‚‚å¤‰ã‚ã‚‹ï¼
            self._height = height
    
    # --- ã“ã®é–¢æ•°ã¯ Rectangle ã‚’æœŸå¾…ã—ã¦ã„ã‚‹ ---
    def print_area_after_resize(rect: Rectangle, new_width: float, new_height: float):
        # ã“ã®é–¢æ•°ã‚’æ›¸ã„ãŸäººã¯ã€å¹…ã¨é«˜ã•ã‚’ç‹¬ç«‹ã—ã¦å¤‰æ›´ã§ãã‚‹ã¨æœŸå¾…ã—ã¦ã„ã‚‹
        rect.set_width(new_width)
        rect.set_height(new_height)
        # æœŸå¾…ã™ã‚‹é¢ç©: new_width * new_height
        print(f"Expected area: {new_width * new_height}")
        print(f"Actual area: {rect.get_area()}")
    
    # --- ä½¿ã£ã¦ã¿ã‚‹ ---
    rectangle = Rectangle(2, 3)
    square = Square(5)
    
    print("Resizing Rectangle:")
    print_area_after_resize(rectangle, 4, 6)
    # Expected area: 24
    # Actual area: 24  <-- OK!
    
    print("\\nResizing Square (as Rectangle):")
    print_area_after_resize(square, 4, 6)
    # Expected area: 24
    # Actual area: 36  <-- NG! æœŸå¾…ã¨é•ã†ï¼ (set_height(6)ã§å¹…ã‚‚6ã«ãªã£ãŸãŸã‚)
    
    ```
    
    `Square` ã‚¯ãƒ©ã‚¹ã¯ã€è¦ªã‚¯ãƒ©ã‚¹ `Rectangle` ã®ã€Œå¹…ã¨é«˜ã•ã‚’ç‹¬ç«‹ã—ã¦è¨­å®šã§ãã‚‹ã€ã¨ã„ã†\*\*æš—é»™ã®ãƒ«ãƒ¼ãƒ«ï¼ˆä¸å¤‰æ¡ä»¶ï¼‰\*\*ã‚’ç ´ã£ã¦ã„ã¾ã™ã€‚ãã®ãŸã‚ã€`Rectangle` å‹ã¨ã—ã¦ `Square` ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’ä½¿ã†ã¨ã€äºˆæœŸã›ã¬å‹•ä½œï¼ˆé¢ç©ãŒæœŸå¾…é€šã‚Šã«ãªã‚‰ãªã„ï¼‰ã‚’å¼•ãèµ·ã“ã—ã¾ã—ãŸã€‚ã“ã‚Œã¯å…¸å‹çš„ãªLSPé•åã§ã™ã€‚ç¶™æ‰¿ã™ã¹ãã§ã¯ã‚ã‚Šã¾ã›ã‚“ã§ã—ãŸã€‚
    
- **ä¾‹2ï¼šãƒ¡ã‚½ãƒƒãƒ‰ã®äº‹å‰æ¡ä»¶ã‚’å¼·ã‚ã‚‹ / äº‹å¾Œæ¡ä»¶ã‚’å¼±ã‚ã‚‹**
å­ã‚¯ãƒ©ã‚¹ãŒè¦ªã‚¯ãƒ©ã‚¹ã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ã‚ªãƒ¼ãƒãƒ¼ãƒ©ã‚¤ãƒ‰ã™ã‚‹éš›ã«ã€
    - **äº‹å‰æ¡ä»¶ (Precondition) ã‚’å¼·ã‚ã‚‹**: è¦ªã‚¯ãƒ©ã‚¹ã‚ˆã‚Šã‚‚ã€Œå³ã—ã„ã€å¼•æ•°ã—ã‹å—ã‘ä»˜ã‘ãªããªã‚‹ã€‚ï¼ˆä¾‹ï¼šè¦ªã¯intã‚’å—ã‘ä»˜ã‘ã‚‹ã®ã«ã€å­ã¯æ­£ã®intã—ã‹å—ã‘ä»˜ã‘ãªã„ï¼‰
    - **äº‹å¾Œæ¡ä»¶ (Postcondition) ã‚’å¼±ã‚ã‚‹**: è¦ªã‚¯ãƒ©ã‚¹ã‚ˆã‚Šã‚‚ã€Œç·©ã„ã€çµæœã—ã‹ä¿è¨¼ã—ãªããªã‚‹ã€‚ï¼ˆä¾‹ï¼šè¦ªã¯ã‚½ãƒ¼ãƒˆæ¸ˆã¿ãƒªã‚¹ãƒˆã‚’è¿”ã™ã¨ç´„æŸã—ã¦ã„ãŸã®ã«ã€å­ã¯æœªã‚½ãƒ¼ãƒˆãƒªã‚¹ãƒˆã‚’è¿”ã™ã“ã¨ãŒã‚ã‚‹ï¼‰
    ã“ã‚Œã‚‰ã‚‚LSPé•åã¨ãªã‚Šã¾ã™ã€‚è¦ªã‚¯ãƒ©ã‚¹ã‚’ä½¿ã£ã¦ã„ãŸã‚³ãƒ¼ãƒ‰ãŒã€å­ã‚¯ãƒ©ã‚¹ã§å‹•ã‹ãªããªã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãŸã‚ã§ã™ã€‚

---

## ğŸ“ ã¾ã¨ã‚

ãƒªã‚¹ã‚³ãƒ•ã®ç½®æ›åŸå‰‡(LSP)ã¯ã€ã€Œ**ç¶™æ‰¿ã‚’ä½¿ã†ãªã‚‰ã€å­ã‚¯ãƒ©ã‚¹ã¯è¦ªã‚¯ãƒ©ã‚¹ã®ã€ãµã‚Šã€ã‚’ã—ç¶šã‘ãªã‘ã‚Œã°ãªã‚‰ãªã„**ã€ã¨ã„ã†ãƒ«ãƒ¼ãƒ«ã§ã™ã€‚è¦ªã‚¯ãƒ©ã‚¹ã®æœŸå¾…ã•ã‚Œã‚‹æŒ¯ã‚‹èˆã„ã‚„å¥‘ç´„ã‚’ã€å­ã‚¯ãƒ©ã‚¹ãŒç ´ã£ã¦ã¯ã„ã‘ã¾ã›ã‚“ã€‚

ã“ã®åŸå‰‡ã‚’å®ˆã‚‹ã“ã¨ã§ã€ãƒãƒªãƒ¢ãƒ¼ãƒ•ã‚£ã‚ºãƒ ãŒæ­£ã—ãæ©Ÿèƒ½ã—ã€å®‰å…¨ã§äºˆæ¸¬å¯èƒ½ãªã‚³ãƒ¼ãƒ‰ã‚’æ›¸ãã“ã¨ãŒã§ãã¾ã™ã€‚

ç¾å®Ÿçš„ã«ã¯ã€å…·è±¡ã‚¯ãƒ©ã‚¹ã®ç¶™æ‰¿ã¯LSPé•åã‚’å¼•ãèµ·ã“ã—ã‚„ã™ã„ãŸã‚ã€ä»Šå›ã®ã‚«ãƒªã‚­ãƒ¥ãƒ©ãƒ ã®ã‚ˆã†ã«**ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼ˆABCï¼‰ã«å¯¾ã™ã‚‹å®Ÿè£…**ã‚’ä½¿ã†æ–¹ãŒã€å¤šãã®å ´åˆã§ã‚ˆã‚Šå®‰å…¨ã§æŸ”è»Ÿãªè¨­è¨ˆã¨ãªã‚Šã¾ã™ã€‚

---

## â¡ï¸ æ¬¡ã¸

æ¬¡ã¯ã€SOLIDåŸå‰‡ã®4ç•ªç›®ã€ã€Œ**Iï¼šã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹åˆ†é›¢ã®åŸå‰‡**ã€ã«ã¤ã„ã¦è¦‹ã¦ã„ãã¾ã—ã‚‡ã†ã€‚