# 3. 境界づけられたコンテキスト

# 🏛️ 戦略的設計：境界づけられたコンテキスト

DDD（ドメイン駆動設計）の戦略的設計において、最も重要で中心的な概念が「**境界づけられたコンテキスト (Bounded Context)**」です。これは、ユビキタス言語が有効な「範囲」を定義し、複雑なドメインを分割するための鍵となります。

---

## ❓ 境界づけられたコンテキストとは？

> 特定のドメインモデル（および対応するユビキタス言語）が、一貫性を持ち、明確な意味を持つ、明示的な境界のこと。
> 

### 💡 簡単に言うと

モデルや言葉（ユビキタス言語）の意味が**一つに定まる「縄張り」**のことです。この縄張りの内側では、「顧客」と言えば必ず同じ意味を指しますが、縄張りの外側では「顧客」が違う意味で使われているかもしれません。

### 🤔 なぜ重要か？

大規模で複雑なドメイン全体で、完全に一貫した単一のモデル（＝全員が同じ意味で言葉を使う世界）を維持しようとすると、以下のような問題が生じます。

1. **モデルの矛盾と肥大化**:
部署やチームが異なれば、同じ「商品」でも関心事（価格、在庫数、説明文、レビューなど）が異なります。これらを無理に一つの巨大な「商品」クラスに詰め込もうとすると、クラスは肥大化し、矛盾したルール（例：販売部門は価格を変更したいが、カタログ部門は変更されたくない）を抱え込みやすくなります。
2. **コミュニケーションのオーバーヘッド**:
全員が常に同じ言葉を同じ意味で使うように調整し続けるのは、非常にコストがかかります。
3. **チームの自律性の阻害**:
あるチームがモデルの一部を変更したい場合でも、その変更がドメイン全体（他のチーム）に与える影響を常に考慮しなければならず、迅速な開発が妨げられます。

境界づけられたコンテキスト（Bounded Context - BC）を導入することで、ドメインを意図的に分割し、**各コンテキストの「内側」ではモデルと言語の一貫性を保ちつつ**、**コンテキストの「間」ではモデルや言語が異なることを許容**します。これにより、各チームは自身のコンテキスト内で自律的にモデルを進化させることができます。

---

## 🗣️ ユビキタス言語との関係

ユビキタス言語と境界づけられたコンテキストは密接に関連しています。

- **境界づけられたコンテキストは、特定のユビキタス言語が適用される範囲を定義します。**
- 逆に言えば、**ユビキタス言語の意味が変わる場所、通用しなくなる場所が、コンテキストの境界のヒント**となります。

例えば、「サポート」コンテキストでの「チケット」と、「開発」コンテキストでの「チケット（Issue）」は、同じ言葉でも意味やライフサイクルが全く異なります。これは、それぞれが別の境界づけられたコンテキストに属するべきであることを示唆します。

---

## ✅ これまでの実践例（どこで使ったか）

私たちの自動駐車システムは、比較的シンプルでしたが、サービス分割が暗黙的に境界づけられたコンテキストの考え方を反映していました。

### 📌 サービス分割 (第4巡, 第5巡)

- **具体例**: 「認識」「経路計算」「制御」という3つのサービスに分割しました。
- **実践**:
    - **認識コンテキスト**: 主な関心事は「センサーデータの解釈」と「`WorldModel` の構築」。ユビキタス言語には「オブジェクト検出」「駐車スペース認識」などが含まれます。
    - **経路計算コンテキスト**: 主な関心事は「`WorldModel` の解釈」と「`ParkingPlan` の生成」。ユビキタス言語には「経路探索アルゴリズム」「衝突回避」「制御コマンド」などが含まれます。
    - **制御コンテキスト**: 主な関心事は「`ParkingPlan` の解釈」と「アクチュエータへの指示」。ユビキタス言語には「ステアリング制御」「スロットル制御」「実行シーケンス」などが含まれます。
    
    これらは、それぞれ異なる専門知識と言語（ユビキタス言語）を持つ領域であり、自然と境界づけられたコンテキストとして機能していました。サービス間の連携は、明確に定義されたデータ（`WorldModel`, `ParkingPlan`）のみで行われました。
    

---

## ❌ 間違った適用例（アンチパターン）

境界づけられたコンテキストを意識しないと、モデルや言語の混乱、チーム間の不要な依存関係が生じます。

- **例1：ドメイン全体で単一の巨大モデルを目指す**
ECサイト全体で、ただ一つの巨大な `Product` クラス（カタログ情報、在庫情報、価格情報、レビュー情報などをすべて含む）を定義し、すべてのチーム（カタログ管理、在庫管理、注文処理、レビュー管理）がそれを共有・変更しようとする。結果として、クラスは肥大化し、変更の影響範囲が広がり、チーム間の調整コストが増大します。
- **例2：コンテキスト境界を越えて内部モデルを共有・変更する**
「注文」コンテキストが、「在庫」コンテキストのデータベーステーブル（内部モデル）を直接更新して在庫数を減らすような実装。これは境界（と自律性）を侵害しており、「在庫」コンテキストの変更が「注文」コンテキストを破壊する可能性があります。在庫の変更は、「在庫」コンテキストが公開するAPI（契約）を通じて依頼すべきです。
- **例3：ユビキタス言語の不一致に気づかず開発を進める**
「マーケティング」チームが言う「キャンペーン」と、「課金」チームが言う「キャンペーン（割引コード）」の意味が違うのに、同じ `Campaign` クラスで無理やり表現しようとして混乱する。それぞれのコンテキストで別の言葉（例：`PromotionCampaign` と `DiscountCodeCampaign`）を使うか、明確に別のモデルとして定義すべきです。

---

## 📝 まとめ

境界づけられたコンテキスト(BC)は、**ドメインモデルと言語（ユビキタス言語）の一貫性が保たれる範囲を明確に区切る**、戦略的設計の核心的なプラクティスです。

BCを適切に設定することで、

- 複雑なドメインを管理可能な単位に分割できる。
- 各チームが自身のコンテキスト内で自律的にモデルを進化させられる。
- SOAやマイクロサービスの適切な境界線を見つけるための強力な指針となる。

「どこまでが同じ言葉・同じルールで語れる範囲か？」を常に意識することが、BCを見つける第一歩です。

---

## ➡️ 次へ

次は、分割した境界づけられたコンテキスト同士が、どのように連携するのかを可視化する「**コンテキストマップ**」について見ていきましょう。