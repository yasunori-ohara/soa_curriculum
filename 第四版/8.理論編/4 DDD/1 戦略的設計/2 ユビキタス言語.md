# 2. ユビキタス言語

# 🏛️ 戦略的設計：ユビキタス言語

DDD（ドメイン駆動設計）の**戦略的設計**は、「複雑なドメインをどう分割するか」という問いに答えるための考え方です。その全ての活動の基礎となるのが、「**ユビキタス言語 (Ubiquitous Language)**」という概念です。

---

## ❓ ユビキタス言語とは？

> ドメインエキスパート（業務の専門家）とソフトウェア開発者が、プロジェクトに関わる全てのコミュニケーション（会話、ドキュメント、そしてコード！）において使用する、厳密に定義された共通言語。
> 

### 💡 簡単に言うと

プロジェクトチーム全員が使う「**共通の用語集**」です。ただし、単なる用語集ではなく、その言葉がビジネス（ドメイン）において持つ「**意味**」や「**ニュアンス**」まで含めて共有します。

### 🤔 なぜ重要か？

ソフトウェア開発における多くの問題は、コミュニケーションの齟齬（そご）から生まれます。

1. **誤解と曖昧さの排除**:
同じ言葉でも、立場によって違う意味で使われていることがあります（例：営業の言う「顧客」とサポートの言う「顧客」）。ユビキタス言語を定義し徹底することで、このような誤解を防ぎ、要求や仕様が曖昧になるのを防ぎます。
2. **ドメイン知識の共有**:
開発者はドメインエキスパートが使う言葉を通じて、ビジネスの深い理解を得ることができます。逆に、ドメインエキスパートも、開発者がその言葉をどのようにコードに反映しているかを見ることで、ソフトウェアへの理解が深まります。
3. **モデルとコードの直結**:
ユビキタス言語で使われる名詞や動詞は、そのままソフトウェアのモデル（クラス名、メソッド名、変数名など）に反映されるべきです。これにより、コードがドメインの概念を直接的に表現し、ビジネスの変化に追従しやすくなります。
4. **境界の発見**:
会話の中で、「あれ、この『商品』って、こっちのチームが言う『商品』と意味が違うぞ？」と気づくことがあります。ユビキタス言語が**通用しなくなる場所**、それが後で学ぶ「境界づけられたコンテキスト」を見つける重要なヒントになります。

---

## ✅ これまでの実践例（どこで使ったか）

私たちは、比較的シンプルなドメインを扱ってきたため、ユビキタス言語を厳密に定義する必要はあまりありませんでした。しかし、その考え方の片鱗は現れています。

### 📌 命名における意識 (第1巡〜第5巡)

- **具体例**: 認識サービスが生成するデータを `WorldModel`、経路計算サービスの出力を `ParkingPlan`、制御命令を `ControlCommand` と名付けました。
- **実践**: これらは、ドメイン（自動駐車）における重要な概念を表す言葉であり、チーム（私たち）の中で共通認識を持って使っていました。もし認識サービスの出力を単に `OutputData` や `Result` と呼んでいたら、それが何を表すのか曖昧になっていたでしょう。`WorldModel` という（少し専門的な）言葉を選ぶことで、「これは現状の環境マップなんだ」という意図が明確になりました。

### 📌 コードとドメイン概念の一致

- **具体例**: `WorldModel` Entity に `update_objects()` というメソッドを定義しました。
- **実践**: これは「世界モデル内のオブジェクト情報を更新する」というドメインの操作を直接的にコード（メソッド名）に反映した例です。もしこれが `setData()` や `process()` のような曖昧な名前だったら、コードからドメインの意図を読み取るのが難しくなります。

---

## 🗣️ ユビキタス言語を育むには？

ユビキタス言語は、一度作って終わりではなく、プロジェクトを通じて**継続的に**育てていくものです。

1. **ドメインエキスパートとの対話**:
開発者は積極的にドメインエキスパートと会話し、彼らが使う言葉、その意味、背景にあるビジネスルールを深く理解しようと努めます。疑問があればすぐに確認し、認識のズレを修正します。
2. **用語集（グロッサリー）の作成・維持**:
プロジェクトで使う重要な言葉とその定義を、チーム全員が見られる場所にまとめ、常に最新の状態に保ちます。（Wiki、共有ドキュメントなど）
3. **モデルやコードへの反映**:
会話や用語集で定義された言葉を、そのままクラス名、メソッド名、変数名、さらにはデータベースのテーブル名やカラム名、APIのエンドポイント名などに積極的に使います。コードが「ドメインを語る」ようにします。
4. **図やドキュメントでの使用**:
設計図（UMLなど）や仕様書、テストコードにおいても、一貫してユビキタス言語を使います。

---

## ❌ 間違った適用例（アンチパターン）

ユビキタス言語が根付いていないプロジェクトでは、以下のような問題が起こりがちです。

- **例1：翻訳レイヤーの存在**
ドメインエキスパートが「引当可能在庫」と言っているのに、開発者はコード内で `available_stock` や `reservable_inventory` など、人によって違う英語（あるいは日本語のローマ字）を使い、頭の中で常に「翻訳」しながら会話やコーディングをしている状態。
- **例2：技術用語の汚染**
ドメインエキスパートとの会話で、「この `UserEntity` の `primary_key` が…」のように、ビジネスの話の中に実装の詳細（技術用語）が不必要に混じってしまう。ユビキタス言語は、ドメイン（ビジネス）の言葉であるべきです。
- **例3：コードと現実の乖離（かいり）**
コード上の `Customer` クラスが、実際のビジネスで言う「お得意様」とは違う意味（例：単なるWebサイト訪問者も含む）で使われている。コードがビジネスの実態を正しく反映していません。

---

## 📝 まとめ

ユビキタス言語は、DDDの全ての活動の**基礎**となる、チーム全員の「**共通言語**」です。

ドメインエキスパートと開発者が密に連携し、この共通言語を定義し、育て、会話からコードまで**一貫して**使い続けることで、ドメインの複雑さに効果的に立ち向かうことができます。

良いユビキタス言語は、良いドメインモデル（そして良いソフトウェア）の土台となります。

---

## ➡️ 次へ

次は、このユビキタス言語が通用する範囲を区切る、戦略的設計の核心「**境界づけられたコンテキスト**」について見ていきましょう。