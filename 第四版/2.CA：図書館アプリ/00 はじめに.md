# 00 ã¯ã˜ã‚ã«

# ğŸ“š ã¯ã˜ã‚ã«ï¼šã‚·ãƒ³ãƒ—ãƒ«ãªå›³æ›¸é¤¨ã®è²¸å‡ºç®¡ç†ã‚·ã‚¹ãƒ†ãƒ 

TODOã‚¢ãƒ—ãƒªã‚ˆã‚Šä¸€æ­©é€²ã‚“ã§ã€ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ã‚’ã‚ˆã‚Šè±Šã‹ã«æ‰±ãˆã‚‹é¡Œæã¨ã—ã¦
**ã€Œã‚·ãƒ³ãƒ—ãƒ«ãªå›³æ›¸é¤¨ã®è²¸å‡ºç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã€** ã‚’æ§‹ç¯‰ã—ã¦ã„ãã¾ã™ã€‚

---

## ğŸŒŸ ã“ã®é¡ŒæãŒå„ªã‚Œã¦ã„ã‚‹ç†ç”±

### 1. çŠ¶æ…‹ã‚’æŒã¤ãƒªãƒƒãƒãª Entity

TODO ã® `Task` ã¯ã€Œå®Œäº† / æœªå®Œäº†ã€ã—ã‹çŠ¶æ…‹ã‚’æŒã¡ã¾ã›ã‚“ã§ã—ãŸãŒã€
å›³æ›¸é¤¨ã® `Book` ã¯ã€Œè²¸å‡ºå¯èƒ½ã€ã€Œè²¸å‡ºä¸­ã€ã€Œç´›å¤±ä¸­ã€ãªã©ã®è¤‡æ•°ã®çŠ¶æ…‹ã‚’æŒã¡ã¾ã™ã€‚

ã•ã‚‰ã«ã€ã€Œæœ¬ã€ã¨ã€Œä¼šå“¡ã€ã®é–¢ä¿‚ã‚’è¡¨ã™ `Loan`ï¼ˆè²¸å‡ºè¨˜éŒ²ï¼‰ã¨ã„ã† Entity ã¯
**æ¥­å‹™ã®ä¸­å¿ƒãƒ­ã‚¸ãƒƒã‚¯ï¼ˆè²¸å‡ºãƒ»è¿”å´ãƒ»å»¶æ»ï¼‰** ã‚’æ‹…ã†é‡è¦ãªå­˜åœ¨ã§ã™ã€‚

> â†’ Entity è‡ªèº«ãŒçŠ¶æ…‹é·ç§»ã‚’ç®¡ç†ã™ã‚‹ï¼ˆ`book.check_out()` ãªã©ï¼‰ç‚¹ãŒå­¦ç¿’åŠ¹æœå¤§ã§ã™ã€‚

---

### 2. è¤‡é›‘ãª Use Case ã‚’æ‰±ã†

ã€Œæœ¬ã‚’è²¸ã—å‡ºã™ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã«ã¯ï¼š

* ä¼šå“¡ã®è³‡æ ¼ç¢ºèª
* æœ¬ã®åœ¨åº«çŠ¶æ…‹ãƒã‚§ãƒƒã‚¯
* `Loan` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã®ç”Ÿæˆã¨è¿”å´æœŸé™ã®ç®—å‡º
* é–¢é€£ã™ã‚‹ `Book`ãƒ»`Loan` ã®æ°¸ç¶šåŒ–

ã¨ã„ã£ãŸå®Ÿå‹™ã«è¿‘ã„æµã‚ŒãŒå«ã¾ã‚Œã¾ã™ã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€**UseCase ã¨ Entity ã®å½¹å‰²ã®é•ã„**ãŒã‚ˆã‚Šé®®æ˜ã«ãªã‚Šã¾ã™ã€‚

---

### 3. ã€Œä¾å­˜æ€§ã®æ–¹å‘ã€ãŒã‚ˆã‚Šä½“æ„Ÿã§ãã‚‹

UIï¼ˆå¸æ›¸ãŒæ“ä½œã™ã‚‹ç”»é¢ï¼‰ã‚„DBï¼ˆPostgreSQLãªã©ï¼‰ã¨ã„ã£ãŸ**æŠ€è¡“çš„ãªè©³ç´°ï¼ˆå¤–å´ï¼‰**ãŒã€
**ãƒ“ã‚¸ãƒã‚¹ãƒ«ãƒ¼ãƒ«ï¼ˆå†…å´ï¼‰** ã«å½±éŸ¿ã‚’åŠã¼ã•ãªã„ã‚ˆã†ã«è¨­è¨ˆã—ã¾ã™ã€‚

* `Loan` ã‚„ `Book` ãŒ DB ã«ç›´æ¥è§¦ã‚‰ãªã„
* UseCase ãŒæŠ½è±¡çš„ãª `Repository` ã«ã®ã¿ä¾å­˜ã™ã‚‹

ã“ã‚ŒãŒ **ä¾å­˜æ€§é€†è»¢ã®åŸå‰‡ï¼ˆDIPï¼‰** ã®å…·ä½“ä¾‹ã§ã™ã€‚

---

## ğŸ§© ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã®ç™»å ´äººç‰©

![ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£](../ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ãƒ»ã‚¯ãƒ©ã‚¹å›³.png)

| å±¤                | ã‚¯ãƒ©ã‚¹ / ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹               | å½¹å‰²                       | å±¤ã®ä½ç½®                                                     |
| ---------------- | ---------------------------- | ------------------------ | -------------------------------------------------------- |
| **Entities**     | `Book`                       | æ›¸ç±ã€‚è²¸å‡ºçŠ¶æ…‹ã‚’æŒã¡ã€çŠ¶æ…‹é·ç§»ãƒ­ã‚¸ãƒƒã‚¯ã‚’å‚™ãˆã‚‹  | core/domain                                              |
|                  | `Member`                     | ä¼šå“¡ã€‚è³‡æ ¼ã‚„è²¸å‡ºåˆ¶é™ãªã©ã®ãƒ­ã‚¸ãƒƒã‚¯ã‚’æŒã¤     | core/domain                                              |
|                  | `Loan`                       | è²¸å‡ºè¨˜éŒ²ã€‚ã©ã®æœ¬ã‚’èª°ã«ã„ã¤è²¸ã—ãŸã‹ã‚’ç®¡ç†     | core/domain                                              |
| **UseCaseå±¤ DTO** | `CheckOutBookInputData`      | Controllerâ†’UseCase é–“ã®ãƒ‡ãƒ¼ã‚¿ | core/usecase/boundary/dto.py                             |
|                  | `CheckOutBookOutputData`     | UseCaseâ†’Presenter é–“ã®ãƒ‡ãƒ¼ã‚¿  | core/usecase/boundary/dto.py                             |
| **Boundaries**   | `CheckOutBookInputBoundary`  | UseCase ã®å…¥åŠ›ãƒãƒ¼ãƒˆ           | core/usecase/boundary/input_boundary.py                  |
|                  | `CheckOutBookOutputBoundary` | UseCase ã®å‡ºåŠ›ãƒãƒ¼ãƒˆ           | core/usecase/boundary/output_boundary.py                 |
| **Repositories** | `BookRepository`             | æ›¸ç±æ°¸ç¶šåŒ–ã®æŠ½è±¡I/F              | core/domain/repository.py                                |
|                  | `MemberRepository`           | ä¼šå“¡æ°¸ç¶šåŒ–ã®æŠ½è±¡I/F              | core/domain/repository.py                                |
|                  | `LoanRepository`             | è²¸å‡ºè¨˜éŒ²æ°¸ç¶šåŒ–ã®æŠ½è±¡I/F            | core/domain/repository.py                                |
| **UseCase**      | `CheckOutBookInteractor`     | ã€Œæœ¬ã‚’è²¸ã—å‡ºã™ã€ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®æœ¬ä½“        | core/usecase/interactor/checkout_book.py                 |
| **Adapters**     | `CheckOutBookController`     | UIå…¥åŠ›ã‚’UseCaseã«æ¸¡ã™          | interface_adapters/controllers/book_controller.py        |
|                  | `CheckOutBookPresenter`      | å‡ºåŠ›ãƒ‡ãƒ¼ã‚¿ã‚’ ViewModel ã«æ•´å½¢     | interface_adapters/presenters/book_presenter.py          |
|                  | `InMemoryBookRepository`     | Repositoryã®ãƒ¡ãƒ¢ãƒªå®Ÿè£…         | infrastructure/repositories/in_memory_book_repository.py |

---

## ğŸ“ ãƒ•ã‚©ãƒ«ãƒ€æ§‹æˆ

```text
clean_architecture_library/
â”œâ”€ core/
â”‚   â”œâ”€ domain/
â”‚   â”‚   â”œâ”€ book.py
â”‚   â”‚   â”œâ”€ member.py
â”‚   â”‚   â”œâ”€ loan.py
â”‚   â”‚   â”œâ”€ repository.py
â”‚   â”‚   â””â”€ errors.py
â”‚   â”‚
â”‚   â””â”€ usecase/
â”‚       â”œâ”€ interactor/
â”‚       â”‚   â””â”€ checkout_book.py
â”‚       â””â”€ boundary/
â”‚           â”œâ”€ input_boundary.py
â”‚           â”œâ”€ output_boundary.py
â”‚           â””â”€ dto.py
â”‚
â”œâ”€ interface_adapters/
â”‚   â”œâ”€ controllers/
â”‚   â”‚   â””â”€ book_controller.py
â”‚   â”œâ”€ presenters/
â”‚   â”‚   â””â”€ book_presenter.py
â”‚   â””â”€ views/
â”‚       â”œâ”€ view_console.py
â”‚       â”œâ”€ view_web.py
â”‚       â””â”€ view_gui.py
â”‚
â”œâ”€ infrastructure/
â”‚   â””â”€ repositories/
â”‚       â”œâ”€ in_memory_book_repository.py
â”‚       â”œâ”€ in_memory_member_repository.py
â”‚       â”œâ”€ in_memory_loan_repository.py
â”‚       â””â”€ postgres_book_repository.py
â”‚
â”œâ”€ tests/
â”‚   â”œâ”€ unit/
â”‚   â”‚   â”œâ”€ test_checkout_book_usecase.py
â”‚   â”‚   â”œâ”€ test_controller.py
â”‚   â”‚   â”œâ”€ test_presenter.py
â”‚   â”‚   â””â”€ test_repository_inmemory.py
â”‚   â””â”€ conftest.py
â”‚
â”œâ”€ logs/
â”‚   â””â”€ app.log
â”‚
â””â”€ main.py
```

> ã“ã®æ§‹æˆã¯ç¬¬1å·¡(ToDoã‚¢ãƒ—ãƒª)ã¨å…¨ãåŒã˜å±¤æ§‹é€ ã§ã™ã€‚
> **ãƒ‰ãƒ¡ã‚¤ãƒ³ãŒå¤‰ã‚ã£ã¦ã‚‚ã€ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã¯å¤‰ã‚ã‚‰ãªã„** â€• ã“ã‚ŒãŒæ•™æã®ç‹™ã„ã§ã™ã€‚

---

## ğŸš€ ã‚·ãƒŠãƒªã‚ªï¼šã€Œæœ¬ã®è²¸å‡ºã€ãƒ•ãƒ­ãƒ¼

1. `CheckOutBookController` ãŒ `member_id` ã¨ `book_id` ã‚’å—ã‘å–ã‚‹
2. UseCase (`CheckOutBookInteractor`) ãŒ `MemberRepository` ã¨ `BookRepository` ã‚’ç”¨ã„ã¦å¯¾è±¡ã‚’æ¤œç´¢
3. `Member` ã®è³‡æ ¼ç¢ºèªã€`Book` ã®çŠ¶æ…‹ç¢ºèªã‚’è¡Œã†
4. å•é¡Œãªã‘ã‚Œã° `Loan` ã‚¨ãƒ³ãƒ†ã‚£ãƒ†ã‚£ã‚’ç”Ÿæˆã—ã€è¿”å´æœŸé™ã‚’è¨­å®š
5. `Book` ã®çŠ¶æ…‹ã‚’ `check_out()` ã§æ›´æ–°ï¼ˆè²¸å‡ºä¸­ã¸ï¼‰
6. å¤‰æ›´ã•ã‚ŒãŸ `Book` ã¨ `Loan` ã‚’ãã‚Œãã‚Œã® `Repository` çµŒç”±ã§æ°¸ç¶šåŒ–
7. çµæœã‚’ `CheckOutBookOutputData` ã«è©°ã‚ã€`CheckOutBookPresenter` ã«æ¸¡ã™
8. PresenterãŒViewModelã‚’æ›´æ–°ã—ã€ViewãŒç”»é¢ã«åæ˜ ã™ã‚‹

â†’ ã“ã“ã§ä¸€åº¦ã‚‚DBãƒ»UIã«ç›´æ¥ä¾å­˜ã—ã¾ã›ã‚“ã€‚
ã€Œãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã ã‘ã§å‹•ãã€ï¼ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“ãªæ§‹é€ ã§ã™ã€‚

---

## ğŸ’¡ ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆã®ä¾‹ï¼ˆè²¬å‹™ã‚’å®ˆã£ã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèªï¼‰

```python
def test_è²¸å‡ºãŒæˆåŠŸã™ã‚‹ã‚·ãƒŠãƒªã‚ª():
    # Arrange
    mock_book_repo = MockBookRepository(è²¸å‡ºå¯èƒ½ãªæœ¬)
    mock_member_repo = MockMemberRepository(æœ‰åŠ¹ãªä¼šå“¡)
    mock_loan_repo = MockLoanRepository()
    mock_presenter = MockPresenter()

    interactor = CheckOutBookInteractor(
        book_repo=mock_book_repo,
        member_repo=mock_member_repo,
        loan_repo=mock_loan_repo,
        presenter=mock_presenter,
    )

    # Act
    input_data = CheckOutBookInputData(member_id="M001", book_id="B001")
    interactor.execute(input_data)

    # Assert
    assert mock_book_repo.last_saved.status == "è²¸å‡ºä¸­"
    assert mock_loan_repo.saved_count == 1
    assert mock_presenter.last_output.success is True
```

---

## ğŸ§  Pythonã¨Cè¨€èªã®å¯¾æ¯”

| è¦³ç‚¹              | Pythonç‰ˆï¼ˆOOPï¼‰           | Cè¨€èªç‰ˆï¼ˆæ‰‹ç¶šãå‹ï¼‰        |
| --------------- | ---------------------- | ----------------- |
| ãƒ‡ãƒ¼ã‚¿ã¨ãƒ­ã‚¸ãƒƒã‚¯        | `Book` ã‚¯ãƒ©ã‚¹ãŒè‡ªåˆ†ã§çŠ¶æ…‹é·ç§»     | æ§‹é€ ä½“ + é–¢æ•°ã§åˆ¥ã€…ç®¡ç†     |
| å‘¼ã³å‡ºã—            | `book.check_out()`     | `check_out(book)` |
| ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ã§ã®ç‹™ã„ | **EntityãŒè‡ªå¾‹ã™ã‚‹**ã“ã¨ã§ä¿å®ˆå®¹æ˜“ | **é–¢æ•°ãŒå¤–éƒ¨ã«ä¾å­˜**ã—ãŒã¡   |

---

## ğŸ¯ ã¾ã¨ã‚

ã“ã®å›³æ›¸é¤¨ã‚¢ãƒ—ãƒªã¯ã€æ¬¡ã®ã‚ˆã†ãªå­¦ç¿’ã‚´ãƒ¼ãƒ«ã‚’æ„è­˜ã—ã¦ã„ã¾ã™ã€‚

* Entity ã«ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ï¼ˆçŠ¶æ…‹é·ç§»ï¼‰ã‚’æŒãŸã›ã‚‹è¨­è¨ˆã‚’ä½“å¾—
* UseCase ãŒè¤‡æ•°ã® Repository ã‚’çµ±åˆã™ã‚‹æµã‚Œã‚’ç†è§£
* Presenter / Controller / Repository ãŒã©ã†ã€Œå¢ƒç•Œã€ã§é€£æºã™ã‚‹ã‹ã‚’ç¢ºèª
* æŠ€è¡“è©³ç´°ï¼ˆDBã‚„UIï¼‰ã‚’å·®ã—æ›¿ãˆã¦ã‚‚ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ãŒå£Šã‚Œãªã„æ§‹é€ ã‚’å®Ÿæ„Ÿ

