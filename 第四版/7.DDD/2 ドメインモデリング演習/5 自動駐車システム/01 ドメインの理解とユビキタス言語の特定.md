# 01 ドメインの理解とユビキタス言語の特定

# ステップ１：ドメインの理解とユビキタス言語の特定 (再訪) 🗣️

この演習では、第4巡・第5巡で構築した「自動駐車システム」を題材とし、**ドメイン駆動設計(DDD)** の視点から改めてモデルを見直します。最初のステップは、ドメインを再確認し、**ユビキタス言語**をより洗練させ、**境界づけられたコンテキスト**の妥当性を評価することです。

## 🤔 何をするシステム？ (Core Purpose Recap)

- センサー情報（カメラなど）を用いて、車両の周囲環境、特に駐車可能なスペースを**認識 (Perceive)** する。
- 認識した情報（世界モデル）に基づき、駐車スペースまでの安全な**経路 (Path)** と**動作計画 (Plan)** を計算する。
- 計算された計画に従って、ステアリングやアクセル/ブレーキを**制御 (Control)** し、車両を自動で駐車させる。

## 💬 ユビキタス言語の再確認と洗練 (Refining Ubiquitous Language)

第4巡の「はじめに」で定義した用語を、DDDの視点で見直してみましょう。

- **認識サービス (Perception Service) -> 認識コンテキスト (Perception Context)**:
    - **世界モデル (WorldModel)**: センサー情報を解釈し、システムが理解できる形式（駐車スペースの位置、障害物の位置など）で表現された、特定の瞬間の環境マップ。➡️ これは重要なドメイン概念であり、コンテキスト間で受け渡される「契約」でもある。構造自体は**値オブジェクト**に近い性質を持つ（特定の瞬間のスナップショット）。
    - **駐車スペース (ParkingSpace)**: 認識された駐車可能な領域。位置、サイズ、向きなどの属性を持つ。➡️ `WorldModel` に含まれる**値オブジェクト**候補。
    - **検出物体 (DetectedObject)**: 認識された障害物（壁、他の車など）。位置、形状などの属性を持つ。➡️ `WorldModel` に含まれる**値オブジェクト**候補。
    - **センサーデータ (SensorData)**: カメラ画像、ソナー測定値など。➡️ システムへの**入力**となる**値オブジェクト**。
- **経路計算サービス (Planning Service) -> 経路計算コンテキスト (Planning Context)**:
    - **駐車計画 (ParkingPlan)**: `WorldModel` に基づいて生成された、駐車完了までの時系列の動作指示リスト。➡️ 次のコンテキストへの「契約」となるデータ。構造は**値オブジェクト**に近いかもしれないが、計画IDで識別されるならエンティティの性質も持つ。
    - **制御コマンド (ControlCommand)**: 駐車計画を構成する個別の動作指示（例：ハンドル角度、速度、継続時間）。➡️ `ParkingPlan` に含まれる**値オブジェクト**。
    - **経路 (Path / Trajectory)**: (明示的には登場しなかったが) 駐車計画の内部的な計算結果として存在するかもしれない、車両が辿るべき幾何学的な軌道。
- **車両制御サービス (Control Service) -> 車両制御コンテキスト (Control Context)**:
    - **車両状態 (VehicleState)**: ステアリング角度、速度、位置など、車両の現在の物理的な状態。➡️ **値オブジェクト**候補（入力または内部状態）。
    - **アクチュエータ指示 (ActuatorCommand)**: ステアリングモーターやブレーキ/アクセルへの具体的な指示値。➡️ システムからの**出力**となる**値オブジェクト**。

**ポイント:**

- 第4巡で設定したサービス分割（認識、計画、制御）は、DDDの**境界づけられたコンテキスト**として妥当であったか？ → それぞれが異なる専門知識と言語（ユビキタス言語）を持ち、明確な責任分担があるため、妥当な分割と言えそうです。
- `WorldModel` や `ParkingPlan` は、コンテキスト間で受け渡される**重要なデータ構造**です。これらは、DDDのコンテキストマップにおける**公開言語 (Published Language)** の役割を果たしています。これらの構造を値オブジェクトとして厳密に定義（不変性、自己検証）することで、コンテキスト間の契約がより明確になります。

---

## ➡️ 次へ

ドメインとユビキタス言語、そしてコンテキスト分割の妥当性を再確認しました。次は、各コンテキストの中心となる**集約 (Aggregate)** をDDDの視点から改めて定義し、その境界と責務を明確にしてみましょう。「**(Step 2) 集約の発見と境界設定 (再訪)**」に進みます。