# 04 è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒ€ãƒ—ã‚¿å·®ã—æ›¿ãˆ

# ğŸš€ ã‚¹ãƒ†ãƒƒãƒ—4ï¼šè»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ã®ã‚¢ãƒ€ãƒ—ã‚¿å·®ã—æ›¿ãˆ (Subscriber)

ç¬¬5å·¡ã®4ç•ªç›®ã®ã‚¹ãƒ†ãƒƒãƒ—ã§ã™ã€‚
ã€Œè»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ã€ã®ã€Œå…¥ã‚Šå£ã€ã§ã‚ã‚‹ã‚¢ãƒ€ãƒ—ã‚¿ã‚’ã€ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿ï¼ˆ`File...Subscriber`ï¼‰ã‹ã‚‰ã€MQTTï¼ˆ`Mqtt...Subscriber`ï¼‰ã«å·®ã—æ›¿ãˆã¾ã™ã€‚

- **å…¥åŠ›**: `FilePlanSubscriber` â” `MqttPlanSubscriber`
- **å‡ºåŠ›**: `StubActuatorAdapter` ï¼ˆâ€»ã“ã‚Œã¯ãƒãƒ¼ãƒ‰ã‚¦ã‚§ã‚¢ã¸ã®å‡ºåŠ›ã§ã‚ã‚Šã€ã‚µãƒ¼ãƒ“ã‚¹é–“é€£æºã§ã¯ãªã„ãŸã‚**å¤‰æ›´ãªã—**ï¼‰

---

## ğŸ¯ ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®ã‚´ãƒ¼ãƒ«

- è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ã®UseCaseã‚„Entityã«ã¯**ä¸€åˆ‡è§¦ã‚Œãšã«**ã€å…¥åŠ›ã‚¢ãƒ€ãƒ—ã‚¿ã ã‘ã‚’å·®ã—æ›¿ãˆã‚‹ã€‚
- `plan.json` ã‚’èª­ã¿è¾¼ã‚€ä»£ã‚ã‚Šã«ã€MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ã€Œé§è»Šè¨ˆç”»ã€ã‚’ **è³¼èª­ï¼ˆSubscribeï¼‰** ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹ã€‚

---

## ğŸ§© å¤‰æ›´ã®æ¦‚è¦

ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã§å¤‰æ›´ãƒ»è¿½åŠ ã™ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `adapters/` ãƒ•ã‚©ãƒ«ãƒ€ã¨ `main.py` ã®ã¿ã§ã™ã€‚

- **`domain/entities.py`**: å¤‰æ›´ãªã—
- **`application/use_cases.py`**: å¤‰æ›´ãªã—
- **`application/boundaries.py`**: å¤‰æ›´ãªã—
- **`adapters/mqtt_subscriber.py`**: ğŸ‘ˆ **ï¼ˆæ–°è¦ä½œæˆï¼‰**
- **`adapters/file_subscriber.py`**: ï¼ˆä¸è¦ã«ãªã‚‹ï¼‰
- **`adapters/stub_actuator.py`**: å¤‰æ›´ãªã—
- **`adapters/repositories.py`**: å¤‰æ›´ãªã—
- **`main.py`**: ğŸ‘ˆ **ï¼ˆã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨DIéƒ¨åˆ†ã‚’ä¿®æ­£ï¼‰**

---

## ğŸ› ï¸ æ‰‹é †1ï¼šMQTTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆç¢ºèªï¼‰

ï¼ˆã‚¹ãƒ†ãƒƒãƒ—2ã¾ãŸã¯3ã§ `paho-mqtt` ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«æ¸ˆã¿ã§ã‚ã‚Œã°ã€ã“ã®æ‰‹é †ã¯ä¸è¦ã§ã™ã€‚ï¼‰

```bash
pip install paho-mqtt

```

---

## âš™ï¸ æ‰‹é †2ï¼šMqttPlanSubscriber ã®ä½œæˆ

`application/boundaries.py` ã«å®šç¾©ã•ã‚Œã¦ã„ã‚‹ `PlanSubscriberInterface`ï¼ˆã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ï¼‰ã‚’å®Ÿè£…ã™ã‚‹ã€æ–°ã—ã„ã€Œå…¥åŠ›ã‚¢ãƒ€ãƒ—ã‚¿ã€ã‚¯ãƒ©ã‚¹ã‚’ä½œæˆã—ã¾ã™ã€‚
ã“ã‚Œã¯ã€ã‚¹ãƒ†ãƒƒãƒ—3ã§ä½œæˆã—ãŸ `MqttWorldModelSubscriber` ã¨ã»ã¼åŒã˜ãƒ­ã‚¸ãƒƒã‚¯ã§ã™ãŒã€è³¼èª­ã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã¨ã€å—ã‘å–ã‚‹ãƒ‡ãƒ¼ã‚¿ï¼ˆEntityï¼‰ãŒç•°ãªã‚Šã¾ã™ã€‚

```python
# adapters/mqtt_subscriber.py (è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹å†…ã«æ–°è¦ä½œæˆ)
import paho.mqtt.client as mqtt
import json
import asyncio
from domain.entities import ParkingPlan, ControlCommand # ğŸ‘ˆ é§è»Šè¨ˆç”»ã®Entity
from application.boundaries import PlanSubscriberInterface # ğŸ‘ˆ å®Ÿè£…ã™ã‚‹I/F
from typing import Optional
from datetime import datetime

# -----------------------------------------------------------------------------
# Service Adapter Implementation (MQTT Subscriber)
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: ServiceAdapter
# - åŒå¿ƒå††å›³ã®ä½ç½®: Adapters (å¤–å´ã®å††)
# -----------------------------------------------------------------------------
class MqttPlanSubscriber(PlanSubscriberInterface):
    """
    UseCaseã®è¦æ±‚(I/F)ã«åŸºã¥ãã€MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã‹ã‚‰
    ParkingPlanã‚’è³¼èª­ï¼ˆSubscribeï¼‰ã™ã‚‹ã‚¢ãƒ€ãƒ—ã‚¿ã€‚
    """
    def __init__(self, broker_address: str, broker_port: int, topic: str):
        self._broker_address = broker_address
        self._broker_port = broker_port
        self._topic = topic

        # UseCaseã«æ¸¡ã™ãŸã‚ã®ã€æœ€æ–°ã®ParkingPlanã‚’ä¿æŒã™ã‚‹å¤‰æ•°
        self._latest_plan: Optional[ParkingPlan] = None
        # ä¸€åº¦å®Ÿè¡Œã—ãŸè¨ˆç”»ã‚’å†åº¦å®Ÿè¡Œã—ãªã„ãŸã‚ã®IDç®¡ç†ï¼ˆç°¡æ˜“çš„ï¼‰
        self._last_plan_timestamp: Optional[datetime] = None

        # MQTTã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®åˆæœŸåŒ–
        self._client = mqtt.Client(mqtt.CallbackAPIVersion.VERSION2)
        self._client.reconnect_delay_set(min_delay=1, max_delay=30)

        # ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯é–¢æ•°ã®è¨­å®š
        self._client.on_connect = self._on_connect
        self._client.on_disconnect = self._on_disconnect
        self._client.on_message = self._on_message # ğŸ‘ˆ ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å—ä¿¡æ™‚ã®é–¢æ•°

        # æ¥ç¶šã¨ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰å®Ÿè¡Œ
        try:
            self._client.connect_async(self._broker_address, self._broker_port, 60)
            self._client.loop_start() # ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å—ä¿¡å‡¦ç†ã‚’é–‹å§‹
        except Exception as e:
            print(f"[Adapter] MQTT Subscriber: Failed to connect initially: {e}")

    def _on_connect(self, client, userdata, flags, rc, properties=None):
        if rc == 0:
            print(f"[Adapter] MQTT Subscriber: Connected to broker at {self._broker_address}")
            # æ¥ç¶šæˆåŠŸæ™‚ã«ã€æŒ‡å®šã•ã‚ŒãŸãƒˆãƒ”ãƒƒã‚¯ã‚’è³¼èª­ï¼ˆSubscribeï¼‰ã™ã‚‹
            client.subscribe(self._topic)
            print(f"[Adapter] MQTT Subscriber: Subscribed to topic '{self._topic}'")
        else:
            print(f"[Adapter] MQTT Subscriber: Failed to connect, return code {rc}")

    def _on_disconnect(self, client, userdata, rc, properties=None):
        print(f"[Adapter] MQTT Subscriber: Disconnected from broker. Reconnecting...")

    def _on_message(self, client, userdata, msg):
        """
        [MQTT Push] ãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ã‹ã‚‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å—ä¿¡ã—ãŸã¨ãã«å‘¼ã³å‡ºã•ã‚Œã‚‹
        """
        try:
            print(f"[Adapter] MQTT Subscriber: Received message from topic '{msg.topic}'")
            payload = msg.payload.decode('utf-8')
            data = json.loads(payload)

            # JSONè¾æ›¸ã‹ã‚‰ParkingPlan Entityã«å¤‰æ›
            plan_timestamp = datetime.fromisoformat(data["timestamp"])

            # (ç°¡æ˜“çš„ãªé‡è¤‡å®Ÿè¡Œé˜²æ­¢)
            if self._last_plan_timestamp and self._last_plan_timestamp == plan_timestamp:
                # print("[Adapter] MQTT Subscriber: Received plan is same as last one. Ignoring.")
                return # åŒã˜è¨ˆç”»ã¯ç„¡è¦–

            self._last_plan_timestamp = plan_timestamp
            plan = ParkingPlan(
                timestamp=plan_timestamp,
                commands=[ControlCommand(**cmd) for cmd in data["commands"]]
            )

            # å—ä¿¡ã—ãŸæœ€æ–°ã®ParkingPlanã‚’å†…éƒ¨ã«ä¿å­˜
            self._latest_plan = plan

        except json.JSONDecodeError:
            print("[Adapter] MQTT Subscriber: Failed to decode JSON message")
        except Exception as e:
            print(f"[Adapter] MQTT Subscriber: Error processing message: {e}")

    async def get_plan(self) -> Optional[ParkingPlan]:
        """
        [UseCase Pull] UseCaseã‹ã‚‰å‘¼ã³å‡ºã•ã‚ŒãŸã¨ãã«ã€
        å†…éƒ¨ã«ä¿å­˜ã•ã‚Œã¦ã„ã‚‹æœ€æ–°ã®ParkingPlanã‚’è¿”ã™
        """
        await asyncio.sleep(0)

        # _on_message ã§ä¿å­˜ã•ã‚ŒãŸæœ€æ–°ã®è¨ˆç”»ã‚’è¿”ã™
        plan_to_execute = self._latest_plan

        # ä¸€åº¦è¿”ã—ãŸã‚‰ï¼ˆå®Ÿè¡Œã—ãŸã‚‰ï¼‰è¨ˆç”»ã‚’ã‚¯ãƒªã‚¢ã—ã€å¤šé‡å®Ÿè¡Œã‚’é˜²ã
        self._latest_plan = None

        return plan_to_execute

```

*(è£œè¶³: `get_plan()` ã§ `_latest_plan = None` ã¨ã—ã¦ã„ã‚‹ã®ã¯ã€`handle()` ãƒ«ãƒ¼ãƒ—ãŒé«˜é€Ÿã§å›ã£ãŸå ´åˆã«ã€åŒã˜è¨ˆç”»ã‚’ä½•åº¦ã‚‚å®Ÿè¡Œã—ã¦ã—ã¾ã†ã®ã‚’é˜²ããŸã‚ã®ç°¡æ˜“çš„ãªã€Œå®Ÿè¡Œæ¸ˆã¿ã€ç®¡ç†ã§ã™)*

---

## ğŸš€ æ‰‹é †3ï¼š[main.py](http://main.py/) ã®ä¿®æ­£ï¼ˆDIã®å·®ã—æ›¿ãˆï¼‰

æœ€å¾Œã«ã€è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ã® `main.py` ã‚’é–‹ãã€`FilePlanSubscriber` ã‚’ä½¿ã£ã¦ã„ãŸéƒ¨åˆ†ã‚’ã€ä»Šä½œæˆã—ãŸ `MqttPlanSubscriber` ã«å·®ã—æ›¿ãˆã¾ã™ã€‚

```python
# main.py (è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹å†…)
import asyncio
from application.use_cases import ExecutePlanUseCase
# from adapters.file_subscriber import FilePlanSubscriber       # <- å¤ã„ã‚¢ãƒ€ãƒ—ã‚¿
from adapters.mqtt_subscriber import MqttPlanSubscriber       # <- ğŸ‘ˆ æ–°ã—ã„å…¥åŠ›ã‚¢ãƒ€ãƒ—ã‚¿
from adapters.repositories import InMemoryVehicleStateRepository # <- å¤‰æ›´ãªã—
from adapters.stub_actuator import StubActuatorAdapter           # <- å¤‰æ›´ãªã—

# -----------------------------------------------------------------------------
# Entry Point (Main Application)
# - ã‚¯ãƒ©ã‚¹å›³ã®ä½ç½®: Main (DIã‚³ãƒ³ãƒ†ãƒŠã®å½¹å‰²)
# - åŒå¿ƒå††å›³ã®ä½ç½®: æœ€ã‚‚å¤–å´ã®å±¤ (Frameworks & Drivers)
# -----------------------------------------------------------------------------
async def main():
    """
    ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’èµ·å‹•ã—ã€ä¾å­˜é–¢ä¿‚ã‚’æ³¨å…¥ (DI) ã™ã‚‹ã€‚
    """
    print("--- [Control Service] Starting Up ---")

    # 1. Adapterså±¤ï¼ˆå…·ä½“çš„ãªå®Ÿè£…ï¼‰ã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–

    # â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼ å·®ã—æ›¿ãˆéƒ¨åˆ† (å…¥åŠ›) â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼â–¼
    # plan_subscriber = FilePlanSubscriber(filepath="plan.json") # <- å¤ã„ã‚¢ãƒ€ãƒ—ã‚¿

    # æ–°ã—ã„MQTT Subscriberã‚’ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹åŒ–
    plan_subscriber = MqttPlanSubscriber(
        broker_address="localhost",
        broker_port=1883,
        topic="autodrive/plan" # ğŸ‘ˆ çµŒè·¯è¨ˆç®—ã‚µãƒ¼ãƒ“ã‚¹ãŒå…¬é–‹ã™ã‚‹ãƒˆãƒ”ãƒƒã‚¯ã‚’è³¼èª­
    )
    # â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–² å·®ã—æ›¿ãˆéƒ¨åˆ† â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²â–²

    state_repository = InMemoryVehicleStateRepository()
    actuator_adapter = StubActuatorAdapter()

    # 2. UseCaseå±¤ã«ã€å…·ä½“çš„ãªå®Ÿè£…ã‚’ã€Œä¾å­˜æ€§ã®æ³¨å…¥ (DI)ã€
    #    UseCaseã¯å·®ã—æ›¿ãˆã‚‰ã‚ŒãŸã“ã¨ã«æ°—ã¥ã‹ãªã„
    use_case = ExecutePlanUseCase(
        plan_sub=plan_subscriber,
        state_repo=state_repository,
        actuator=actuator_adapter
    )

    # 3. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆUseCaseï¼‰ã®ã€ãƒ«ãƒ¼ãƒ—å®Ÿè¡Œã€‘
    # (â€»ã“ã®ãƒ«ãƒ¼ãƒ—éƒ¨åˆ†ã¯ç¬¬4å·¡ã®æœ€çµ‚çµ±åˆã§ä¿®æ­£æ¸ˆã¿)
    print("\\n--- [Control Service] Running in loop (Press Ctrl+C to stop) ---")
    while True:
        try:
            await use_case.handle()
            await asyncio.sleep(1)
        except Exception as e:
            print(f"--- [Control Service] Error in loop: {e} ---")
            await asyncio.sleep(5)

if __name__ == "__main__":
    # ã“ã®ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆè»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹ï¼‰ã‚’å®Ÿè¡Œ
    asyncio.run(main())

```

---

## ğŸ’¡ æ‰‹é †4ï¼šå‹•ä½œç¢ºèªï¼ˆå…¨ã‚µãƒ¼ãƒ“ã‚¹é€£æºï¼‰

ã“ã‚Œã§ã€3ã¤ã™ã¹ã¦ã®ã‚µãƒ¼ãƒ“ã‚¹ãŒMQTTã«å¯¾å¿œã—ã¾ã—ãŸã€‚ã‚·ã‚¹ãƒ†ãƒ å…¨ä½“ã‚’é€šã—ã¦å‹•ä½œç¢ºèªã‚’ã—ã¾ã—ã‚‡ã†ã€‚

1. ï¼ˆã‚¹ãƒ†ãƒƒãƒ—1ã§èµ·å‹•ã—ãŸï¼‰**MQTTãƒ–ãƒ­ãƒ¼ã‚«ãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹**ã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚
2. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã‚’3ã¤**é–‹ãã¾ã™ã€‚
3. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1**ã§ã€**èªè­˜ã‚µãƒ¼ãƒ“ã‚¹**ï¼ˆã‚¹ãƒ†ãƒƒãƒ—2ã§ä¿®æ­£æ¸ˆã¿ï¼‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    
    ```bash
    python perception_service/main.py
    
    ```
    
4. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2**ã§ã€**çµŒè·¯è¨ˆç®—ã‚µãƒ¼ãƒ“ã‚¹**ï¼ˆã‚¹ãƒ†ãƒƒãƒ—3ã§ä¿®æ­£æ¸ˆã¿ï¼‰ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    
    ```bash
    python planning_service/main.py
    
    ```
    
5. **ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3**ã§ã€ä»Šå›ä¿®æ­£ã—ãŸ**è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹**ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚
    
    ```bash
    python control_service/main.py
    
    ```
    

### ç¢ºèªã™ã‚‹ãƒã‚¤ãƒ³ãƒˆ

3ã¤ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ãŒãã‚Œãã‚Œèµ·å‹•ã—ã€ä»¥ä¸‹ã®ã‚ˆã†ã«ãƒ‡ãƒ¼ã‚¿ãŒ**ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ï¼ˆMQTTï¼‰çµŒç”±ã§**æµã‚Œã¦ã„ãã“ã¨ã‚’ç¢ºèªã—ã¾ã™ã€‚

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«1 (èªè­˜ã‚µãƒ¼ãƒ“ã‚¹)**

```bash
...
[Adapter] MQTT Publisher: Connected to broker...
...
[Adapter] MQTT Publisher: World Model published to topic 'autodrive/world_model'
...

```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«2 (çµŒè·¯è¨ˆç®—ã‚µãƒ¼ãƒ“ã‚¹)**

```bash
...
[Adapter] MQTT Subscriber: Connected to broker...
[Adapter] MQTT Subscriber: Subscribed to topic 'autodrive/world_model'
...
[Adapter] MQTT Subscriber: Received message from topic 'autodrive/world_model'
[UseCase] Calculating parking plan...
[Adapter] MQTT Publisher: Parking Plan published to topic 'autodrive/plan'
...

```

**ã‚¿ãƒ¼ãƒŸãƒŠãƒ«3 (è»Šä¸¡åˆ¶å¾¡ã‚µãƒ¼ãƒ“ã‚¹)**

```bash
...
[Adapter] MQTT Subscriber: Connected to broker...
[Adapter] MQTT Subscriber: Subscribed to topic 'autodrive/plan'
...
[Adapter] MQTT Subscriber: Received message from topic 'autodrive/plan'
[UseCase] Executing plan with 3 commands...
[Adapter] StubActuator: STEER set to -30.0 degrees
[Adapter] StubActuator: THROTTLE set to -0.5 m/s^2
...

```

`world_model.json` ã‚„ `plan.json` ãƒ•ã‚¡ã‚¤ãƒ«ãŒä¸€åˆ‡ä½œæˆãƒ»æ›´æ–°ã•ã‚Œã¦ã„ãªã„ã“ã¨ã‚‚ç¢ºèªã—ã¦ãã ã•ã„ã€‚

---

## ğŸ›¡ï¸ ã“ã®ã‚¹ãƒ†ãƒƒãƒ—ã®é‰„å‰‡

**UseCaseã¯ã€å…¥å‡ºåŠ›ãŒãƒ•ã‚¡ã‚¤ãƒ«ã§ã‚‚ãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã§ã‚‚ã€ãã®é•ã„ã‚’å¸åã™ã‚‹ã®ãŒã‚¢ãƒ€ãƒ—ã‚¿ã®è²¬å‹™ã§ã‚ã‚‹ã€‚**

`MqttWorldModelSubscriber` ã¯ã€MQTTã®ã€Œãƒ—ãƒƒã‚·ãƒ¥å‹ã€ã®å‹•ä½œã‚’ã€UseCaseãŒè¦æ±‚ã™ã‚‹ã€Œãƒ—ãƒ«å‹ï¼ˆ`get_world_model()`ï¼‰ã€ã«è¦‹äº‹ã«å¤‰æ›ï¼ˆã‚¢ãƒ€ãƒ—ãƒˆï¼‰ã—ã¾ã—ãŸã€‚
ã“ã‚Œã«ã‚ˆã‚Šã€UseCaseã¯é€šä¿¡æ–¹å¼ã®å¤‰æ›´ã«ä¸€åˆ‡æ°—ã¥ãã“ã¨ãªãã€ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã«é›†ä¸­ã—ç¶šã‘ã‚‹ã“ã¨ãŒã§ãã¾ã™ã€‚

---

æ¬¡ã¯ã€ã€Œã‚¹ãƒ†ãƒƒãƒ—5ï¼šæœ€çµ‚çµ±åˆã¨å®Ÿè¡Œï¼ˆï¼† æŒ¯ã‚Šè¿”ã‚Šï¼‰ã€ã«é€²ã¿ã€ã“ã®ç¬¬5å·¡ã®å­¦ã³ã‚’ã¾ã¨ã‚ã¾ã™ã€‚